[{"id":"797691c1e8d3bbb1","type":"tab","label":"Config","disabled":false,"info":"","env":[]},{"id":"9c0ee1028b125264","type":"tab","label":"Questionner onduleur","disabled":false,"info":""},{"id":"34242fea930de037","type":"tab","label":"mqtt_ha","disabled":false,"info":"Definir la correspondance avec ha","env":[]},{"id":"1eba1b99238b9144","type":"tab","label":"Pylon- Power","disabled":false,"info":"","env":[]},{"id":"18ee536d8d8af34b","type":"tab","label":"Easun","disabled":true,"info":"","env":[]},{"id":"311fc27fae3e469a","type":"tab","label":"EASUN old","disabled":true,"info":"","env":[]},{"id":"7ec693d06a48e28c","type":"tab","label":"sofar solar","disabled":true,"info":"","env":[]},{"id":"e091b9214cc61a28","type":"tab","label":"JUNCTEK KG-F 140","disabled":true,"info":"Coulombmetre chinois\nhttp://68.168.132.244/KG-F_EN_manual.pdf","env":[]},{"id":"76c3969468e7ca28","type":"tab","label":"Pylon- Power","disabled":false,"info":"","env":[]},{"id":"72d9ac7047516ee9","type":"group","z":"9c0ee1028b125264","name":"Boucle d'acquisition des données de l'onduleur.","style":{"stroke":"#0070c0","label":true,"color":"#0070c0"},"nodes":["2f476d8b23e8928e","5c745d1e2285feb7","52a29267e8d0699b","5998183f1333512a"],"x":574,"y":-1,"w":552,"h":82},{"id":"93f4b0f6c7c003ae","type":"group","z":"9c0ee1028b125264","name":"Envoyer les question via la passerelle Elfin RS232","style":{"stroke":"#0070c0","label":true,"color":"#0070c0"},"nodes":["6da2bb26e30ffdfe","1a04c804b2d9b026","602df7fcc809f17f","e83039f408491510","8ba9d5a59e6dee3c","62edb1adc67806fc","11edec69ac2c9440"],"x":254,"y":99,"w":872,"h":122},{"id":"78c8b76577708c4d","type":"group","z":"9c0ee1028b125264","name":"Analyse des réponses provenant de l'onduleur","style":{"stroke":"#0070c0","label":true,"color":"#0070c0"},"nodes":["ab85318b13524dfe","efea33497c071b44","efd023f511690a18","99f51f01d55bdc87","1e0ae2d1c090b3f7","531ff80b4a69e7c3","b3c2789e556b18c8","af37b8e53dc2b591"],"x":34,"y":379,"w":1092,"h":202},{"id":"70c1f0ed78b559f7","type":"group","z":"797691c1e8d3bbb1","name":"Définir les globals variables","style":{"label":true},"nodes":["e3d2b4d505d7c3b1","d3a91a0be3d32cfa","6a484576febf2df9","c5b68a34de9a9c28","697f593b67e21ceb","4f62fd1b871f675c"],"x":14,"y":19,"w":1092,"h":122},{"id":"605cc1d4fd3c9194","type":"group","z":"797691c1e8d3bbb1","name":"Test des globals variables","style":{"label":true},"nodes":["a9d9bccb5f78a0bf","0b09136cb66b1815","a40cfac7d32275a8"],"x":4,"y":279,"w":1102,"h":82},{"id":"20c77bec28bfdfda","type":"group","z":"797691c1e8d3bbb1","name":"mqtt connect","style":{"label":true},"nodes":["4ef89226ddebe9b3","cc37c11c33756143","358d596529460ec8","1886e97a550fdebe","5ee485bdb3085557","58815987c51e2a0f"],"x":14,"y":379,"w":1092,"h":162},{"id":"60183840d1a1fbf0","type":"group","z":"797691c1e8d3bbb1","name":"Copie du config.json pour la version node red","style":{"label":true},"nodes":["65c1fe8e5a4260a0","291f484d3a35166a"],"x":14,"y":151.5,"w":1092,"h":97},{"id":"5ce32d0140c5ba51","type":"group","z":"311fc27fae3e469a","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["4f80ddd9e0d2c1f3","6b9f490181bf8aac","3990c29f14dab8fe"],"x":1584,"y":779},{"id":"005e3977faddc2b6","type":"group","z":"311fc27fae3e469a","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["df025d486b8d3c22","967489674a3c9011","15db78782c15d970","cc4688143a5d1e7f","34080c1dbceb7ad9","134fe8f59e78141f"],"x":46.183349609375,"y":1699},{"id":"84cd0ffd4a8a860d","type":"group","z":"311fc27fae3e469a","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["f1afb26fdb66a314","78daa8e7a58c103d","dffb335cf5d16dc4","3ca8ce2e0e5e0d9a","b346ed8f4ce86b21","63061f1830edc9a6","7a8c8c1df86bca86","c79eaae3c65d0bc4","7efb99d2814214c7","d10f88c65925bac8","7fd387aad640112b","d5bd92791d4257e6","306bca2e5dd4e559","e07fb359209a7966","e7bbaf1df4a2717b","cac414cdb64a4750","9d784fd1e6ad4f3f","cc40901d84761a96","ecd3a2e3e6e96cf5","e23d93e9473d4098","a3d6bbe1c57abca8","dd74e7e6896517e6","a7b2c438b8d1904c","1c35e42cebc78869","3641c751711f6ce6","9c857ebd63233e3b","ac1e31523c9afefa","bc5782cd244d386e","6b6bb33c30fda3fc","1ef225b44346b020","6171ef84a5d34fe1","521b41faaeb77c52","9703867af121ddff","0c83e6def8263fd1","b78f48af0b8f9fdf","c7a37ee3c8a97616","ee0a0ecc24c24882","2e63d6fd64fa9cba","92bf8281c9314a67","1b678453bc839df9","ec1aeb21f3ec8ea3","dde9a06e6090a296","710d129a2cd5840a","b949139220858ce3","b107c45925a7ac3f","9b831807cd5cbdc6","8f23f3d4e4a4b813","c122c02ed209a876","19e15ee858d124be","7a102481b9969ef4","7b9af628b0910282","386db01067c1dd83","6b74f19c54c1d244","4f08f345d5e9950b","f66f1a0fb11677fd","173a9a67b995ff02","dc7404591257e79a","adb658b67d4f3eb5","3b5ea4c71a9fd26a","c4e5ce471b4f2cdd","898b24b427827d1e","d95d9965435c3c55","6021749dadda9848","6edec91680a33aa3"],"x":34,"y":7.733329772949219},{"id":"a5dcfaf2e3ab4964","type":"group","z":"9c0ee1028b125264","name":"Retour mqtt","style":{"label":true},"nodes":["e7b0a2a9babd283a","356d577dad88c0fd","948cdd1836b994fb","f8cea4025fd64803","8eb2e427abc909f2","bcb7a48abdf34e60","0a26af9f25c8825f","c4ed8f53c8379119"],"x":34,"y":599,"w":1092,"h":122},{"id":"586f394187c03306","type":"group","z":"9c0ee1028b125264","name":"Requête + Firmware. 1 fois au démarrage de NR","style":{"stroke":"#0070c0","label":true,"color":"#0070c0"},"nodes":["f4cd137430c47522","6325b4e5bceb7eaf","252cd27273af1053","c8499b08a0d42809"],"x":14,"y":-1,"w":542,"h":82},{"id":"c73322e02c5f8ecb","type":"group","z":"9c0ee1028b125264","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["d4dbea17adb8abb7","500c2cc0b7e98c26","74dc98f8102cb944","c9fd372e65fbd09d"],"x":254,"y":239,"w":872,"h":102},{"id":"ea166099ccf67163","type":"group","z":"7ec693d06a48e28c","name":"Accès onduleur via ModBus","style":{"label":true,"stroke":"#000000"},"nodes":["18f0016798c6197f","aeec416df162e3df"],"x":64,"y":59},{"id":"356a37bfc81f1baa","type":"group","z":"e091b9214cc61a28","name":"Récupère et affiche les valeurs live","style":{"stroke":"#ffC000","label":true,"color":"#000000"},"nodes":["7ef671364fa53675","d0e3c002c3ff7abf","8d56eeee7725f8d0","a5b39bea971a8dbb","cd9c06b3a0ce89aa","893375d3c7782404","79e0106a5571d6e6","4f165ed8157e175d","2e5bbf051c6d2813","1d16476e9ca7cd49","cb30886bff26dea0","0521802c70304b1f","7e7284fa15388413","5bb3add94b07e3dc","377640da981fd362","0684da33ce91a6ee","31a8da64a6d4c7ec","965525df1213ee7d","aa4138f16fd06327","fb72b4c244f35774","8743a60f9a622822","7d1b7ae8a5aeccdd","f3d55b3992c3257d","c7d58cac374d58c1"],"x":34,"y":399},{"id":"afbe017601a3a934","type":"group","z":"e091b9214cc61a28","name":"Get value from serial port RS485 115200 bds tty-junktec","style":{"stroke":"#ffC000","label":true,"color":"#000000"},"nodes":["1a36f224c52de710","1acee92886224879","2aeb08d199add338","24e1d12308d64e95","76d703acd3803ad5","d1a99a1076d3819a","e1ee58df3b5e38ce","52736e2aa596a00d","e2b22b278cceefc7","ea0f6667a75e1696","23c289f154371763","c012a4fead5e5458","aee398f7583255bf","21a98a4de8bcc929","9efa6ce981bd0692","4c6221eca0e89314","5dbea6e31cb2a0a3","31bfa3375086b936","69ae7dd32f0b095d"],"x":34,"y":139},{"id":"6456c1c3bee5d753","type":"group","z":"34242fea930de037","name":"select","style":{"label":true},"nodes":["2e464f438a03cc52","21d2e9636322273d","d542d7000127ca32"],"x":254,"y":399,"w":592,"h":82},{"id":"50300f11ec221358","type":"group","z":"1eba1b99238b9144","name":"Questionner Pylontech avec commande \"pwr\" pour obtenir les données Live","style":{"stroke":"#0070c0","label":true,"color":"#0070c0"},"nodes":["75f1e2f5f32a6297","6efd8f270dbb98ce","5d4b1ae6ec6d47cf","a0a971da9cb23245"],"x":14,"y":19},{"id":"2704b7e1ab53ecfd","type":"group","z":"1eba1b99238b9144","name":"creation mqtt commande PWR","style":{"stroke":"#92d04f","label":true,"color":"#0070c0","fill":"#ffff3f"},"nodes":["040cd890a0c73635","92a4fc5845bab572","95e89f3e16943452","cd1477d4c053f463","be2f278bc9283c22","92bc72013744ba07","2a6f24b92d300724"],"x":14,"y":319},{"id":"7362cf61f06305cc","type":"group","z":"1eba1b99238b9144","name":"Envoi des requêtes soit sur le port RS232 des Pylontech ou sur la passerelle Elfin Pylontech ","style":{"stroke":"#0070c0","label":true,"color":"#0070c0"},"nodes":["a131444f0c08e83c","6e93ef99c007100b","c6d07b2fa33077c9","b21fe743fbfd15b8","0735a4b3ca51036c","4daf451b32a30d25","ed1d8f6b1c4b62b5","68cf9f0d3227936e","15a2b41d82893402","1633fc1cc91871a4","c1996d99c59d0284","bf0221002f98096f"],"x":14,"y":99},{"id":"4cfcbd6d8376184f","type":"group","z":"34242fea930de037","name":"sensor","style":{"label":true},"nodes":["70c1b6d8aff0eb99","239461aea9f16532","f49f3e972d1dd374","32d9b99943ad61e9","bda5dd5d13f13ec1","c350aafdc2ec44da","24a6e831c0984006","47f8d8ee8dc1fed2","54f7f2edafc6dc96","4c84a6bbea2bf75f","c24651723d857016","7414b4a5c438fbd8"],"x":254,"y":19,"w":692,"h":362},{"id":"967489674a3c9011","type":"group","z":"311fc27fae3e469a","g":"005e3977faddc2b6","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["b8ad0edd5736850d","a64827f331ba12b2","25fd1a026a5a92e4","57c9d2a14478cb52","fde3451044383358","4c203a3901201565","73c97bc9eeac3d19","3de355e2cc2b94a5","9da4942675eb964c"],"x":74,"y":1779},{"id":"15db78782c15d970","type":"group","z":"311fc27fae3e469a","g":"005e3977faddc2b6","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["855d5c932a356cd8","ae74d6e72febf7a8","082d300a5a0ed2a0","ddb13ceb1cf145fa","394533721c7623f3","ce8b691ae8e00c7a","a5e08080d8cb83be","e8ad5930198a82cb","15fdddf3b859a30c"],"x":72.183349609375,"y":2039},{"id":"cc4688143a5d1e7f","type":"group","z":"311fc27fae3e469a","g":"005e3977faddc2b6","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["7dace6de2811a2d7","eef4bf3db86b25c7","1259390c5aaeb717","ecc3fbb7927dc297","908541f6313eb53a","6c73b0770dd83c5f","0bd5844d06a1f25a","86b269d2760cefe3","5ec8448119cd55cd"],"x":72.183349609375,"y":2459},{"id":"34080c1dbceb7ad9","type":"group","z":"311fc27fae3e469a","g":"005e3977faddc2b6","style":{"stroke":"#999999","stroke-opacity":"1","fill":"none","fill-opacity":"1","label":true,"label-position":"nw","color":"#a4a4a4"},"nodes":["63278947e277a91a","1b23b7583cc49687","07e8f4ddd2f4194f","f8fa62ad9c76586f","13705e1701b7c8f5","334439e9ad50d741","7279b92a9ac92bd0","23c547bf67532699","15bf76f010f53a80","785b7cd18f6b5a7f"],"x":94,"y":2819},{"id":"addc1f83e38cdc0b","type":"serial-port","serialport":"/dev/tty-onduleur","serialbaud":"2400","databits":"8","parity":"none","stopbits":"1","waitfor":"","dtr":"none","rts":"none","cts":"none","dsr":"none","newline":"\\r","bin":"false","out":"char","addchar":"","responsetimeout":"900"},{"id":"215683.1452d97e","type":"mqtt-broker","name":"MQTT-Onduleur","broker":"localhost","port":"1883","clientid":"","autoConnect":true,"usetls":false,"compatmode":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"autoUnsubscribe":true,"birthTopic":"","birthQos":"1","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willPayload":"","willMsg":{},"userProps":"","sessionExpiry":""},{"id":"d385c0890c50f354","type":"server","name":"Home Assistant","version":5,"addon":false,"rejectUnauthorizedCerts":false,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true,"heartbeat":true,"heartbeatInterval":"30","areaSelector":"friendlyName","deviceSelector":"friendlyName","entitySelector":"friendlyName","statusSeparator":": ","statusYear":"hidden","statusMonth":"short","statusDay":"numeric","statusHourCycle":"default","statusTimeFormat":"h:m","enableGlobalContextStore":true},{"id":"edfa42941985bec9","type":"ui_tab","name":"MQTT-Broker-Externe","icon":"dashboard","order":44,"disabled":false,"hidden":false},{"id":"d42e3ffd06c87a38","type":"ui_tab","name":"Paramètres généraux","icon":"fa-key ","order":7,"disabled":false,"hidden":false},{"id":"a82ceafb0dd752dc","type":"server","name":"Home Assistant","addon":true},{"id":"c97474b7dd5fdf3b","type":"server","name":"Home Assistant","version":5,"addon":true,"rejectUnauthorizedCerts":true,"ha_boolean":"y|yes|true|on|home|open","connectionDelay":true,"cacheJson":true,"heartbeat":false,"heartbeatInterval":"30","areaSelector":"friendlyName","deviceSelector":"friendlyName","entitySelector":"friendlyName","statusSeparator":": ","statusYear":"hidden","statusMonth":"short","statusDay":"numeric","statusHourCycle":"default","statusTimeFormat":"h:m","enableGlobalContextStore":true},{"id":"a144206f0ce5be54","type":"ui_base","theme":{"name":"theme-light","lightTheme":{"default":"#0094CE","baseColor":"#0094CE","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":true,"reset":false},"darkTheme":{"default":"#097479","baseColor":"#097479","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif","edited":false},"customTheme":{"name":"Untitled Theme 1","default":"#4B7930","baseColor":"#4B7930","baseFont":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"},"themeState":{"base-color":{"default":"#0094CE","value":"#0094CE","edited":false},"page-titlebar-backgroundColor":{"value":"#0094CE","edited":false},"page-backgroundColor":{"value":"#fafafa","edited":false},"page-sidebar-backgroundColor":{"value":"#ffffff","edited":false},"group-textColor":{"value":"#1bbfff","edited":false},"group-borderColor":{"value":"#ffffff","edited":false},"group-backgroundColor":{"value":"#ffffff","edited":false},"widget-textColor":{"value":"#111111","edited":false},"widget-backgroundColor":{"value":"#0094ce","edited":false},"widget-borderColor":{"value":"#ffffff","edited":false},"base-font":{"value":"-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Oxygen-Sans,Ubuntu,Cantarell,Helvetica Neue,sans-serif"}},"angularTheme":{"primary":"indigo","accents":"blue","warn":"red","background":"grey","palette":"light"}},"site":{"name":"Node-RED Dashboard","hideToolbar":"false","allowSwipe":"false","lockMenu":"false","allowTempTheme":"true","dateFormat":"DD/MM/YYYY","sizes":{"sx":48,"sy":48,"gx":6,"gy":6,"cx":6,"cy":6,"px":0,"py":0}}},{"id":"4e53f268.aaddbc","type":"ui_group","name":"Steckdosen","tab":"95d17d8a.8e1d8","order":1,"disp":true,"width":"6"},{"id":"95d17d8a.8e1d8","type":"ui_tab","name":"Schlafzimmer","icon":"fa-bed"},{"id":"cdf964dc2b62fe0d","type":"serial-port","serialport":"/dev/tty-pylontech","serialbaud":"115200","databits":"8","parity":"none","stopbits":"1","waitfor":"","dtr":"none","rts":"none","cts":"none","dsr":"none","newline":"\\r","bin":"false","out":"char","addchar":"","responsetimeout":"500"},{"id":"7e338418a47a4ce3","type":"ui_group","name":"Paramètre 02","tab":"334dd5675e56e56d","order":2,"disp":true,"width":"8","collapse":false},{"id":"0ec3bbed32305d0a","type":"ui_group","name":"Paramètre 26","tab":"334dd5675e56e56d","order":8,"disp":true,"width":"8","collapse":false,"className":""},{"id":"334dd5675e56e56d","type":"ui_tab","name":"Paramètres Onduleur","icon":"fa-cogs","order":3,"disabled":false,"hidden":false},{"id":"cfa9ab8e7cbc9831","type":"ui_group","name":"Paramètre 02","tab":"f4ab03f18f5573e3","order":2,"disp":true,"width":"8","collapse":false},{"id":"be4c35aeef96f238","type":"ui_group","name":"Paramètre 26","tab":"f4ab03f18f5573e3","order":8,"disp":true,"width":"8","collapse":false,"className":""},{"id":"f4ab03f18f5573e3","type":"ui_tab","name":"Paramètres Onduleur","icon":"fa-cogs","order":3,"disabled":false,"hidden":false},{"id":"0d589ea16120e0d9","type":"modbus-client","name":"SofarSolarInverter","clienttype":"simpleser","bufferCommands":true,"stateLogEnabled":false,"queueLogEnabled":false,"failureLogEnabled":true,"tcpHost":"127.0.0.1","tcpPort":"502","tcpType":"DEFAULT","serialPort":"/dev/tty-sofarsolar","serialType":"RTU-BUFFERD","serialBaudrate":"9600","serialDatabits":"8","serialStopbits":"1","serialParity":"none","serialConnectionDelay":"100","serialAsciiResponseStartDelimiter":"0x3A","unit_id":"1","commandDelay":"1","clientTimeout":"1000","reconnectOnTimeout":false,"reconnectTimeout":"5000","parallelUnitIdsAllowed":true,"showWarnings":true,"showLogs":true},{"id":"c9a4df3e21338d0a","type":"serial-port","serialport":"/dev/tty-junctek","serialbaud":"115200","databits":"8","parity":"none","stopbits":"1","waitfor":"","dtr":"none","rts":"none","cts":"none","dsr":"none","newline":"\\n","bin":"false","out":"char","addchar":"","responsetimeout":"10000"},{"id":"9c30aa33de5f8119","type":"ui_group","name":"KG-F 140 Données brutes","tab":"5752eb1b8caab0c9","order":4,"disp":true,"width":"28","collapse":false,"className":""},{"id":"44fa889a36e9e11c","type":"ui_group","name":"KG-F 140","tab":"5752eb1b8caab0c9","order":1,"disp":true,"width":"3","collapse":false,"className":""},{"id":"cba66bb9ef46fb85","type":"ui_group","name":"Jauges","tab":"5752eb1b8caab0c9","order":2,"disp":true,"width":15,"collapse":false,"className":""},{"id":"b26d33906e3f3e21","type":"influxdb","hostname":"127.0.0.1","port":"8086","protocol":"http","database":"database","name":"onduleur_db-InfluxDB-V2","usetls":false,"tls":"42c03d5.9fdf1c4","influxdbVersion":"1.8-flux","url":"http://127.0.0.1:8086","rejectUnauthorized":false},{"id":"5752eb1b8caab0c9","type":"ui_tab","name":"Junctek","icon":"dashboard","order":18,"disabled":true,"hidden":true},{"id":"42c03d5.9fdf1c4","type":"tls-config","name":"local-tls","cert":"","key":"","ca":"","certname":"","keyname":"","caname":"","verifyservercert":false},{"id":"419f10df0856f270","type":"modbus-client","name":"","clienttype":"simpleser","bufferCommands":true,"stateLogEnabled":false,"queueLogEnabled":false,"failureLogEnabled":true,"tcpHost":"/dev/tty-easun","tcpPort":"9600","tcpType":"DEFAULT","serialPort":"/dev/tty-easun","serialType":"RTU-BUFFERD","serialBaudrate":"9600","serialDatabits":"8","serialStopbits":"1","serialParity":"none","serialConnectionDelay":"100","serialAsciiResponseStartDelimiter":"0x3A","unit_id":1,"commandDelay":1,"clientTimeout":1000,"reconnectOnTimeout":true,"reconnectTimeout":2000,"parallelUnitIdsAllowed":true,"showWarnings":true,"showLogs":true},{"id":"efc5bdb3115a929b","type":"mqtt-broker","name":"HomeAssistantMQTT","broker":"192.168.0.XXX","port":"1883","clientid":"","autoConnect":true,"usetls":false,"protocolVersion":"4","keepalive":"60","cleansession":true,"autoUnsubscribe":true,"birthTopic":"","birthQos":"0","birthRetain":"false","birthPayload":"","birthMsg":{},"closeTopic":"","closeQos":"0","closeRetain":"false","closePayload":"","closeMsg":{},"willTopic":"","willQos":"0","willRetain":"false","willPayload":"","willMsg":{},"userProps":"","sessionExpiry":""},{"id":"e3d2b4d505d7c3b1","type":"inject","z":"797691c1e8d3bbb1","g":"70c1f0ed78b559f7","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":130,"y":60,"wires":[["d3a91a0be3d32cfa"]]},{"id":"d3a91a0be3d32cfa","type":"file in","z":"797691c1e8d3bbb1","g":"70c1f0ed78b559f7","name":"","filename":"/data/options.json","filenameType":"str","format":"utf8","chunk":false,"sendError":false,"encoding":"none","allProps":false,"x":510,"y":60,"wires":[["6a484576febf2df9"]]},{"id":"6a484576febf2df9","type":"json","z":"797691c1e8d3bbb1","g":"70c1f0ed78b559f7","name":"","property":"payload","action":"","pretty":false,"x":730,"y":60,"wires":[["c5b68a34de9a9c28"]]},{"id":"c5b68a34de9a9c28","type":"function","z":"797691c1e8d3bbb1","g":"70c1f0ed78b559f7","name":"function 1","func":"//onduleur\nglobal.set(\"onduleurType\", msg.payload.onduleur); //type d'onduleur\nglobal.set(\"onduleurUsbPort\", msg.payload.usbonduleur); // port usb\nglobal.set(\"onduleurElfinActive\", msg.payload.elfinonduleur); //Utilisation du elfin\nglobal.set(\"onduleurElfinAdresse\", msg.payload.elfinonduleurip); //adresse ip sous forme <<ip>>:<<port>>\nglobal.set(\"onduleurElfinPort\", msg.payload.elfinonduleurport); //adresse ip sous forme <<ip>>:<<port>>\n\n//Parametre généraux\nglobal.set(\"smartVersion\", msg.payload.version); \n\n//Nom Personalisé Onduleur\nglobal.set(\"nameOnduleur\", msg.payload.nameEntities.nameOnduleur); \nglobal.set(\"namePV\", msg.payload.nameEntities.namePV);\nglobal.set(\"namePV2\", msg.payload.nameEntities.namePV2);\nglobal.set(\"nameBatt_charge\", msg.payload.nameEntities.nameBatt_charge);\nglobal.set(\"nameBatt_batt_decharge\", msg.payload.nameEntities.nameBatt_batt_decharge);\nglobal.set(\"nameBatt_batt_chargedecharge\", msg.payload.nameEntities.nameBatt_batt_chargedecharge);\nglobal.set(\"nameConso_maison\", msg.payload.nameEntities.nameConso_maison);\nglobal.set(\"nameGridTension\", msg.payload.nameEntities.nameGridTension);\nglobal.set(\"nameBattTensiont\", msg.payload.nameEntities.nameBattTensiont);\nglobal.set(\"namePvTensiont\", msg.payload.nameEntities.namePvTensiont);\nglobal.set(\"namePv2Tensiont\", msg.payload.nameEntities.namePv2Tensiont);\nglobal.set(\"nameOnduleurTension\", msg.payload.nameEntities.nameOnduleurTension);\nglobal.set(\"namePvIntensite\", msg.payload.nameEntities.namePvIntensite);\nglobal.set(\"namePv2Intensite\", msg.payload.nameEntities.namePv2Intensite);\nglobal.set(\"nameBattChargeIntensite\", msg.payload.nameEntities.nameBattChargeIntensite);\nglobal.set(\"nameBattDechargeIntensite\", msg.payload.nameEntities.nameBattDechargeIntensite);\nglobal.set(\"nameOnduleurFrequency\", msg.payload.nameEntities.nameOnduleurFrequency);\nglobal.set(\"nameDataFrequency\", msg.payload.nameEntities.nameDataFrequency);\nglobal.set(\"nameBattCapacite\", msg.payload.nameEntities.nameBattCapacite);\nglobal.set(\"nameMode\", msg.payload.nameEntities.nameMode);\nglobal.set(\"nameTemp\", msg.payload.nameEntities.nameTemp);\nglobal.set(\"nameParam01\", msg.payload.nameEntities.nameParam01);\nglobal.set(\"nameParam02\", msg.payload.nameEntities.nameParam02);\nglobal.set(\"nameParam05\", msg.payload.nameEntities.nameParam05);\nglobal.set(\"nameParam11\", msg.payload.nameEntities.nameParam11);\nglobal.set(\"nameParam12\", msg.payload.nameEntities.nameParam12);\nglobal.set(\"nameParam13\", msg.payload.nameEntities.nameParam13);\nglobal.set(\"nameParam16\", msg.payload.nameEntities.nameParam16);\nglobal.set(\"nameParam27\", msg.payload.nameEntities.nameParam27);\nglobal.set(\"nameParam29\", msg.payload.nameEntities.nameParam29);\n\n\n\n//Batterie\n\nglobal.set(\"battNb\", '0'); //nb batterie par defaut\nglobal.set(\"batterieType\", msg.payload.batterie); //type d'batterie\nglobal.set(\"battTension\", msg.payload.battTension); //type d'batterie\nglobal.set(\"batterieUsbPort\", msg.payload.usbbatterie); // port usb\nglobal.set(\"batterieElfinActive\", msg.payload.elfinbatterie); //Utilisation du elfin\nglobal.set(\"batterieElfinAdresse\", msg.payload.elfinbatterieip); //adresse ip sous forme <<ip>>:<<port>>\nglobal.set(\"batterieElfinPort\", msg.payload.elfinbatterieport); //adresse ip sous forme <<ip>>:<<port>>\n\n\n//mqtt patrametre\nglobal.set(\"mqttAdresse\", msg.payload.mqtt.mqttadresse); //type d'batterie\nglobal.set(\"mqttPort\", msg.payload.mqtt.mqttport); //type d'batterie\nglobal.set(\"mqttLogin\", msg.payload.mqtt.mqttuser); //type d'batterie\nglobal.set(\"mqttPassword\", msg.payload.mqtt.mqttpass); //type d'batterie\nglobal.set(\"mqttDirSmart\", \"smartphoton\");\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":860,"y":60,"wires":[["697f593b67e21ceb"]]},{"id":"a9d9bccb5f78a0bf","type":"debug","z":"797691c1e8d3bbb1","g":"605cc1d4fd3c9194","name":"debug 96","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1000,"y":320,"wires":[]},{"id":"0b09136cb66b1815","type":"inject","z":"797691c1e8d3bbb1","g":"605cc1d4fd3c9194","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":120,"y":320,"wires":[["a40cfac7d32275a8"]]},{"id":"697f593b67e21ceb","type":"debug","z":"797691c1e8d3bbb1","g":"70c1f0ed78b559f7","name":"debug 97","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1000,"y":60,"wires":[]},{"id":"4f62fd1b871f675c","type":"file in","z":"797691c1e8d3bbb1","g":"70c1f0ed78b559f7","name":"Fichier exemple de config","filename":"/media/smartphotonOptionsExemple.json","filenameType":"str","format":"utf8","chunk":false,"sendError":false,"encoding":"none","allProps":false,"x":490,"y":100,"wires":[["6a484576febf2df9"]]},{"id":"a40cfac7d32275a8","type":"function","z":"797691c1e8d3bbb1","g":"605cc1d4fd3c9194","name":"les globals","func":"msg.payload = 'onduleurType = '+global.get(\"onduleurType\")+'\\n'\n+'onduleurName = '+global.get(\"onduleurName\")+'\\n' // port usb\n+'onduleurUsbPort = '+global.get(\"onduleurUsbPort\")+'\\n' // port usb\n+'onduleurElfinActive = '+global.get(\"onduleurElfinActive\")+'\\n' //Utilisation du elfin\n+'onduleurElfinAdresse = '+global.get(\"onduleurElfinAdresse\")+'\\n' //adresse ip sous forme <<ip>>:<<port>>\n+'onduleurElfinPort = '+global.get(\"onduleurElfinPort\")+'\\n' //adresse ip sous forme <<ip>>:<<port>>\n+ 'smartVersion = ' + global.get(\"onduleurElfinPort\") + '\\n' //version\n\n//Batterie\n+'batterieType = '+global.get(\"batterieType\")+'\\n' //type d'batterie battTension\n+'battTension = '+global.get(\"battTension\")+'\\n' //type d'batterie battTension\n+'batterieUsbPort = '+global.get(\"batterieUsbPort\")+'\\n' // port usb\n+'batterieElfinActive = '+global.get(\"batterieElfinActive\")+'\\n' //Utilisation du elfin\n+'batterieElfinAdresse = '+global.get(\"batterieElfinAdresse\")+'\\n' //adresse ip sous forme <<ip>>:<<port>>\n+'batterieElfinPort = '+global.get(\"batterieElfinPort\")+'\\n' //adresse ip sous forme <<ip>>:<<port>>\n\n\n//mqtt\n+'mqttAdresse = '+global.get(\"mqttAdresse\")+'\\n' //type d'batterie\n+'mqttPort = '+global.get(\"mqttPort\")+'\\n' //type d'batterie\n+'mqttLogin = '+global.get(\"mqttLogin\")+'\\n' //type d'batterie\n+ 'mqttPassword = ' + global.get(\"mqttPassword\")+'\\n' //type d'batterie\n+ 'mqttDirSmart = ' + global.get(\"mqttDirSmart\")+'\\n' //type d'batterie\n\n\n\n;\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":510,"y":320,"wires":[["a9d9bccb5f78a0bf"]]},{"id":"4ef89226ddebe9b3","type":"inject","z":"797691c1e8d3bbb1","g":"20c77bec28bfdfda","name":"connect","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":120,"y":420,"wires":[["cc37c11c33756143"]]},{"id":"cc37c11c33756143","type":"function","z":"797691c1e8d3bbb1","g":"20c77bec28bfdfda","name":"function 2","func":"msg.action = \"connect\";\nmsg.broker = '{\"broker\":\"'+global.get(\"mqttAdresse\")+'\",'\n    +'\"port\":\"'+global.get(\"mqttPort\")+'\",'\n    +'\"username\":\"'+global.get(\"mqttLogin\")+'\",'\n    +'\"password\":\"'+global.get(\"mqttPassword\")+'\"'\n    +'}';\nreturn msg\n\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":520,"y":420,"wires":[["5ee485bdb3085557"]]},{"id":"358d596529460ec8","type":"mqtt out","z":"797691c1e8d3bbb1","g":"20c77bec28bfdfda","name":"MQTT external broker","topic":"","qos":"1","retain":"","respTopic":"","contentType":"","userProps":"","correl":"","expiry":"","broker":"215683.1452d97e","x":980,"y":460,"wires":[]},{"id":"1886e97a550fdebe","type":"inject","z":"797691c1e8d3bbb1","g":"20c77bec28bfdfda","name":"disconnect","props":[{"p":"payload"},{"p":"action","v":"disconnect","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"0.5","topic":"","payload":"","payloadType":"date","x":130,"y":460,"wires":[["358d596529460ec8"]]},{"id":"5ee485bdb3085557","type":"json","z":"797691c1e8d3bbb1","g":"20c77bec28bfdfda","name":"","property":"broker","action":"","pretty":false,"x":710,"y":420,"wires":[["358d596529460ec8"]]},{"id":"58815987c51e2a0f","type":"link in","z":"797691c1e8d3bbb1","g":"20c77bec28bfdfda","name":"vers mqtt","links":["7c9abb7911544a7a","9d7fd01459b6ac62","91b4f1d5257e5d9d","1b72dae0e2e4ab32","3434bec9d9aaa775","d9d81b36d6c854ea","bc6941ceabf4c9a3","cf7364b81226b4db","1e0ae2d1c090b3f7","3ca8ce2e0e5e0d9a","63061f1830edc9a6","b78f48af0b8f9fdf","1ef225b44346b020","b949139220858ce3","6b6bb33c30fda3fc","c122c02ed209a876","a0f9067443b3fb45","cbba3299b8acb3a1","d35082aabcb56e3e","921742960bab417d","c1fa8d256a752aeb","12b888f647a6d4e2","5432883edede86bd","2a6f24b92d300724","922f1fed2f365880","4c02c3c2433e945b"],"x":745,"y":500,"wires":[["358d596529460ec8"]]},{"id":"65c1fe8e5a4260a0","type":"exec","z":"797691c1e8d3bbb1","d":true,"g":"60183840d1a1fbf0","command":"cp /data/options.json /media/smartphotonOptionsExemple.json","addpay":"","append":"","useSpawn":"false","timer":"","winHide":false,"oldrc":false,"name":"","x":850,"y":200,"wires":[[],[],[]]},{"id":"291f484d3a35166a","type":"inject","z":"797691c1e8d3bbb1","g":"60183840d1a1fbf0","name":"Récupération config dans addon","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":190,"y":200,"wires":[["65c1fe8e5a4260a0"]]},{"id":"d4dbea17adb8abb7","type":"serial request","z":"9c0ee1028b125264","g":"c73322e02c5f8ecb","name":"","serial":"addc1f83e38cdc0b","x":570,"y":280,"wires":[["74dc98f8102cb944","500c2cc0b7e98c26"]]},{"id":"74dc98f8102cb944","type":"debug","z":"9c0ee1028b125264","g":"c73322e02c5f8ecb","name":"onduleur","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":760,"y":300,"wires":[]},{"id":"80126da2d8f7672a","type":"link in","z":"9c0ee1028b125264","name":"To-serial-in","links":["c06bf19f10407755","821bfac041a24023","075c7d3a094dbe33","6218310587649cd5","cfc65a37fbb89d4e","b425d2dfce5aa97d","ced7561d749391f6","891e77bd310e2f34","224761e55dbf5b9d","602622141b522b02","2c515b2f4787c285","8bc88be9d63ed467","70419491e9a79195","da4858fc56ac7375","97c5e50fee41c9d6","9e0ce93fc601cbcf","d4d7f11b6a7edaee","1ef9c185afe716d3","7712950f4b12a6ae","92e405f166b1a9aa","0117f3595fe34dd7","676237256c703acf","25c963b7cf639d9c","960ead0398837b9e","e0bb27810ea9d084","6556ba4092c1de3a","9e8d19291bafaff0","4067c57f7662f57e","10cd188955207108","712f0b9f87ba70b3","f2cc04c41c474905","6f515d6d6f0013f5","3aaded097cffaa90","cbc780218fd24207","7c6224af0298d4d6","0a26af9f25c8825f","5c745d1e2285feb7","252cd27273af1053","f71ed7bf3469e7fe"],"x":55,"y":220,"wires":[["3e58f6c9f1439a9b"]]},{"id":"6da2bb26e30ffdfe","type":"debug","z":"9c0ee1028b125264","g":"93f4b0f6c7c003ae","name":"to-GW","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"host","targetType":"msg","statusVal":"","statusType":"auto","x":770,"y":140,"wires":[]},{"id":"1a04c804b2d9b026","type":"function","z":"9c0ee1028b125264","g":"93f4b0f6c7c003ae","name":"Add TCP Server Ip onduleur","func":"msg.host = global.get(\"onduleurElfinAdresse\");\nmsg.port = global.get(\"onduleurElfinPort\");\nreturn msg;","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":180,"wires":[["602df7fcc809f17f","6da2bb26e30ffdfe"]]},{"id":"602df7fcc809f17f","type":"tcp request","z":"9c0ee1028b125264","g":"93f4b0f6c7c003ae","name":"GW Elfin Rs232","server":"","port":"","out":"sit","ret":"string","splitc":" ","newline":"","trim":false,"tls":"","x":840,"y":180,"wires":[["11edec69ac2c9440"]]},{"id":"e83039f408491510","type":"debug","z":"9c0ee1028b125264","g":"93f4b0f6c7c003ae","name":"Elfin Rs232 Onduleur","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":960,"y":140,"wires":[]},{"id":"8ba9d5a59e6dee3c","type":"delay","z":"9c0ee1028b125264","g":"93f4b0f6c7c003ae","name":"Limit 1 msg / 400 [ms]","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"0.4","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":380,"y":180,"wires":[["1a04c804b2d9b026"]]},{"id":"ab85318b13524dfe","type":"link in","z":"9c0ee1028b125264","g":"78c8b76577708c4d","name":"Parsing-response-in","links":["62edb1adc67806fc","09162026c5bf4567","500c2cc0b7e98c26","63008318801458fe","e26743c9fd626fdc"],"x":75,"y":420,"wires":[["efea33497c071b44","efd023f511690a18"]]},{"id":"62edb1adc67806fc","type":"link out","z":"9c0ee1028b125264","g":"93f4b0f6c7c003ae","name":"Parsing-response-ou","mode":"link","links":["ab85318b13524dfe","09d7cdb8321645bf","dea3b19c200252de","0315d76cd6d49376"],"x":1085,"y":180,"wires":[]},{"id":"500c2cc0b7e98c26","type":"link out","z":"9c0ee1028b125264","g":"c73322e02c5f8ecb","name":"Parsing-response-ou","mode":"link","links":["ab85318b13524dfe","09d7cdb8321645bf","dea3b19c200252de","0315d76cd6d49376"],"x":1085,"y":280,"wires":[]},{"id":"c9fd372e65fbd09d","type":"delay","z":"9c0ee1028b125264","g":"c73322e02c5f8ecb","name":"Limit 1 msg / 0.5 [s]","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"0.5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":370,"y":280,"wires":[["d4dbea17adb8abb7"]]},{"id":"11edec69ac2c9440","type":"split","z":"9c0ee1028b125264","g":"93f4b0f6c7c003ae","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":990,"y":180,"wires":[["62edb1adc67806fc","e83039f408491510"]]},{"id":"efea33497c071b44","type":"function","z":"9c0ee1028b125264","g":"78c8b76577708c4d","name":"Tri Q...","func":"msg.payload = msg.payload.slice(1, -3);\nmsg.payload = msg.payload.split(' ');\n\n// msg.payload.length\n//Nomage préfix\nvar name = msg.topic + '_';\nmsg.type = msg.topic;\nvar payload = msg.payload\nvar count = msg.payload.length\n\nfor (let i = 0; i <= count; i++) {\n  \n  msg.payload = payload[i];\n  \n  msg.topic = global.get(\"mqttDirSmart\") + '/' + global.get(\"onduleurType\") + '/' + name + i;\n  node.send(msg);\n\n}\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":180,"y":460,"wires":[["99f51f01d55bdc87","531ff80b4a69e7c3","af37b8e53dc2b591"]]},{"id":"efd023f511690a18","type":"function","z":"9c0ee1028b125264","g":"78c8b76577708c4d","name":"Calcul","func":"msg.payload = msg.payload.slice(1, -3);\nmsg.payload = msg.payload.split(' ');\nlet name = 'custom_'; //préfix custom\n\nif (msg.topic == \"qpig\") {\n\n    //numéro du calcul\n    let tab = [\"1_battChargeWatt\", \"2_battDechargeWatt\", \"3_battChargeDechargeWatt\"]\n\n\n    let payload = msg.payload\n    let count = tab.length //compte le nombre du tableau \n\n\n    for (let i = 1; i <= count; i++) {\n\n        /*-------------------------------------------------*/\n        //1 Batterie charge en watt\n        /*-------------------------------------------------*/\n        if (i == 1) {\n\n            //calcul\n            let charge = payload[9] * payload[8];\n            msg.payload = charge.toFixed(2);\n        }\n\n        /*-------------------------------------------------*/\n        //2 Batterie Decharge en watt\n        /*-------------------------------------------------*/\n        if (i == 2) {\n\n            //calcul\n            let decharge = payload[15] * payload[8];\n            msg.payload = decharge.toFixed(2);\n        }\n\n        //nouveau Parametre pour mqtt en custom\n        msg.topic = global.get(\"mqttDirSmart\") + '/' + global.get(\"onduleurType\") + '/' + name + i;\n        node.send(msg);\n\n        /*-------------------------------------------------*/\n        //3 Batterie charge positive, Decharge négative en watt\n        /*-------------------------------------------------*/\n        if (i == 3) {\n\n            let charge = payload[9] * payload[8];\n            let decharge = payload[15] * payload[8];\n            \n            if (charge >= 0 && decharge == 0) {\n\n                msg.payload = charge.toFixed(2);\n                \n            }else if (charge == 0 && decharge >= 0){\n\n                decharge = -decharge;\n                msg.payload = decharge.toFixed(2);\n\n            }else{\n\n                msg.payload = 0;\n\n            }\n\n        }\n        //nouveau Parametre pour mqtt en custom\n        msg.topic = global.get(\"mqttDirSmart\") + '/' + global.get(\"onduleurType\") + '/' + name + i;\n        node.send(msg);\n    }\n\n\n\n   \n\n/*qpgsn*/\n}else{\n\n    \n    for (let i = 2; i <= 8; i++) {\n            let topic = \"qpgs\" + i;\n            if (global.get( '' + topic + '' ) != 'false' && msg.topic == topic){\n                \n                let payload = msg.payload\n                \n                /*-------------------------------------------------*/\n                //1 Batterie charge en watt qpgs\n                /*-------------------------------------------------*/\n\n                let charge = payload[11] * payload[12];\n                msg.payload = charge.toFixed(2);\n\n                msg.topic = global.get(\"mqttDirSmart\") + '/' + global.get(\"onduleurType\") + '/' + name + i + '01';\n                node.send(msg);\n\n\n\n                /*-------------------------------------------------*/\n                //2 Batterie Decharge en watt qpgs\n                /*-------------------------------------------------*/\n                charge = payload[11] * payload[26];\n                msg.payload = charge.toFixed(2);\n\n                msg.topic = global.get(\"mqttDirSmart\") + '/' + global.get(\"onduleurType\") + '/' + name + i + '02';\n                node.send(msg);\n\n\n\n                /*-------------------------------------------------*/\n                //3 Batterie charge positive, Decharge négative en watt qpgs\n                /*-------------------------------------------------*/\n\n                charge = payload[11] * payload[12];\n                let decharge = payload[11] * payload[26];;\n\n                if (charge >= 0 && decharge == 0) {\n\n                    msg.payload = charge.toFixed(2);\n\n                } else if (charge == 0 && decharge >= 0) {\n\n                    decharge = -decharge;\n                    msg.payload = decharge.toFixed(2);\n\n                } else {\n\n                    msg.payload = 0;\n\n                }\n\n                msg.topic = global.get(\"mqttDirSmart\") + '/' + global.get(\"onduleurType\") + '/' + name + i + '03';\n                node.send(msg);\n\n\n                /*-------------------------------------------------*/\n                //Calul input pv watt qpgs\n                /*-------------------------------------------------*/\n\n                //calcul\n                charge = payload[14] * payload[25];\n                msg.payload = charge.toFixed(2);\n\n                msg.topic = global.get(\"mqttDirSmart\") + '/' + global.get(\"onduleurType\") + '/' + name + i + '10';\n                node.send(msg);\n\n\n            }\n    }\n\n    /*\n    for (let i = 2; i <= 8; i++) {\n        let topic = \"qpgs\" + i;\n        if (global.get('' + topic + '') != 'false' && msg.topic == topic) {\n\n            let payload = msg.payload\n\n            \n        }\n    }\n\n\n   \n    for (let i = 2; i <= 8; i++) {\n            let topic = \"qpgs\" + i;\n            if (global.get( '' + topic + '' ) != 'false' && msg.topic == topic){\n                \n                \n            }\n    }\n\n   \n\n    \n    for (let i = 2; i <= 8; i++) {\n            let topic = \"qpgs\" + i;\n            if (global.get( '' + topic + '' ) != 'false' && msg.topic == topic){\n                \n                let payload = msg.payload\n                \n                \n            }\n    }\n*/\n}","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":180,"y":420,"wires":[["1e0ae2d1c090b3f7"]]},{"id":"99f51f01d55bdc87","type":"function","z":"9c0ee1028b125264","g":"78c8b76577708c4d","name":"Transformation des parametres","func":"if (msg.payload != \"NAK\") {\n    if ( msg.type == \"qpiri\"){\n        \n\n        /***********qmod **************/\n        let dir = global.get(\"mqttDirSmart\") + '/' + global.get(\"onduleurType\") + '/qpiri_';\n\n        /*-------------------------------------------------*/\n        //parametre 01\n        /*-------------------------------------------------*/\n        if (msg.topic == dir + '16') {\n\n            let str = msg.payload;\n\n            //option remplace\n            msg.payload = (msg.payload == 0) ? msg.payload = \"UTI\" :\n                        (msg.payload == 1) ? msg.payload = \"SOL\" :\n                        (msg.payload == 2) ? msg.payload = \"SBU\" :\n                        msg.payload;\n            node.send(msg);\n\n        /*-------------------------------------------------*/\n        //parametre 05\n        /*-------------------------------------------------*/\n        }else if (msg.topic == dir + '12') {\n\n            let str = msg.payload;\n\n            //option remplace\n            msg.payload = (msg.payload == 0) ? msg.payload = \"AGn\" :\n                        (msg.payload == 1) ? msg.payload = \"FLd\" :\n                        (msg.payload == 2) ? msg.payload = \"USE\" :\n                        (msg.payload == 3) ? msg.payload = \"PYL\" :\n                        (msg.payload == 4) ? msg.payload = \"uEC\" :\n                        (msg.payload == 5) ? msg.payload = \"SOL\" :\n                        (msg.payload == 6) ? msg.payload = \"LIb\" :\n                        (msg.payload == 7) ? msg.payload = \"LIC\" :\n                        msg.payload;\n            node.send(msg);\n        \n\n        /*-------------------------------------------------*/\n        //parametre 11\n        /*-------------------------------------------------*/\n        }else if (msg.topic == dir + '13') {\n\n            let count = msg.payload.length;\n            global.set(\"voltronic_param11_count\", count);\n            //option remplace\n            msg.payload = (msg.payload == \"002\") ? msg.payload = \"02\" :\n                        (msg.payload == \"010\") ? msg.payload = \"10\" :\n                        (msg.payload == \"020\") ? msg.payload = \"20\" :\n                        (msg.payload == \"030\") ? msg.payload = \"30\" :\n                        (msg.payload == \"040\") ? msg.payload = \"40\" :    \n                        (msg.payload == \"050\") ? msg.payload = \"50\" :    \n                        (msg.payload == \"060\") ? msg.payload = \"60\" :    \n                        (msg.payload == \"070\") ? msg.payload = \"70\" :      \n                        (msg.payload == \"080\") ? msg.payload = \"80\" :    \n                        (msg.payload == \"090\") ? msg.payload = \"90\" :    \n                        (msg.payload == \"100\") ? msg.payload = \"100\" :\n                        (msg.payload == \"110\") ? msg.payload = \"110\" :\n                        (msg.payload == \"120\") ? msg.payload = \"120\" :\n                        msg.payload;\n            node.send(msg);\n        \n        \n        /*-------------------------------------------------*/\n        //parametre 16\n        /*-------------------------------------------------*/\n        }else if (msg.topic == dir + '17') {\n\n            let str = msg.payload;\n\n            //option remplace\n            msg.payload = (msg.payload == 0) ? msg.payload = \"CUE\" :\n                    (msg.payload == 1) ? msg.payload = \"CSO\" :\n                    (msg.payload == 2) ? msg.payload = \"SNU\" :\n                    (msg.payload == 3) ? msg.payload = \"OSO\" :\n                    msg.payload;\n\n            node.send(msg);\n\n        \n        }else{\n\n            msg.payload = msg.payload;\n            msg.type = msg.type;\n            msg.topic = msg.topic;\n            node.send(msg);\n        }\n\n    }else if (msg.type == \"qmod\") {\n\n        /***********qmod **************/\n        let dir = global.get(\"mqttDirSmart\") + '/' + global.get(\"onduleurType\") + '/qmod_';\n\n\n        /*-------------------------------------------------*/\n        //solar mode\n        /*-------------------------------------------------*/\n        if (msg.topic == dir + '0') {\n\n        \n\n            //option remplace\n                msg.payload = (msg.payload == \"B\") ? msg.payload = \"solaire\" :\n                              (msg.payload == \"L\") ? msg.payload = \"edf\" :\n                              (msg.payload == \"F\") ? msg.payload = \"Fault\" :\n                              (msg.payload == \"D\") ? msg.payload = \"Shutdown\" :\n                              (msg.payload == \"S\") ? msg.payload = \"Standby\" :\n                              (msg.payload == \"P\") ? msg.payload = \"Power\" :\n                               msg.payload;\n\n                node.send(msg);\n\n                \n\n        }else{\n\n            msg.payload = msg.payload;\n            msg.type = msg.type;\n            msg.topic = msg.topic;\n            node.send(msg);\n        }\n\n    /***********qpgs **************/\n    }else if(msg.type == \"qpgs2\" || msg.type ==  \"qpgs3\"  || msg.type ==  \"qpgs4\"  || msg.type ==  \"qpgs5\"  || msg.type ==  \"qpgs6\"  || msg.type ==  \"qpgs7\"  || msg.type ==  \"qpgs8\"  || msg.type ==  \"qpgs9\" ){\n\n        // Chemin du qpgs\n        let dir = global.get(\"mqttDirSmart\") + '/' + global.get(\"onduleurType\") + '/qpgs';\n\n        /*--------------------------------------------------*/\n        //Nouveau format de vérification avec boucle\n        /*--------------------------------------------------*/\n\n        //vérification si qpgs existe de 1 à 8\n        for (let i = 2; i <= 8; i++) {\n            if (msg.topic == dir + i +'_0'){\n\n                //si qpgsx_0 est 0 ou nak on le désactive en l'affichant dans une global \"false\"\n                if (msg.payload == 0 || msg.payload == 'NAK'){\n\n                    global.set(msg.type, 'false'); \n                \n                //sinon on envoie les valeurs\n                }else{\n                    \n                    msg.payload = msg.payload;\n                    msg.type = msg.type;\n                    msg.topic = msg.topic;\n                    node.send(msg);\n                }\n\n            // si valeur 2 Work mode\n            }else if (msg.topic == dir + i + '_2') {\n\n                \n\n                //option remplace\n                msg.payload = (msg.payload == \"B\") ? msg.payload = \"solaire\" :\n                              (msg.payload == \"L\") ? msg.payload = \"edf\" :\n                              (msg.payload == \"F\") ? msg.payload = \"Fault\" :\n                              (msg.payload == \"D\") ? msg.payload = \"Shutdown\" :\n                              (msg.payload == \"S\") ? msg.payload = \"Standby\" :\n                              (msg.payload == \"P\") ? msg.payload = \"Power\" :\n                               msg.payload;\n\n                node.send(msg);\n\n            \n\n            // on envoie les autres valeurs\n            }else{\n                \n                msg.payload = msg.payload;\n                msg.type = msg.type;\n                msg.topic = msg.topic;\n                node.send(msg);\n            }\n\n        }\n\n        /*--------------------------------------------------*/\n        //Fin Nouveau format de vérification avec boucle\n        /*--------------------------------------------------*/\n\n        /*\n        //vérification si qpgs existe de 1 à 8\n        if (msg.topic == dir + '2_0' || msg.topic ==  dir + '3_0' || msg.topic ==  dir + '4_0' || msg.topic ==  dir + '5_0' || msg.topic == dir + '6_0' || msg.topic == dir + '7_0' || msg.topic == dir + '8_0' || msg.topic == dir + '9_0') {\n            \n            //si qpgsx_0 est 0 ou nak on le désactive en l'affichant dans une global \"false\"\n            if (msg.payload == 0 || msg.payload == 'NAK'){\n\n              global.set(msg.type, 'false'); \n            \n            //sinon on envoie les valeurs\n            }else{\n                \n                msg.payload = msg.payload;\n                msg.type = msg.type;\n                msg.topic = msg.topic;\n                node.send(msg);\n            }\n        \n        // on envoie les autres valeurs\n        }else{\n                \n            msg.payload = msg.payload;\n            msg.type = msg.type;\n            msg.topic = msg.topic;\n            node.send(msg);\n        }\n        */\n        \n    //on envoie les autres valeurs\n    }else{\n\n        msg.payload = msg.payload;\n        msg.type = msg.type;\n        msg.topic = msg.topic;\n        node.send(msg);\n    }\n\n//si qpigs2 est egal à nak\n}else if(msg.type == \"qpigs2\" && msg.payload == \"NAK\"){\n\n    //ajout NAK au global\n    global.set(msg.type, msg.payload); \n\n// si qpgs1 est égal à nak\n}else if(msg.type == \"qpgs1\" && msg.payload == \"NAK\"){\n\n    //ajout NAK au global\n    global.set(msg.type, msg.payload); \n\n//sinon on fait rien\n}else{\n    \n}\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":860,"y":460,"wires":[["1e0ae2d1c090b3f7"]]},{"id":"1e0ae2d1c090b3f7","type":"link out","z":"9c0ee1028b125264","g":"78c8b76577708c4d","name":"link out 12","mode":"link","links":["58815987c51e2a0f","a826c052e06f7959"],"x":1085,"y":420,"wires":[]},{"id":"e7b0a2a9babd283a","type":"mqtt in","z":"9c0ee1028b125264","g":"a5dcfaf2e3ab4964","name":"mqtt in dynamique","topic":"","qos":"2","datatype":"auto-detect","broker":"215683.1452d97e","nl":false,"rap":true,"rh":0,"inputs":1,"x":510,"y":640,"wires":[["356d577dad88c0fd","948cdd1836b994fb"]]},{"id":"356d577dad88c0fd","type":"debug","z":"9c0ee1028b125264","g":"a5dcfaf2e3ab4964","name":"debug 105","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":730,"y":680,"wires":[]},{"id":"948cdd1836b994fb","type":"function","z":"9c0ee1028b125264","g":"a5dcfaf2e3ab4964","name":"Remplace mqtt => onduleur","func":"let dir = global.get(\"mqttDirSmart\") + '/' + global.get(\"onduleurType\") + '-Modification/Param';\nlet payload = '';\n\n\n\n\n/*-------------------------------------------------*/\n//parametre 01\n/*-------------------------------------------------*/\nif (msg.topic == dir + '01') {\n\n    let str = msg.payload;\n    msg.topic = 'msg.topic';\n\n    //option remplace\n    payload = (msg.payload == \"UTI\") ? new Buffer([80,79,80,48,48,194,72,13]) :\n              (msg.payload == \"SOL\") ? new Buffer([80,79,80,48,49,210,105,13]) :\n              (msg.payload == \"SBU\") ? new Buffer([80,79,80,48,50,226,11,13]) :\n               'Erreur';\n\n}\n\n/*-------------------------------------------------*/\n//parametre 02\n/*-------------------------------------------------*/\nif (msg.topic == dir + '02') {\n\n    let str = msg.payload;\n    msg.topic = 'msg.topic';\n\n    //option remplace\n    payload = (msg.payload == \"010\" && global.get(\"qpgs1\") == \"NAK\") ? new Buffer([77,78,67,72,71,67,48,49,48,77,185,13]) :\n              (msg.payload == \"020\" && global.get(\"qpgs1\") == \"NAK\") ? new Buffer([77,78,67,72,71,67,48,50,48,24,234,13]) :\n              (msg.payload == \"030\" && global.get(\"qpgs1\") == \"NAK\") ? new Buffer([77,78,67,72,71,67,48,51,48,43,219,13]) :\n              (msg.payload == \"040\" && global.get(\"qpgs1\") == \"NAK\") ? new Buffer([77,78,67,72,71,67,48,52,48,178,76,13]) :\n              (msg.payload == \"050\" && global.get(\"qpgs1\") == \"NAK\") ? new Buffer([77,78,67,72,71,67,48,53,48,129,125,13]) :\n              (msg.payload == \"060\" && global.get(\"qpgs1\") == \"NAK\") ? new Buffer([77,78,67,72,71,67,48,54,48,212,46,13]) :\n              (msg.payload == \"070\" && global.get(\"qpgs1\") == \"NAK\") ? new Buffer([77,78,67,72,71,67,48,55,48,231,31,13]) :\n              (msg.payload == \"080\" && global.get(\"qpgs1\") == \"NAK\") ? new Buffer([77,78,67,72,71,67,48,56,48,247,33,13]) :\n              (msg.payload == \"010\") ? new Buffer([77,78,67,72,71,67,48,48,49,48,18,59,13]) :\n              (msg.payload == \"020\") ? new Buffer([77,78,67,72,71,67,48,48,50,48,71,104,13]) :\n              (msg.payload == \"030\") ? new Buffer([77,78,67,72,71,67,48,48,51,48,116,89,13]) :\n              (msg.payload == \"040\") ? new Buffer([77,78,67,72,71,67,48,48,52,48,237,206,13]) :\n              (msg.payload == \"050\") ? new Buffer([77,78,67,72,71,67,48,48,53,48,222,255,13]) :\n              (msg.payload == \"060\") ? new Buffer([77,78,67,72,71,67,48,48,54,48,139,172,13]) :\n              (msg.payload == \"070\") ? new Buffer([77,78,67,72,71,67,48,48,55,48,184,157,13]) :\n              (msg.payload == \"080\") ? new Buffer([77,78,67,72,71,67,48,48,56,48,168,163,13]) :\n              (msg.payload == \"090\") ? new Buffer([77,78,67,72,71,67,48,48,57,48,155,146,13]) :\n              (msg.payload == \"0100\") ? new Buffer([77,78,67,72,71,67,48,48,49,48,48,63,32,13]) :\n              (msg.payload == \"0110\") ? new Buffer([77,78,67,72,71,67,48,48,49,49,48,193,16]) :\n              (msg.payload == \"0120\") ? new Buffer([77,78,67,72,71,67,48,48,49,50,48,89,66,13]) :\n              (msg.payload == \"0130\") ? new Buffer([77,78,67,72,71,67,48,48,49,51,48,106,115,13]) :\n                            'Erreur';\n\n}\n\n/*-------------------------------------------------*/\n//parametre 05\n/*-------------------------------------------------*/\nif (msg.topic == dir + '05') {\n\n    let str = msg.payload;\n    msg.topic = 'msg.topic';\n\n    //option remplace\n    payload = (msg.payload == \"AGn\") ? new Buffer([80,66,84,48,48,39,14,13]) :\n              (msg.payload == \"FLd\") ? new Buffer([80,66,84,48,49,55,47,13]) :\n              (msg.payload == \"USE\") ? new Buffer([80,66,84,48,50,7,76,13]) :\n              (msg.payload == \"PYL\") ? new Buffer([80,66,84,48,51,23,109,13]) :\n              (msg.payload == \"uEC\") ? new Buffer([80,66,84,48,52,103,138,13]) :\n              (msg.payload == \"SOL\") ? new Buffer([80,66,84,48,53,119,171,13]) :\n              (msg.payload == \"LIb\") ? new Buffer([80,66,84,48,54,71,200,13]) :\n              (msg.payload == \"LIc\") ? new Buffer([80,66,84,48,55,87,233,13]) :\n               'Erreur';\n\n}\n\n\n/*-------------------------------------------------*/\n//parametre 11\n/*-------------------------------------------------*/\nif (msg.topic == dir + '11') {\n\n    let str = msg.payload;\n    msg.topic = 'msg.topic';\n\n    //option remplace\n    payload = (msg.payload == \"02\" && global.get(\"voltronic_param11_count\") == 2) ? new Buffer([77,85,67,72,71,67,48,48,50,181,209,13]) :\n              (msg.payload == \"10\" && global.get(\"voltronic_param11_count\") == 2) ? new Buffer([77,85,67,72,71,67,48,49,48,166,162,13]) :\n              (msg.payload == \"20\" && global.get(\"voltronic_param11_count\") == 2) ? new Buffer([77,85,67,72,71,67,48,50,48,243,241,13]) :\n              (msg.payload == \"30\" && global.get(\"voltronic_param11_count\") == 2) ? new Buffer([77,85,67,72,71,67,48,51,48,192,192,13]) :\n              (msg.payload == \"50\" && global.get(\"voltronic_param11_count\") == 2) ? new Buffer([77,85,67,72,71,67,48,53,48,106,102,13]) :\n              (msg.payload == \"02\" && global.get(\"voltronic_param11_count\") == 3) ? new Buffer([77,85,67,72,71,67,48,48,48,50,86,13,13]) :\n              (msg.payload == \"10\" && global.get(\"voltronic_param11_count\") == 3) ? new Buffer([77,85,67,72,71,67,48,48,49,48,69,126,13]) :\n              (msg.payload == \"20\" && global.get(\"voltronic_param11_count\") == 3) ? new Buffer([77,85,67,72,71,67,48,48,50,48,16,45,13]) :\n              (msg.payload == \"30\" && global.get(\"voltronic_param11_count\") == 3) ? new Buffer([77,85,67,72,71,67,48,48,51,48,35,28,13]) :\n              (msg.payload == \"40\" && global.get(\"voltronic_param11_count\") == 3) ? new Buffer([77,85,67,72,71,67,48,48,52,48,186,139,13]) :\n              (msg.payload == \"50\" && global.get(\"voltronic_param11_count\") == 3) ? new Buffer([77,85,67,72,71,67,48,48,53,48,137,186,13]) :\n              (msg.payload == \"60\" && global.get(\"voltronic_param11_count\") == 3) ? new Buffer([77,85,67,72,71,67,48,48,54,48,220,233,13]) :\n              (msg.payload == \"70\" && global.get(\"voltronic_param11_count\") == 3) ? new Buffer([77,85,67,72,71,67,48,48,55,48,239,216,13]) :\n              (msg.payload == \"80\" && global.get(\"voltronic_param11_count\") == 3) ? new Buffer([77,85,67,72,71,67,48,48,56,48,255,230,13]) :\n              (msg.payload == \"90\" && global.get(\"voltronic_param11_count\") == 3) ? new Buffer([77,85,67,72,71,67,48,48,57,48,204,215,13]) :\n              (msg.payload == \"100\" && global.get(\"voltronic_param11_count\") == 3) ? new Buffer([77,85,67,72,71,67,48,49,48,48,65,127,13]) :\n              (msg.payload == \"110\" && global.get(\"voltronic_param11_count\") == 3) ? new Buffer([77,85,67,72,71,67,48,49,49,48,114,78,13]) :\n              (msg.payload == \"120\" && global.get(\"voltronic_param11_count\") == 3) ? new Buffer([77,85,67,72,71,67,48,49,50,48,39,29,13]) :\n              'Erreur';\n}\n\n/*-------------------------------------------------*/\n//parametre 12\n/*-------------------------------------------------*/\nif (msg.topic == dir + '12') {\n\n    let str = msg.payload;\n    msg.topic = 'msg.topic';\n\n    //option remplace\n    payload = (msg.payload == \"22.0\") ? new Buffer([80,66,67,86,50,50,46,48,115,210,13]) :\n              (msg.payload == \"22.5\") ? new Buffer([80,66,67,86,50,50,46,53,35,119,13]) :\n              (msg.payload == \"23.0\") ? new Buffer([80,66,67,86,50,51,46,48,68,226,13]) :\n              (msg.payload == \"23.5\") ? new Buffer([80,66,67,86,50,51,46,53,20,71,13]) :\n              (msg.payload == \"24.0\") ? new Buffer([80,66,67,86,50,52,46,48,193,114,13]) :\n              (msg.payload == \"24.5\") ? new Buffer([80,66,67,86,50,52,46,53,145,215,13]) :\n              (msg.payload == \"25.0\") ? new Buffer([80,66,67,86,50,53,46,48,246,66,13]) :\n              (msg.payload == \"25.5\") ? new Buffer([80,66,67,86,50,53,46,53,166,231,13]) :\n              (msg.payload == \"44.0\") ? new Buffer([80,66,67,86,52,52,46,48,230,235,13]) :\n              (msg.payload == \"45.0\") ? new Buffer([80,66,67,86,52,53,46,48,209,219,13]) :\n              (msg.payload == \"46.0\") ? new Buffer([80,66,67,86,52,54,46,48,136,139,13]) :\n              (msg.payload == \"47.0\") ? new Buffer([80,66,67,86,52,55,46,48,191,187,13]) :\n              (msg.payload == \"48.0\") ? new Buffer([80,66,67,86,52,56,46,48,147,138,13]) :\n              (msg.payload == \"49.0\") ? new Buffer([80,66,67,86,52,57,46,48,164,186,13]) :\n              (msg.payload == \"50.0\") ? new Buffer([80,66,67,86,53,48,46,48,76,159,13]) :\n              (msg.payload == \"51.0\") ? new Buffer([80,66,67,86,53,49,46,48,123,175,13]) :\n              msg.payload;\n}\n\n/*-------------------------------------------------*/\n//parametre 13\n/*-------------------------------------------------*/\nif (msg.topic == dir + '13') {\n\n    let str = msg.payload;\n    msg.topic = 'msg.topic';\n\n    //option remplace\n    payload = (msg.payload == \"24.0\") ? new Buffer([80,66,68,86,50,52,46,48,147,48]) :\n              (msg.payload == \"24.5\") ? new Buffer([80,66,68,86,50,52,46,53,89,150,13]) :\n              (msg.payload == \"25.0\") ? new Buffer([80,66,68,86,50,53,46,48,62,3,13]) :\n              (msg.payload == \"25.5\") ? new Buffer([80,66,68,86,50,53,46,53,110,166,13]) :\n              (msg.payload == \"26.0\") ? new Buffer([80,66,68,86,50,54,46,48,103,83,13]) :\n              (msg.payload == \"26.5\") ? new Buffer([80,66,68,86,50,54,46,53,55,246,13]) :\n              (msg.payload == \"27.0\") ? new Buffer([80,66,68,86,50,55,46,48,80,99,13]) :\n              (msg.payload == \"27.5\") ? new Buffer([80,66,68,86,50,55,46,53,198,13]) :\n              (msg.payload == \"28.0\") ? new Buffer([80,66,68,86,50,56,46,48,124,82,13]) :\n              (msg.payload == \"28.5\") ? new Buffer([80,66,68,86,50,56,46,53,44,247,13]) :\n              (msg.payload == \"29.0\") ? new Buffer([80,66,68,86,50,57,46,48,75,98,13]) :\n              (msg.payload == \"48.0\") ? new Buffer([80,66,68,86,52,56,46,48,91,203,13]) :\n              (msg.payload == \"49.0\") ? new Buffer([80,66,68,86,52,57,46,48,108,251,13]) :\n              (msg.payload == \"50.0\") ? new Buffer([80,66,68,86,53,48,46,48,132,222,13]) :\n              (msg.payload == \"51.0\") ? new Buffer([80,66,68,86,53,49,46,48,179,238,13]) :\n              (msg.payload == \"52.0\") ? new Buffer([80,66,68,86,53,50,46,48,234,190,13]) :\n              (msg.payload == \"53.0\") ? new Buffer([80,66,68,86,53,51,46,48,221,142,13]) :\n              (msg.payload == \"54.0\") ? new Buffer([80,66,68,86,53,52,46,48,88,30,13]) :\n              (msg.payload == \"55.0\") ? new Buffer([80,66,68,86,53,53,46,48,111,46,13]) :\n              (msg.payload == \"56.0\") ? new Buffer([80,66,68,86,53,54,46,48,54,126,13]) :\n              (msg.payload == \"57.0\") ? new Buffer([80,66,68,86,53,55,46,48,20,224]) :\n              (msg.payload == \"58.0\") ? new Buffer([80,66,68,86,53,56,46,48,45,127,13]) :\n              msg.payload;\n}\n\n\n/*-------------------------------------------------*/\n//parametre 16\n/*-------------------------------------------------*/\nif (msg.topic == dir + '16') {\n\n    let str = msg.payload;\n    msg.topic = 'msg.topic';\n\n    //option remplace\n    payload = (msg.payload == \"CUE\") ? new Buffer([80,67,80,48,48,141,122,13]) :\n              (msg.payload == \"CSO\") ? new Buffer([80,67,80,48,49,157,91,13]) :\n              (msg.payload == \"SNU\") ? new Buffer([80,67,80,48,50,173,56,13]) :\n              (msg.payload == \"OSO\") ? new Buffer([80,67,80,48,51,189,25,13]) :\n              msg.payload;\n}\n\n/*-------------------------------------------------*/\n//parametre 27\n/*-------------------------------------------------*/\nif (msg.topic == dir + '27') {\n\n    let str = msg.payload;\n    msg.topic = 'msg.topic';\n\n    //option remplace\n    payload = (msg.payload == \"25.0\") ? new Buffer([80,66,70,84,50,53,46,48,241,192,13]) :\n            (msg.payload == \"25.1\") ? new Buffer([80,66,70,84,50,53,46,49,225,225,13]) :\n            (msg.payload == \"25.2\") ? new Buffer([80,66,70,84,50,53,46,50,209,130,13]) :\n            (msg.payload == \"25.3\") ? new Buffer([80,66,70,84,50,53,46,51,193,163,13]) :\n            (msg.payload == \"25.4\") ? new Buffer([80,66,70,84,50,53,46,52,177,68,13]) :\n            (msg.payload == \"25.5\") ? new Buffer([80,66,70,84,50,53,46,53,161,101,13]) :\n            (msg.payload == \"25.6\") ? new Buffer([80,66,70,84,50,53,46,54,145,6,13]) :\n            (msg.payload == \"25.7\") ? new Buffer([80,66,70,84,50,53,46,55,129,39,13]) :\n            (msg.payload == \"25.8\") ? new Buffer([80,66,70,84,50,53,46,56,112,200,13]) :\n            (msg.payload == \"25.9\") ? new Buffer([80,66,70,84,50,53,46,57,96,233,13]) :\n            (msg.payload == \"26.0\") ? new Buffer([80,66,70,84,50,54,46,48,168,144,13]) :\n            (msg.payload == \"26.1\") ? new Buffer([80,66,70,84,50,54,46,49,184,177,13]) :\n            (msg.payload == \"26.2\") ? new Buffer([80,66,70,84,50,54,46,50,136,210,13]) :\n            (msg.payload == \"26.3\") ? new Buffer([80,66,70,84,50,54,46,51,152,243,13]) :\n            (msg.payload == \"26.4\") ? new Buffer([80,66,70,84,50,54,46,52,232,20,13]) :\n            (msg.payload == \"26.5\") ? new Buffer([80,66,70,84,50,54,46,53,248,53,13]) :\n            (msg.payload == \"26.6\") ? new Buffer([80,66,70,84,50,54,46,54,200,86,13]) :\n            (msg.payload == \"26.7\") ? new Buffer([80,66,70,84,50,54,46,55,216,119,13]) :\n            (msg.payload == \"26.8\") ? new Buffer([80,66,70,84,50,54,46,56,41,152,13]) :\n            (msg.payload == \"26.9\") ? new Buffer([80,66,70,84,50,54,46,57,57,185,13]) :\n            (msg.payload == \"27.0\") ? new Buffer([80,66,70,84,50,55,46,48,159,160,13]) :\n            (msg.payload == \"27.1\") ? new Buffer([80,66,70,84,50,55,46,49,143,129,13]) :\n            (msg.payload == \"27.2\") ? new Buffer([80,66,70,84,50,55,46,50,191,226,13]) :\n            (msg.payload == \"27.3\") ? new Buffer([80,66,70,84,50,55,46,51,175,195,13]) :\n            (msg.payload == \"27.4\") ? new Buffer([80,66,70,84,50,55,46,52,223,36,13]) :\n            (msg.payload == \"27.5\") ? new Buffer([80,66,70,84,50,55,46,53,207,5,13]) :\n            (msg.payload == \"27.6\") ? new Buffer([80,66,70,84,50,55,46,54,255,102,13]) :\n            (msg.payload == \"27.7\") ? new Buffer([80,66,70,84,50,55,46,55,239,71,13]) :\n            (msg.payload == \"27.8\") ? new Buffer([80,66,70,84,50,55,46,56,30,168,13]) :\n            (msg.payload == \"27.9\") ? new Buffer([80,66,70,84,50,55,46,57,232,144]) :\n            (msg.payload == \"28.0\") ? new Buffer([80,66,70,84,50,56,46,48,179,145,13]) :\n            (msg.payload == \"28.1\") ? new Buffer([80,66,70,84,50,56,46,49,163,176,13]) :\n            (msg.payload == \"28.2\") ? new Buffer([80,66,70,84,50,56,46,50,147,211,13]) :\n            (msg.payload == \"28.3\") ? new Buffer([80,66,70,84,50,56,46,51,131,242,13]) :\n            (msg.payload == \"28.4\") ? new Buffer([80,66,70,84,50,56,46,52,243,21,13]) :\n            (msg.payload == \"28.5\") ? new Buffer([80,66,70,84,50,56,46,53,227,52,13]) :\n            (msg.payload == \"28.6\") ? new Buffer([80,66,70,84,50,56,46,54,211,87,13]) :\n            (msg.payload == \"28.7\") ? new Buffer([80,66,70,84,50,56,46,55,195,118,13]) :\n            (msg.payload == \"28.8\") ? new Buffer([80,66,70,84,50,56,46,56,50,153,13]) :\n            (msg.payload == \"28.9\") ? new Buffer([80,66,70,84,50,56,46,57,34,184,13]) :\n            (msg.payload == \"29.0\") ? new Buffer([80,66,70,84,50,57,46,48,132,161,13]) :\n            (msg.payload == \"29.1\") ? new Buffer([80,66,70,84,50,57,46,49,148,128,13]) :\n            (msg.payload == \"29.2\") ? new Buffer([80,66,70,84,50,57,46,50,164,227,13]) :\n            (msg.payload == \"29.3\") ? new Buffer([80,66,70,84,50,57,46,51,180,194,13]) :\n            (msg.payload == \"29.4\") ? new Buffer([80,66,70,84,50,57,46,52,196,37,13]) :\n            (msg.payload == \"29.5\") ? new Buffer([80,66,70,84,50,57,46,53,212,4,13]) :\n            (msg.payload == \"29.6\") ? new Buffer([80,66,70,84,50,57,46,54,228,103,13]) :\n            (msg.payload == \"29.7\") ? new Buffer([80,66,70,84,50,57,46,55,244,70,13]) :\n            (msg.payload == \"29.8\") ? new Buffer([80,66,70,84,50,57,46,56,90,144]) :\n            (msg.payload == \"29.9\") ? new Buffer([80,66,70,84,50,57,46,57,21,136,13]) :\n            (msg.payload == \"30.0\") ? new Buffer([80,66,70,84,51,48,46,48,108,132,13]) :\n            (msg.payload == \"30.1\") ? new Buffer([80,66,70,84,51,48,46,49,124,165,13]) :\n            (msg.payload == \"30.2\") ? new Buffer([80,66,70,84,51,48,46,50,76,198,13]) :\n            (msg.payload == \"30.3\") ? new Buffer([80,66,70,84,51,48,46,51,92,231,13]) :\n            (msg.payload == \"30.4\") ? new Buffer([80,66,70,84,51,48,46,52,44,0,13]) :\n            (msg.payload == \"30.5\") ? new Buffer([80,66,70,84,51,48,46,53,60,33,13]) :\n            (msg.payload == \"30.6\") ? new Buffer([80,66,70,84,51,48,46,54,196,32]) :\n            (msg.payload == \"30.7\") ? new Buffer([80,66,70,84,51,48,46,55,28,99,13]) :\n            (msg.payload == \"30.8\") ? new Buffer([80,66,70,84,51,48,46,56,237,140,13]) :\n            (msg.payload == \"30.9\") ? new Buffer([80,66,70,84,51,48,46,57,253,173,13]) :\n            (msg.payload == \"31.0\") ? new Buffer([80,66,70,84,51,49,46,48,91,180,13]) :\n            (msg.payload == \"31.1\") ? new Buffer([80,66,70,84,51,49,46,49,75,149,13]) :\n            (msg.payload == \"31.2\") ? new Buffer([80,66,70,84,51,49,46,50,123,246,13]) :\n            (msg.payload == \"31.3\") ? new Buffer([80,66,70,84,51,49,46,51,107,215,13]) :\n            (msg.payload == \"31.4\") ? new Buffer([80,66,70,84,51,49,46,52,27,48,13]) :\n            (msg.payload == \"31.5\") ? new Buffer([80,66,70,84,51,49,46,53,177,16]) :\n            (msg.payload == \"48.0\") ? new Buffer([80, 66, 70, 84, 52, 56, 46, 48, 148, 8, 13]) :\n            (msg.payload == \"48.1\") ? new Buffer([80, 66, 70, 84, 52, 56, 46, 49, 132, 41, 13]) :\n            (msg.payload == \"48.2\") ? new Buffer([80, 66, 70, 84, 52, 56, 46, 50, 180, 74, 13]) :\n            (msg.payload == \"48.3\") ? new Buffer([80, 66, 70, 84, 52, 56, 46, 51, 164, 107, 13]) :\n            (msg.payload == \"48.4\") ? new Buffer([80, 66, 70, 84, 52, 56, 46, 52, 212, 140, 13]) :\n            (msg.payload == \"48.5\") ? new Buffer([80, 66, 70, 84, 52, 56, 46, 53, 196, 173, 13]) :\n            (msg.payload == \"48.6\") ? new Buffer([80, 66, 70, 84, 52, 56, 46, 54, 244, 206, 13]) :\n            (msg.payload == \"48.7\") ? new Buffer([80, 66, 70, 84, 52, 56, 46, 55, 228, 239, 13]) :\n            (msg.payload == \"48.8\") ? new Buffer([80, 66, 70, 84, 52, 56, 46, 56, 21, 0, 13]) :\n            (msg.payload == \"48.9\") ? new Buffer([80, 66, 70, 84, 52, 56, 46, 57, 82, 16]) :\n            (msg.payload == \"49.0\") ? new Buffer([80, 66, 70, 84, 52, 57, 46, 48, 163, 56, 13]) :\n            (msg.payload == \"49.1\") ? new Buffer([80, 66, 70, 84, 52, 57, 46, 49, 179, 25, 13]) :\n            (msg.payload == \"49.2\") ? new Buffer([80, 66, 70, 84, 52, 57, 46, 50, 131, 122, 13]) :\n            (msg.payload == \"49.3\") ? new Buffer([80, 66, 70, 84, 52, 57, 46, 51, 147, 91, 13]) :\n            (msg.payload == \"49.4\") ? new Buffer([80, 66, 70, 84, 52, 57, 46, 52, 227, 188, 13]) :\n            (msg.payload == \"49.5\") ? new Buffer([80, 66, 70, 84, 52, 57, 46, 53, 243, 157, 13]) :\n            (msg.payload == \"49.6\") ? new Buffer([80, 66, 70, 84, 52, 57, 46, 54, 195, 254, 13]) :\n            (msg.payload == \"49.7\") ? new Buffer([80, 66, 70, 84, 52, 57, 46, 55, 211, 223, 13]) :\n            (msg.payload == \"49.8\") ? new Buffer([80, 66, 70, 84, 52, 57, 46, 56, 34, 48, 13]) :\n            (msg.payload == \"49.9\") ? new Buffer([80, 66, 70, 84, 52, 57, 46, 57, 50, 17, 13]) :\n            (msg.payload == \"50.0\") ? new Buffer([80, 66, 70, 84, 53, 48, 46, 48, 75, 29, 13]) :\n            (msg.payload == \"50.1\") ? new Buffer([80, 66, 70, 84, 53, 48, 46, 49, 91, 60, 13]) :\n            (msg.payload == \"50.2\") ? new Buffer([80, 66, 70, 84, 53, 48, 46, 50, 107, 95, 13]) :\n            (msg.payload == \"50.3\") ? new Buffer([80, 66, 70, 84, 53, 48, 46, 51, 123, 126, 13]) :\n            (msg.payload == \"50.4\") ? new Buffer([80, 66, 70, 84, 53, 48, 46, 52, 185, 144]) :\n            (msg.payload == \"50.5\") ? new Buffer([80, 66, 70, 84, 53, 48, 46, 53, 27, 184, 13]) :\n            (msg.payload == \"50.6\") ? new Buffer([80, 66, 70, 84, 53, 48, 46, 54, 43, 219, 13]) :\n            (msg.payload == \"50.7\") ? new Buffer([80, 66, 70, 84, 53, 48, 46, 55, 59, 250, 13]) :\n            (msg.payload == \"50.8\") ? new Buffer([80, 66, 70, 84, 53, 48, 46, 56, 202, 21, 13]) :\n            (msg.payload == \"50.9\") ? new Buffer([80, 66, 70, 84, 53, 48, 46, 57, 218, 52, 13]) :\n            (msg.payload == \"51.0\") ? new Buffer([80, 66, 70, 84, 53, 49, 46, 48, 124, 45, 13]) :\n            (msg.payload == \"51.1\") ? new Buffer([80, 66, 70, 84, 53, 49, 46, 49, 108, 12, 13]) :\n            (msg.payload == \"51.2\") ? new Buffer([80, 66, 70, 84, 53, 49, 46, 50, 92, 111, 13]) :\n            (msg.payload == \"51.3\") ? new Buffer([80, 66, 70, 84, 53, 49, 46, 51, 76, 78, 13]) :\n            (msg.payload == \"51.4\") ? new Buffer([80, 66, 70, 84, 53, 49, 46, 52, 60, 169, 13]) :\n            (msg.payload == \"51.5\") ? new Buffer([80, 66, 70, 84, 53, 49, 46, 53, 44, 136, 13]) :\n            (msg.payload == \"51.6\") ? new Buffer([80, 66, 70, 84, 53, 49, 46, 54, 28, 235, 13]) :\n            (msg.payload == \"51.7\") ? new Buffer([80, 66, 70, 84, 53, 49, 46, 55, 204, 160]) :\n            (msg.payload == \"51.8\") ? new Buffer([80, 66, 70, 84, 53, 49, 46, 56, 253, 37, 13]) :\n            (msg.payload == \"51.9\") ? new Buffer([80, 66, 70, 84, 53, 49, 46, 57, 237, 4, 13]) :\n            (msg.payload == \"52.0\") ? new Buffer([80, 66, 70, 84, 53, 50, 46, 48, 37, 125, 13]) :\n            (msg.payload == \"52.1\") ? new Buffer([80, 66, 70, 84, 53, 50, 46, 49, 53, 92, 13]) :\n            (msg.payload == \"52.2\") ? new Buffer([80, 66, 70, 84, 53, 50, 46, 50, 83, 240]) :\n            (msg.payload == \"52.3\") ? new Buffer([80, 66, 70, 84, 53, 50, 46, 51, 21, 30, 13]) :\n            (msg.payload == \"52.4\") ? new Buffer([80, 66, 70, 84, 53, 50, 46, 52, 101, 249, 13]) :\n            (msg.payload == \"52.5\") ? new Buffer([80, 66, 70, 84, 53, 50, 46, 53, 117, 216, 13]) :\n            (msg.payload == \"52.6\") ? new Buffer([80, 66, 70, 84, 53, 50, 46, 54, 69, 187, 13]) :\n            (msg.payload == \"52.7\") ? new Buffer([80, 66, 70, 84, 53, 50, 46, 55, 85, 154, 13]) :\n            (msg.payload == \"52.8\") ? new Buffer([80, 66, 70, 84, 53, 50, 46, 56, 164, 117, 13]) :\n            (msg.payload == \"52.9\") ? new Buffer([80, 66, 70, 84, 53, 50, 46, 57, 180, 84, 13]) :\n            (msg.payload == \"53.0\") ? new Buffer([80, 66, 70, 84, 53, 51, 46, 48, 18, 77, 13]) :\n            (msg.payload == \"53.1\") ? new Buffer([80, 66, 70, 84, 53, 51, 46, 49, 38, 192]) :\n            (msg.payload == \"53.2\") ? new Buffer([80, 66, 70, 84, 53, 51, 46, 50, 50, 15, 13]) :\n            (msg.payload == \"53.3\") ? new Buffer([80, 66, 70, 84, 53, 51, 46, 51, 34, 46, 13]) :\n            (msg.payload == \"53.4\") ? new Buffer([80, 66, 70, 84, 53, 51, 46, 52, 82, 201, 13]) :\n            (msg.payload == \"53.5\") ? new Buffer([80, 66, 70, 84, 53, 51, 46, 53, 66, 232, 13]) :\n            (msg.payload == \"53.6\") ? new Buffer([80, 66, 70, 84, 53, 51, 46, 54, 114, 139, 13]) :\n            (msg.payload == \"53.7\") ? new Buffer([80, 66, 70, 84, 53, 51, 46, 55, 98, 170, 13]) :\n            (msg.payload == \"53.8\") ? new Buffer([80, 66, 70, 84, 53, 51, 46, 56, 147, 69, 13]) :\n            (msg.payload == \"53.9\") ? new Buffer([80, 66, 70, 84, 53, 51, 46, 57, 131, 100, 13]) :\n            (msg.payload == \"54.0\") ? new Buffer([80, 66, 70, 84, 53, 52, 46, 48, 151, 221, 13]) :\n            (msg.payload == \"54.1\") ? new Buffer([80, 66, 70, 84, 53, 52, 46, 49, 135, 252, 13]) :\n            (msg.payload == \"54.2\") ? new Buffer([80, 66, 70, 84, 53, 52, 46, 50, 183, 159, 13]) :\n            (msg.payload == \"54.3\") ? new Buffer([80, 66, 70, 84, 53, 52, 46, 51, 167, 190, 13]) :\n            (msg.payload == \"54.4\") ? new Buffer([80, 66, 70, 84, 53, 52, 46, 52, 215, 89, 13]) :\n            (msg.payload == \"54.5\") ? new Buffer([80, 66, 70, 84, 53, 52, 46, 53, 199, 120, 13]) :\n            (msg.payload == \"54.6\") ? new Buffer([80, 66, 70, 84, 53, 52, 46, 54, 247, 27, 13]) :\n            (msg.payload == \"54.7\") ? new Buffer([80, 66, 70, 84, 53, 52, 46, 55, 231, 58, 13]) :\n            (msg.payload == \"54.8\") ? new Buffer([80, 66, 70, 84, 53, 52, 46, 56, 22, 213, 13]) :\n            (msg.payload == \"54.9\") ? new Buffer([80, 66, 70, 84, 53, 52, 46, 57, 111, 64]) :\n            (msg.payload == \"55.0\") ? new Buffer([80, 66, 70, 84, 53, 53, 46, 48, 160, 237, 13]) :\n            (msg.payload == \"55.1\") ? new Buffer([80, 66, 70, 84, 53, 53, 46, 49, 176, 204, 13]) :\n            (msg.payload == \"55.2\") ? new Buffer([80, 66, 70, 84, 53, 53, 46, 50, 128, 175, 13]) :\n            (msg.payload == \"55.3\") ? new Buffer([80, 66, 70, 84, 53, 53, 46, 51, 144, 142, 13]) :\n            (msg.payload == \"55.4\") ? new Buffer([80, 66, 70, 84, 53, 53, 46, 52, 224, 105, 13]) :\n            (msg.payload == \"55.5\") ? new Buffer([80, 66, 70, 84, 53, 53, 46, 53, 240, 72, 13]) :\n            (msg.payload == \"55.6\") ? new Buffer([80, 66, 70, 84, 53, 53, 46, 54, 192, 43, 13]) :\n            (msg.payload == \"55.7\") ? new Buffer([80, 66, 70, 84, 53, 53, 46, 55, 208, 10, 13]) :\n            (msg.payload == \"55.8\") ? new Buffer([80, 66, 70, 84, 53, 53, 46, 56, 33, 229, 13]) :\n            (msg.payload == \"55.9\") ? new Buffer([80, 66, 70, 84, 53, 53, 46, 57, 49, 196, 13]) :\n            (msg.payload == \"56.0\") ? new Buffer([80, 66, 70, 84, 53, 54, 46, 48, 249, 189, 13]) :\n            (msg.payload == \"56.1\") ? new Buffer([80, 66, 70, 84, 53, 54, 46, 49, 233, 156, 13]) :\n            (msg.payload == \"56.2\") ? new Buffer([80, 66, 70, 84, 53, 54, 46, 50, 217, 255, 13]) :\n            (msg.payload == \"56.3\") ? new Buffer([80, 66, 70, 84, 53, 54, 46, 51, 201, 222, 13]) :\n            (msg.payload == \"56.4\") ? new Buffer([80, 66, 70, 84, 53, 54, 46, 52, 185, 57, 13]) :\n            (msg.payload == \"56.5\") ? new Buffer([80, 66, 70, 84, 53, 54, 46, 53, 169, 24, 13]) :\n            (msg.payload == \"56.6\") ? new Buffer([80, 66, 70, 84, 53, 54, 46, 54, 153, 123, 13]) :\n            (msg.payload == \"56.7\") ? new Buffer([80, 66, 70, 84, 53, 54, 46, 55, 137, 90, 13]) :\n            (msg.payload == \"56.8\") ? new Buffer([80, 66, 70, 84, 53, 54, 46, 56, 120, 181, 13]) :\n            (msg.payload == \"56.9\") ? new Buffer([80, 66, 70, 84, 53, 54, 46, 57, 104, 148, 13]) :\n            (msg.payload == \"57.0\") ? new Buffer([80, 66, 70, 84, 53, 55, 46, 48, 206, 141, 13]) :\n            (msg.payload == \"57.1\") ? new Buffer([80, 66, 70, 84, 53, 55, 46, 49, 222, 172, 13]) :\n            (msg.payload == \"57.2\") ? new Buffer([80, 66, 70, 84, 53, 55, 46, 50, 238, 207, 13]) :\n            (msg.payload == \"57.3\") ? new Buffer([80, 66, 70, 84, 53, 55, 46, 51, 254, 238, 13]) :\n            (msg.payload == \"57.4\") ? new Buffer([80, 66, 70, 84, 53, 55, 46, 52, 142, 9, 13]) :\n            (msg.payload == \"57.5\") ? new Buffer([80, 66, 70, 84, 53, 55, 46, 53, 158, 40, 13]) :\n            (msg.payload == \"57.6\") ? new Buffer([80, 66, 70, 84, 53, 55, 46, 54, 174, 75, 13]) :\n            (msg.payload == \"57.7\") ? new Buffer([80, 66, 70, 84, 53, 55, 46, 55, 190, 106, 13]) :\n            (msg.payload == \"57.8\") ? new Buffer([80, 66, 70, 84, 53, 55, 46, 56, 79, 133, 13]) :\n            (msg.payload == \"57.9\") ? new Buffer([80, 66, 70, 84, 53, 55, 46, 57, 95, 164, 13]) :\n            (msg.payload == \"58.0\") ? new Buffer([80, 66, 70, 84, 53, 56, 46, 48, 226, 188, 13]) :\n            msg.payload;\n}\n\n/*-------------------------------------------------*/\n//parametre 29\n/*-------------------------------------------------*/\nif (msg.topic == dir + '29') {\n\n    let str = msg.payload;\n    msg.topic = 'msg.topic';\n\n    //option remplace\n    payload = (msg.payload == \"21.0\") ? new Buffer([80,83,68,86,50,49,46,48,109,217,13]) :\n            (msg.payload == \"21.1\") ? new Buffer([80,83,68,86,50,49,46,49,125,248,13]) :\n            (msg.payload == \"21.2\") ? new Buffer([80,83,68,86,50,49,46,50,77,155,13]) :\n            (msg.payload == \"21.3\") ? new Buffer([80,83,68,86,50,49,46,51,93,186,13]) :\n            (msg.payload == \"21.4\") ? new Buffer([80,83,68,86,50,49,46,52,45,93,13]) :\n            (msg.payload == \"21.5\") ? new Buffer([80,83,68,86,50,49,46,53,61,124,13]) :\n            (msg.payload == \"21.6\") ? new Buffer([80,83,68,86,50,49,46,54,209,240]) :\n            (msg.payload == \"21.7\") ? new Buffer([80,83,68,86,50,49,46,55,29,62,13]) :\n            (msg.payload == \"21.8\") ? new Buffer([80,83,68,86,50,49,46,56,236,209,13]) :\n            (msg.payload == \"21.9\") ? new Buffer([80,83,68,86,50,49,46,57,252,240,13]) :\n            (msg.payload == \"22.0\") ? new Buffer([80,83,68,86,50,50,46,48,52,137,13]) :\n            (msg.payload == \"22.1\") ? new Buffer([80,83,68,86,50,50,46,49,36,168,13]) :\n            (msg.payload == \"22.2\") ? new Buffer([80,83,68,86,50,50,46,50,20,203,13]) :\n            (msg.payload == \"22.3\") ? new Buffer([80,83,68,86,50,50,46,51,78,160]) :\n            (msg.payload == \"22.4\") ? new Buffer([80,83,68,86,50,50,46,52,116,13,13]) :\n            (msg.payload == \"22.5\") ? new Buffer([80,83,68,86,50,50,46,53,100,44,13]) :\n            (msg.payload == \"22.6\") ? new Buffer([80,83,68,86,50,50,46,54,84,79,13]) :\n            (msg.payload == \"22.7\") ? new Buffer([80,83,68,86,50,50,46,55,68,110,13]) :\n            (msg.payload == \"22.8\") ? new Buffer([80,83,68,86,50,50,46,56,181,129,13]) :\n            (msg.payload == \"22.9\") ? new Buffer([80,83,68,86,50,50,46,57,165,160,13]) :\n            (msg.payload == \"23.0\") ? new Buffer([80,83,68,86,50,51,46,48,59,144]) :\n            (msg.payload == \"23.1\") ? new Buffer([80,83,68,86,50,51,46,49,19,152,13]) :\n            (msg.payload == \"23.2\") ? new Buffer([80,83,68,86,50,51,46,50,35,251,13]) :\n            (msg.payload == \"23.3\") ? new Buffer([80,83,68,86,50,51,46,51,51,218,13]) :\n            (msg.payload == \"23.4\") ? new Buffer([80,83,68,86,50,51,46,52,67,61,13]) :\n            (msg.payload == \"23.5\") ? new Buffer([80,83,68,86,50,51,46,53,83,28,13]) :\n            (msg.payload == \"23.6\") ? new Buffer([80,83,68,86,50,51,46,54,99,127,13]) :\n            (msg.payload == \"23.7\") ? new Buffer([80,83,68,86,50,51,46,55,115,94,13]) :\n            (msg.payload == \"23.8\") ? new Buffer([80,83,68,86,50,51,46,56,130,177,13]) :\n            (msg.payload == \"23.9\") ? new Buffer([80,83,68,86,50,51,46,57,146,144,13]) :\n            (msg.payload == \"24.0\") ? new Buffer([80,83,68,86,50,52,46,48,134,41,13]) :\n            (msg.payload == \"42.0\") ? new Buffer([80,83,68,86,52,50,46,48,19,16,13]) :\n            (msg.payload == \"42.1\") ? new Buffer([80,83,68,86,52,50,46,49,51,16]) :\n            (msg.payload == \"42.2\") ? new Buffer([80,83,68,86,52,50,46,50,51,82,13]) :\n            (msg.payload == \"42.3\") ? new Buffer([80,83,68,86,52,50,46,51,35,115,13]) :\n            (msg.payload == \"42.4\") ? new Buffer([80,83,68,86,52,50,46,52,83,148,13]) :\n            (msg.payload == \"42.5\") ? new Buffer([80,83,68,86,52,50,46,53,67,181,13]) :\n            (msg.payload == \"42.6\") ? new Buffer([80,83,68,86,52,50,46,54,115,214,13]) :\n            (msg.payload == \"42.7\") ? new Buffer([80,83,68,86,52,50,46,55,99,247,13]) :\n            (msg.payload == \"42.8\") ? new Buffer([80,83,68,86,52,50,46,56,146,24,13]) :\n            (msg.payload == \"42.9\") ? new Buffer([80,83,68,86,52,50,46,57,130,57,13]) :\n            (msg.payload == \"43.0\") ? new Buffer([80,83,68,86,52,51,46,48,36,32,13]) :\n            (msg.payload == \"43.1\") ? new Buffer([80,83,68,86,52,51,46,49,52,1,13]) :\n            (msg.payload == \"43.2\") ? new Buffer([80,83,68,86,52,51,46,50,70,32]) :\n            (msg.payload == \"43.3\") ? new Buffer([80,83,68,86,52,51,46,51,20,67,13]) :\n            (msg.payload == \"43.4\") ? new Buffer([80,83,68,86,52,51,46,52,100,164,13]) :\n            (msg.payload == \"43.5\") ? new Buffer([80,83,68,86,52,51,46,53,116,133,13]) :\n            (msg.payload == \"43.6\") ? new Buffer([80,83,68,86,52,51,46,54,68,230,13]) :\n            (msg.payload == \"43.7\") ? new Buffer([80,83,68,86,52,51,46,55,84,199,13]) :\n            (msg.payload == \"43.8\") ? new Buffer([80,83,68,86,52,51,46,56,165,40,13]) :\n            (msg.payload == \"43.9\") ? new Buffer([80,83,68,86,52,51,46,57,181,9,13]) :\n            (msg.payload == \"44.0\") ? new Buffer([80,83,68,86,52,52,46,48,161,176,13]) :\n            (msg.payload == \"44.1\") ? new Buffer([80,83,68,86,52,52,46,49,177,145,13]) :\n            (msg.payload == \"44.2\") ? new Buffer([80,83,68,86,52,52,46,50,129,242,13]) :\n            (msg.payload == \"44.3\") ? new Buffer([80,83,68,86,52,52,46,51,145,211,13]) :\n            (msg.payload == \"44.4\") ? new Buffer([80,83,68,86,52,52,46,52,225,52,13]) :\n            (msg.payload == \"44.5\") ? new Buffer([80,83,68,86,52,52,46,53,241,21,13]) :\n            (msg.payload == \"44.6\") ? new Buffer([80,83,68,86,52,52,46,54,193,118,13]) :\n            (msg.payload == \"44.7\") ? new Buffer([80,83,68,86,52,52,46,55,209,87,13]) :\n            (msg.payload == \"44.8\") ? new Buffer([80,83,68,86,52,52,46,56,32,184,13]) :\n            (msg.payload == \"44.9\") ? new Buffer([80,83,68,86,52,52,46,57,48,153,13]) :\n            (msg.payload == \"45.0\") ? new Buffer([80,83,68,86,52,53,46,48,150,128,13]) :\n            (msg.payload == \"45.1\") ? new Buffer([80,83,68,86,52,53,46,49,134,161,13]) :\n            (msg.payload == \"45.2\") ? new Buffer([80,83,68,86,52,53,46,50,182,194,13]) :\n            (msg.payload == \"45.3\") ? new Buffer([80,83,68,86,52,53,46,51,166,227,13]) :\n            (msg.payload == \"45.4\") ? new Buffer([80,83,68,86,52,53,46,52,214,4,13]) :\n            (msg.payload == \"45.5\") ? new Buffer([80,83,68,86,52,53,46,53,198,37,13]) :\n            (msg.payload == \"45.6\") ? new Buffer([80,83,68,86,52,53,46,54,246,70,13]) :\n            (msg.payload == \"45.7\") ? new Buffer([80,83,68,86,52,53,46,55,230,103,13]) :\n            (msg.payload == \"45.8\") ? new Buffer([80,83,68,86,52,53,46,56,23,136,13]) :\n            (msg.payload == \"45.9\") ? new Buffer([80,83,68,86,52,53,46,57,122,144]) :\n            (msg.payload == \"46.0\") ? new Buffer([80,83,68,86,52,54,46,48,207,208,13]) :\n            (msg.payload == \"46.1\") ? new Buffer([80,83,68,86,52,54,46,49,223,241,13]) :\n            (msg.payload == \"46.2\") ? new Buffer([80,83,68,86,52,54,46,50,239,146,13]) :\n            (msg.payload == \"46.3\") ? new Buffer([80,83,68,86,52,54,46,51,255,179,13]) :\n            (msg.payload == \"46.4\") ? new Buffer([80,83,68,86,52,54,46,52,143,84,13]) :\n            (msg.payload == \"46.5\") ? new Buffer([80,83,68,86,52,54,46,53,159,117,13]) :\n            (msg.payload == \"46.6\") ? new Buffer([80,83,68,86,52,54,46,54,175,22,13]) :\n            (msg.payload == \"46.7\") ? new Buffer([80,83,68,86,52,54,46,55,191,55,13]) :\n            (msg.payload == \"46.8\") ? new Buffer([80,83,68,86,52,54,46,56,78,216,13]) :\n            (msg.payload == \"46.9\") ? new Buffer([80,83,68,86,52,54,46,57,94,249,13]) :\n            (msg.payload == \"47.0\") ? new Buffer([80,83,68,86,52,55,46,48,248,224,13]) :\n            (msg.payload == \"47.1\") ? new Buffer([80,83,68,86,52,55,46,49,232,193,13]) :\n            (msg.payload == \"47.2\") ? new Buffer([80,83,68,86,52,55,46,50,216,162,13]) :\n            (msg.payload == \"47.3\") ? new Buffer([80,83,68,86,52,55,46,51,200,131,13]) :\n            (msg.payload == \"47.4\") ? new Buffer([80,83,68,86,52,55,46,52,184,100,13]) :\n            (msg.payload == \"47.5\") ? new Buffer([80,83,68,86,52,55,46,53,168,69,13]) :\n            (msg.payload == \"47.6\") ? new Buffer([80,83,68,86,52,55,46,54,152,38,13]) :\n            (msg.payload == \"47.7\") ? new Buffer([80,83,68,86,52,55,46,55,136,7,13]) :\n            (msg.payload == \"47.8\") ? new Buffer([80,83,68,86,52,55,46,56,121,232,13]) :\n            (msg.payload == \"47.9\") ? new Buffer([80,83,68,86,52,55,46,57,105,201,13]) :\n            (msg.payload == \"48.0\") ? new Buffer([80,83,68,86,52,56,46,48,212,209,13]) :\n              'Erreur';\n}\n\n\n\nmsg.payload = new Buffer(payload);\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":780,"y":640,"wires":[["f8cea4025fd64803","0a26af9f25c8825f"]]},{"id":"f8cea4025fd64803","type":"debug","z":"9c0ee1028b125264","g":"a5dcfaf2e3ab4964","name":"debug 106","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1010,"y":680,"wires":[]},{"id":"8eb2e427abc909f2","type":"function","z":"9c0ee1028b125264","g":"a5dcfaf2e3ab4964","name":"function 30","func":"msg.action = \"subscribe\";\nmsg.topic = global.get(\"mqttDirSmart\") + '/' + global.get(\"onduleurType\") + '-Modification/#';\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":310,"y":640,"wires":[["e7b0a2a9babd283a","c4ed8f53c8379119"]]},{"id":"bcb7a48abdf34e60","type":"inject","z":"9c0ee1028b125264","g":"a5dcfaf2e3ab4964","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"5","topic":"","payload":"","payloadType":"date","x":150,"y":640,"wires":[["8eb2e427abc909f2"]]},{"id":"0a26af9f25c8825f","type":"link out","z":"9c0ee1028b125264","g":"a5dcfaf2e3ab4964","name":"link out 2","mode":"link","links":["80126da2d8f7672a"],"x":1085,"y":640,"wires":[]},{"id":"c4ed8f53c8379119","type":"debug","z":"9c0ee1028b125264","g":"a5dcfaf2e3ab4964","name":"debug 118","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":490,"y":680,"wires":[]},{"id":"2f476d8b23e8928e","type":"inject","z":"9c0ee1028b125264","g":"72d9ac7047516ee9","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"7","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":690,"y":40,"wires":[["52a29267e8d0699b"]]},{"id":"5c745d1e2285feb7","type":"link out","z":"9c0ee1028b125264","g":"72d9ac7047516ee9","name":"To-serial-ou","mode":"link","links":["7f6c8d926d16e38d","80126da2d8f7672a","aa54f3f93b57694a","f1eb1078d7776ae1","57433a400ecd6c15"],"x":1085,"y":40,"wires":[]},{"id":"f4cd137430c47522","type":"function","z":"9c0ee1028b125264","g":"586f394187c03306","name":"function 43","func":"msg.topic = \"QSID\";\nmsg.payload = new Buffer([81,83,73,68,187,5,13]);\nnode.send(msg);\n\nmsg.topic = \"QID\";\nmsg.payload = new Buffer([81,73,68,214,234,13]);\nnode.send(msg);\n\nmsg.topic = \"QVFW\";\nmsg.payload = new Buffer([81,86,70,87,98,153,13]);\nnode.send(msg);\n\nsetTimeout(function () {\n        msg.topic = \"qpigs2\";\n        msg.payload = new Buffer([81,80,73,71,83,50,104,45,13]);\n        node.send(msg);\n    }, 100);\n\nlet seconde = 800;\nfor (let i = 1; i <= 8; i++) {\n    setTimeout(function () {\n        msg.topic = \"qpgs\" + i;\n        msg.payload = (i == 1 && global.get(\"qpgs1\") != \"NAK\") ? new Buffer([81,80,71,83,49,47,251,13]) :\n                    (i == 2 && global.get(\"qpgs2\") != \"false\") ? new Buffer([81,80,71,83,50,31,152,13]) :\n                    (i == 3 && global.get(\"qpgs3\") != \"false\") ? new Buffer([81,80,71,83,51,15,185,13]) :\n                    (i == 4 && global.get(\"qpgs4\") != \"false\") ? new Buffer([81,80,71,83,52,127,94,13]) :\n                    (i == 5 && global.get(\"qpgs5\") != \"false\") ? new Buffer([81,80,71,83,53,111,127,13]) :\n                    (i == 6 && global.get(\"qpgs6\") != \"false\") ? new Buffer([81,80,71,83,54,95,28,13]) :\n                    (i == 7 && global.get(\"qpgs7\") != \"false\") ? new Buffer([81,80,71,83,55,79,61,13]) :\n                    (i == 8 && global.get(\"qpgs8\") != \"false\") ? new Buffer([81,80,71,83,56,190,210,13]) :\n                    (i == 9 && global.get(\"qpgs9\") != \"false\") ? new Buffer([81,80,71,83,57,174,243,13]) :\n                    'Erreur';\n        node.send(msg);\n\n    }, seconde+i*1000 );\n}\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":410,"y":40,"wires":[["252cd27273af1053"]]},{"id":"6325b4e5bceb7eaf","type":"inject","z":"9c0ee1028b125264","g":"586f394187c03306","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"3","topic":"","payload":"","payloadType":"date","x":130,"y":40,"wires":[["c8499b08a0d42809"]]},{"id":"252cd27273af1053","type":"link out","z":"9c0ee1028b125264","g":"586f394187c03306","name":"To-serial-ou","mode":"link","links":["7f6c8d926d16e38d","80126da2d8f7672a","aa54f3f93b57694a","f1eb1078d7776ae1","57433a400ecd6c15"],"x":515,"y":40,"wires":[]},{"id":"c8499b08a0d42809","type":"switch","z":"9c0ee1028b125264","g":"586f394187c03306","name":"","property":"onduleurType","propertyType":"global","rules":[{"t":"eq","v":"voltronic","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":270,"y":40,"wires":[["f4cd137430c47522"]]},{"id":"52a29267e8d0699b","type":"switch","z":"9c0ee1028b125264","g":"72d9ac7047516ee9","name":"","property":"onduleurType","propertyType":"global","rules":[{"t":"eq","v":"voltronic","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":840,"y":40,"wires":[["5998183f1333512a"]]},{"id":"5998183f1333512a","type":"function","z":"9c0ee1028b125264","g":"72d9ac7047516ee9","name":"requete","func":"setTimeout(function () {\n    msg.topic = \"qpig\";\n    msg.payload = new Buffer([81,80,73,71,83,183,169,13]);\n    node.send(msg);\n}, 0);\n\nsetTimeout(function () {\n    msg.topic = \"qmod\";\n    msg.payload = new Buffer([81,77,79,68,73,193,13]);\n    node.send(msg);\n}, 1000);\n\nsetTimeout(function () {\n    msg.topic = \"qpiws\";\n    msg.payload = new Buffer([81,80,73,87,83,180,218,13]);\n    node.send(msg);\n}, 1400);\n\nsetTimeout(function () {\n    msg.topic = \"qbeqi\";\n    msg.payload = new Buffer([81,66,69,81,73,46,169,13]);\n    node.send(msg);\n}, 1700);\n\nsetTimeout(function () {\n    msg.topic = \"qflag\";\n    msg.payload = new Buffer([81,70,76,65,71,152,116,13]);\n    node.send(msg);\n}, 2100);\n\nsetTimeout(function () {\n    msg.topic = \"qpiri\";\n    msg.payload = new Buffer([81,80,73,82,73,248,84,13]);\n    node.send(msg);\n}, 2500);\n\nif (global.get(\"qpigs2\") != \"NAK\"){\n    setTimeout(function () {\n        msg.topic = \"qpigs2\";\n        msg.payload = new Buffer([81,80,73,71,83,50,104,45,13]);\n        node.send(msg);\n    }, 3200);\n}\n\nlet seconde = 4000;\nfor (let i = 1; i <= 8; i++) {\n    setTimeout(function () {\n        msg.topic = \"qpgs\" + i;\n        msg.payload = (i == 1 && global.get(\"qpgs1\") != \"NAK\") ? new Buffer([81,80,71,83,49,47,251,13]) :\n                    (i == 2 && global.get(\"qpgs2\") != \"false\") ? new Buffer([81,80,71,83,50,31,152,13]) :\n                    (i == 3 && global.get(\"qpgs3\") != \"false\") ? new Buffer([81,80,71,83,51,15,185,13]) :\n                    (i == 4 && global.get(\"qpgs4\") != \"false\") ? new Buffer([81,80,71,83,52,127,94,13]) :\n                    (i == 5 && global.get(\"qpgs5\") != \"false\") ? new Buffer([81,80,71,83,53,111,127,13]) :\n                    (i == 6 && global.get(\"qpgs6\") != \"false\") ? new Buffer([81,80,71,83,54,95,28,13]) :\n                    (i == 7 && global.get(\"qpgs7\") != \"false\") ? new Buffer([81,80,71,83,55,79,61,13]) :\n                    (i == 8 && global.get(\"qpgs8\") != \"false\") ? new Buffer([81,80,71,83,56,190,210,13]) :\n                    (i == 9 && global.get(\"qpgs9\") != \"false\") ? new Buffer([81,80,71,83,57,174,243,13]) :\n                    'erreur';\n            if (msg.payload != 'erreur'){\n\n                node.send(msg);\n                \n            }\n\n    }, seconde+i*1000 );\n}\n\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":980,"y":40,"wires":[["5c745d1e2285feb7"]]},{"id":"3e58f6c9f1439a9b","type":"function","z":"9c0ee1028b125264","name":"function 53","func":"if (global.get(\"onduleurElfinActive\") == true){\n    \n    return [msg,,];\n\n}else if (global.get(\"onduleurUsbPort\") != \"false\"){\n\n     return [,msg,];\n}else{\n    \n    return [,,msg ];\n}\n\n","outputs":3,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":170,"y":220,"wires":[["8ba9d5a59e6dee3c"],["c9fd372e65fbd09d"],[]]},{"id":"531ff80b4a69e7c3","type":"function","z":"9c0ee1028b125264","g":"78c8b76577708c4d","name":"vision debug","func":"\n\nlet topic = \"qpgs2\"; //choix du topic à vérifier\n\nif (msg.type == topic){\n   msg.payload = msg.payload;\n    node.send(msg);\n}\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":370,"y":540,"wires":[["b3c2789e556b18c8"]]},{"id":"b3c2789e556b18c8","type":"debug","z":"9c0ee1028b125264","g":"78c8b76577708c4d","name":"debug 155","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":550,"y":540,"wires":[]},{"id":"3f26f279cde71e8d","type":"inject","z":"9c0ee1028b125264","name":"qpgs","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":90,"y":280,"wires":[["2399e0e8048b5a56"]]},{"id":"2399e0e8048b5a56","type":"function","z":"9c0ee1028b125264","name":"function 55","func":"msg.topic = \"qpgs2\";\nmsg.payload = '(1 00000000000000 P 00 000.0 00.00 000.0 00.00 0000 0000 000 00.0 000 045 000.0 000 00000 00000 000 00000000 0 0 000 000 000 00 000�\u0011';\nnode.send(msg);\n\nmsg.topic = \"qpgs3\";\nmsg.payload = '(1 00000000000000 P 00 000.0 00.00 000.0 00.00 0000 0000 000 00.0 000 045 000.0 000 00000 00000 000 00000000 0 0 000 000 000 00 000�\u0011';\n//msg.payload = '(NAK 4 ';\nnode.send(msg);\n\nmsg.topic = \"qpgs4\";\nmsg.payload = '(1 00000000000000 P 00 000.0 00.00 000.0 00.00 0000 0000 000 00.0 000 045 000.0 000 00000 00000 000 00000000 0 0 000 000 000 00 000�\u0011';\n//msg.payload = '(NAK 4 ';\nnode.send(msg);\n\nmsg.topic = \"qpgs5\";\nmsg.payload = '(0 00000000000000 P 00 000.0 00.00 000.0 00.00 0000 0000 000 00.0 000 045 000.0 000 00000 00000 000 00000000 0 0 000 000 000 00 000�\u0011';\n//msg.payload = '(NAK 4 ';\nnode.send(msg);\n\nmsg.topic = \"qpgs6\";\nmsg.payload = '(0 00000000000000 P 00 000.0 00.00 000.0 00.00 0000 0000 000 00.0 000 045 000.0 000 00000 00000 000 00000000 0 0 000 000 000 00 000�\u0011';\n//msg.payload = '(NAK 4 ';\nnode.send(msg);\n\nmsg.topic = \"qpgs7\";\nmsg.payload = '(0 96332303104165 B 00 229.2 49.98 231.8 50.00 0162 0032 002 53.0 000 058 120.1 000 00416 00225 001 10100010 4';\n//msg.payload = '(NAK 4 ';\nnode.send(msg);\n\nmsg.topic = \"qpgs8\";\nmsg.payload = '(0 96332303104165 B 00 229.2 49.98 231.8 50.00 0162 0032 002 53.0 000 058 120.1 000 00416 00225 001 10100010 4';\n//msg.payload = '(NAK 4 ';\nnode.send(msg);\n\nmsg.topic = \"qpig\";\nmsg.payload = '(231.0 50.0 230.3 50.0 0069 0027 001 373 53.00 000 058 0022 00.3 120.1 00.00 00000 00010010 00 00 00045 010��';\nnode.send(msg);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":90,"y":340,"wires":[["efd023f511690a18","efea33497c071b44"]]},{"id":"af37b8e53dc2b591","type":"function","z":"9c0ee1028b125264","g":"78c8b76577708c4d","name":"Retour QPGSn","func":"\n\nlet topic = \"qpgs2\"; //choix du topic à vérifier\n\nif (msg.type == topic){\n   msg.payload = msg.payload;\n    node.send(msg);\n}\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":380,"y":500,"wires":[[]]},{"id":"9b90bb9ebd7761e7","type":"function","z":"9c0ee1028b125264","name":"Vérif nb onduleur","func":"\nmsg.payload = (global.get(\"qpgs1\") == \"NAK\") ? 1 :\n              (global.get(\"qpgs2\") == \"false\") ? 1 :\n              (global.get(\"qpgs3\") == \"false\") ? 2 :\n              (global.get(\"qpgs4\") == \"false\") ? 3 :\n              (global.get(\"qpgs5\") == \"false\") ? 4 :\n              (global.get(\"qpgs6\") == \"false\") ? 5 :\n              (global.get(\"qpgs7\") == \"false\") ? 6 :\n              (global.get(\"qpgs8\") == \"false\") ? 7 : \n              8 ;\n\nglobal.set(\"nbOnduleur\", msg.payload);\nmsg.topic = global.get(\"mqttDirSmart\") + '/' + global.get(\"onduleurType\") + '/totalond';\nnode.send(msg);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":790,"y":800,"wires":[["2494bab20cd413cc","922f1fed2f365880"]]},{"id":"2494bab20cd413cc","type":"debug","z":"9c0ee1028b125264","name":"debug 157","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":990,"y":840,"wires":[]},{"id":"081c4ac72379ce2e","type":"inject","z":"9c0ee1028b125264","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":800,"wires":[["4271c6144086205d"]]},{"id":"4271c6144086205d","type":"function","z":"9c0ee1028b125264","name":"Purge variable","func":"global.set(\"qpig\", undefined);\nglobal.set(\"qpigs2\", undefined);\nglobal.set(\"qbeqi\", undefined);\nglobal.set(\"qflag\", undefined);\nglobal.set(\"qpgs1\", undefined);\nglobal.set(\"qpgs2\", undefined);\nglobal.set(\"qpiws\", undefined);\nglobal.set(\"QID\", undefined);\nglobal.set(\"QSID\", undefined);\nglobal.set(\"QVFW\", undefined);\nglobal.set(\"qpgs1\", undefined);\nglobal.set(\"qpgs2\", undefined);\nglobal.set(\"qpgs3\", undefined);\nglobal.set(\"qpgs4\", undefined);\nglobal.set(\"qpgs5\", undefined);\nglobal.set(\"qpgs6\", undefined);\nglobal.set(\"qpgs7\", undefined);\nglobal.set(\"qpgs8\", undefined);\nglobal.set(\"qpgs9\", undefined);\n\nglobal.set(\"test_qpgs1\", undefined);\nglobal.set(\"test_qpgs2\", undefined);\nglobal.set(\"test_qpgs3\", undefined);\nglobal.set(\"test_qpgs4\", undefined);\nglobal.set(\"test_qpgs5\", undefined);\nglobal.set(\"test_qpgs6\", undefined);\nglobal.set(\"test_qpgs7\", undefined);\nglobal.set(\"test_qpgs8\", undefined);\nglobal.set(\"test_qpgs9\", undefined);","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":320,"y":800,"wires":[[]]},{"id":"331f91367de2f914","type":"inject","z":"9c0ee1028b125264","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3600","crontab":"","once":true,"onceDelay":"40","topic":"","payload":"","payloadType":"date","x":600,"y":800,"wires":[["9b90bb9ebd7761e7"]]},{"id":"922f1fed2f365880","type":"link out","z":"9c0ee1028b125264","name":"link out 19","mode":"link","links":["58815987c51e2a0f"],"x":935,"y":800,"wires":[]},{"id":"0315d76cd6d49376","type":"link in","z":"9c0ee1028b125264","d":true,"name":"log","links":["500c2cc0b7e98c26","62edb1adc67806fc"],"x":75,"y":900,"wires":[["e26e94075cf16a3d"]]},{"id":"7f7c4741841f7cd5","type":"file","z":"9c0ee1028b125264","d":true,"name":"","filename":"/media/smartphoton.log","filenameType":"str","appendNewline":true,"createDir":false,"overwriteFile":"false","encoding":"none","x":450,"y":900,"wires":[[]]},{"id":"e26e94075cf16a3d","type":"function","z":"9c0ee1028b125264","d":true,"name":"function 56","func":"msg.payload = msg.topic + '\\n'+ msg.payload\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":190,"y":900,"wires":[["7f7c4741841f7cd5"]]},{"id":"8d65fd717cc3104c","type":"change","z":"34242fea930de037","name":"Smartphoton Global","rules":[{"t":"set","p":"model","pt":"msg","to":"VERSION","tot":"env"},{"t":"set","p":"manufacturer","pt":"msg","to":"Smartphoton","tot":"str"},{"t":"set","p":"value","pt":"msg","to":"{{value}}","tot":"str"},{"t":"set","p":"configuration_url","pt":"msg","to":"https://domosimple.eu","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":120,"y":100,"wires":[["70c1b6d8aff0eb99","2e464f438a03cc52"]]},{"id":"70c1b6d8aff0eb99","type":"change","z":"34242fea930de037","g":"4cfcbd6d8376184f","name":"type sensor","rules":[{"t":"set","p":"type_ha","pt":"msg","to":"sensor","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":140,"wires":[["f49f3e972d1dd374","32d9b99943ad61e9","bda5dd5d13f13ec1","c350aafdc2ec44da","24a6e831c0984006","47f8d8ee8dc1fed2","54f7f2edafc6dc96","4c84a6bbea2bf75f"]]},{"id":"239461aea9f16532","type":"template","z":"34242fea930de037","g":"4cfcbd6d8376184f","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n  \"name\": \"{{global.nameOnduleur}} {{ha_num_onduleur}} {{ha_name_topic}}\",\n  {{{ha_device_class}}} \n  {{{ha_unit_of_measurement}}}\n  \"state_topic\": \"{{global.mqttDirSmart}}/{{global.onduleurType}}/{{ha_state_topic}}\", \n  \"value_template\": \"{{ value }}\",\n  \"object_id\": \"{{global.onduleurType}}_{{ha_num_onduleur}}_{{ha_type_topic}}_{{ha_nom_unit}}\",\n  \"unique_id\": \"{{global.onduleurType}}_{{ha_num_onduleur}}_{{type_ha}}_{{ha_type_topic}}_{{ha_nom_unit}}\", \n  {{{ha_icon}}}\n  \"device\":{\n    \"manufacturer\": \"{{manufacturer}}\",\n\t  \"name\": \"{{global.nameOnduleur}} {{ha_num_onduleur}}\",\n\t  \"model\": \"{{model}}\",\n    \"configuration_url\": \"{{{configuration_url}}}\",\n\t  \"identifiers\": [\"{{global.onduleurType}}_{{ha_num_onduleur}}\"]\n\t}\n}","output":"str","x":820,"y":200,"wires":[["9d3234a61a871a7e"]]},{"id":"9d3234a61a871a7e","type":"template","z":"34242fea930de037","name":"","field":"topic","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"homeassistant/{{type_ha}}/{{global.onduleurType}}_{{ha_num_onduleur}}/{{global.onduleurType}}_{{ha_num_onduleur}}_{{type_ha}}_{{ha_type_topic}}_{{ha_nom_unit}}/config","output":"str","x":1020,"y":200,"wires":[["c9299e4c6f14b323","7c9abb7911544a7a"]]},{"id":"2e464f438a03cc52","type":"change","z":"34242fea930de037","g":"6456c1c3bee5d753","name":"type select","rules":[{"t":"set","p":"type_ha","pt":"msg","to":"select","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":350,"y":440,"wires":[["d542d7000127ca32"]]},{"id":"21d2e9636322273d","type":"template","z":"34242fea930de037","g":"6456c1c3bee5d753","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{ \n  \"name\": \"{{global.nameOnduleur}} {{ha_num_onduleur}} {{ha_name_topic}}\", \n  \"object_id\":\"{{global.onduleurType}}__{{ha_num_onduleur}}_{{ha_type_topic}}_{{ha_nom_unit}}\",\n  \"unique_id\": \"{{global.onduleurType}}__{{ha_num_onduleur}}_{{type_ha}}_{{ha_type_topic}}_{{ha_nom_unit}}\", \n  \"command_topic\": \"{{global.mqttDirSmart}}/{{global.onduleurType}}-Modification/Param{{ha_num_param}}\",\n  \"command_template\": \"{{value}}\",\n  \"state_topic\": \"{{global.mqttDirSmart}}/{{global.onduleurType}}/{{ha_state_topic}}\", \n  \"value_template\": \"{{ value }}\",\n  \"options\":  [ {{{ha_select}}} ],\n  \"device\":{\n    \"manufacturer\":\"{{manufacturer}}\",\n  \t\"name\":\"{{global.nameOnduleur}} {{ha_num_onduleur}}\", \n  \t\"model\":\"{{model}}\",\n    \"configuration_url\": \"{{{configuration_url}}}\",\n  \t\"identifiers\":[\"{{global.onduleurType}}_{{ha_num_onduleur}}\"]\n\t}\n}","output":"str","x":760,"y":440,"wires":[["9d3234a61a871a7e","f2a83d009648b076"]]},{"id":"7c9abb7911544a7a","type":"link out","z":"34242fea930de037","name":"MQTT-External-broker-ou","mode":"link","links":["f0a67a123389764d","cc78d1176a0b826d","58815987c51e2a0f","a826c052e06f7959"],"x":1135,"y":200,"wires":[]},{"id":"c9299e4c6f14b323","type":"debug","z":"34242fea930de037","name":"debug 53","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1180,"y":160,"wires":[]},{"id":"68461dd61c182250","type":"inject","z":"34242fea930de037","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"300","crontab":"","once":true,"onceDelay":"20","topic":"","payload":"","payloadType":"date","x":130,"y":40,"wires":[["8d65fd717cc3104c"]]},{"id":"fe31b0ac4ea182ba","type":"function","z":"34242fea930de037","name":"Remplace mqtt => onduleur","func":"let dir = global.get(\"mqttDirSmart\") + '/' + global.get(\"onduleurType\") + '-Modification/Param';\nlet payload = '';\n\n\n\n\n/*-------------------------------------------------*/\n//parametre 01\n/*-------------------------------------------------*/\nif (msg.topic == dir + '01') {\n\n    let str = msg.payload;\n    msg.topic = 'msg.topic';\n\n    //option remplace\n    payload = (msg.payload == \"UTI\") ? new Buffer([80,79,80,48,48,194,72,13]) :\n              (msg.payload == \"SOL\") ? new Buffer([80,79,80,48,49,210,105,13]) :\n              (msg.payload == \"SBU\") ? new Buffer([80,79,80,48,50,226,11,13]) :\n               'Erreur';\n\n}\n\n/*-------------------------------------------------*/\n//parametre 02\n/*-------------------------------------------------*/\nif (msg.topic == dir + '02') {\n\n    let str = msg.payload;\n    msg.topic = 'msg.topic';\n\n    //option remplace\n    payload = (msg.payload == \"010\") ? new Buffer([77,78,67,72,71,67,48,49,48,77,185,13]) :\n              (msg.payload == \"020\") ? new Buffer([77,78,67,72,71,67,48,50,48,24,234,13]) :\n              (msg.payload == \"030\") ? new Buffer([77,78,67,72,71,67,48,51,48,43,219,13]) :\n              (msg.payload == \"040\") ? new Buffer([77,78,67,72,71,67,48,52,48,178,76,13]) :\n              (msg.payload == \"050\") ? new Buffer([77,78,67,72,71,67,48,53,48,129,125,13]) :\n              (msg.payload == \"060\") ? new Buffer([77,78,67,72,71,67,48,54,48,212,46,13]) :\n              (msg.payload == \"070\") ? new Buffer([77,78,67,72,71,67,48,55,48,231,31,13]) :\n              (msg.payload == \"080\") ? new Buffer([77,78,67,72,71,67,48,56,48,247,33,13]) :\n               'Erreur';\n\n}\n\n/*-------------------------------------------------*/\n//parametre 05\n/*-------------------------------------------------*/\nif (msg.topic == dir + '05') {\n\n    let str = msg.payload;\n    msg.topic = 'msg.topic';\n\n    //option remplace\n    payload = (msg.payload == \"AGn\") ? new Buffer([80,66,84,48,48,39,14,13]) :\n              (msg.payload == \"FLd\") ? new Buffer([80,66,84,48,49,55,47,13]) :\n              (msg.payload == \"USE\") ? new Buffer([80,66,84,48,50,7,76,13]) :\n              (msg.payload == \"PYL\") ? new Buffer([80,66,84,48,51,23,109,13]) :\n              (msg.payload == \"uEC\") ? new Buffer([80,66,84,48,52,103,138,13]) :\n              (msg.payload == \"SOL\") ? new Buffer([80,66,84,48,53,119,171,13]) :\n              (msg.payload == \"LIb\") ? new Buffer([80,66,84,48,54,71,200,13]) :\n              (msg.payload == \"LIc\") ? new Buffer([80,66,84,48,55,87,233,13]) :\n               'Erreur';\n\n}\n\n\n/*-------------------------------------------------*/\n//parametre 11\n/*-------------------------------------------------*/\nif (msg.topic == dir + '11') {\n\n    let str = msg.payload;\n    msg.topic = 'msg.topic';\n\n    //option remplace\n    payload = (msg.payload == \"2\") ? new Buffer([77,85,67,72,71,67,48,48,50,181,209,13]) :\n              (msg.payload == \"10\") ? new Buffer([77,85,67,72,71,67,48,49,48,166,162,13]) :\n              (msg.payload == \"20\") ? new Buffer([77,85,67,72,71,67,48,50,48,243,241,13]) :\n              (msg.payload == \"30\") ? new Buffer([77,85,67,72,71,67,48,51,48,192,192,13]) :\n              (msg.payload == \"50\") ? new Buffer([77,85,67,72,71,67,48,53,48,106,102,13]) :\n              'Erreur';\n}\n\n/*-------------------------------------------------*/\n//parametre 12\n/*-------------------------------------------------*/\nif (msg.topic == dir + '12') {\n\n    let str = msg.payload;\n    msg.topic = 'msg.topic';\n\n    //option remplace\n    payload = (msg.payload == \"22.0\") ? new Buffer([80,66,67,86,50,50,46,48,115,210,13]) :\n              (msg.payload == \"22.5\") ? new Buffer([80,66,67,86,50,50,46,53,35,119,13]) :\n              (msg.payload == \"23.0\") ? new Buffer([80,66,67,86,50,51,46,48,68,226,13]) :\n              (msg.payload == \"23.5\") ? new Buffer([80,66,67,86,50,51,46,53,20,71,13]) :\n              (msg.payload == \"24.0\") ? new Buffer([80,66,67,86,50,52,46,48,193,114,13]) :\n              (msg.payload == \"24.5\") ? new Buffer([80,66,67,86,50,52,46,53,145,215,13]) :\n              (msg.payload == \"25.0\") ? new Buffer([80,66,67,86,50,53,46,48,246,66,13]) :\n              (msg.payload == \"25.5\") ? new Buffer([80,66,67,86,50,53,46,53,166,231,13]) :\n              (msg.payload == \"44.0\") ? new Buffer([80,66,67,86,52,52,46,48,230,235,13]) :\n              (msg.payload == \"45.0\") ? new Buffer([80,66,67,86,52,53,46,48,209,219,13]) :\n              (msg.payload == \"46.0\") ? new Buffer([80,66,67,86,52,54,46,48,136,139,13]) :\n              (msg.payload == \"47.0\") ? new Buffer([80,66,67,86,52,55,46,48,191,187,13]) :\n              (msg.payload == \"48.0\") ? new Buffer([80,66,67,86,52,56,46,48,147,138,13]) :\n              (msg.payload == \"49.0\") ? new Buffer([80,66,67,86,52,57,46,48,164,186,13]) :\n              (msg.payload == \"50.0\") ? new Buffer([80,66,67,86,53,48,46,48,76,159,13]) :\n              (msg.payload == \"51.0\") ? new Buffer([80,66,67,86,53,49,46,48,123,175,13]) :\n              'Erreur';\n}\n\n/*-------------------------------------------------*/\n//parametre 13\n/*-------------------------------------------------*/\nif (msg.topic == dir + '13') {\n\n    let str = msg.payload;\n    msg.topic = 'msg.topic';\n\n    //option remplace\n    payload = (msg.payload == \"24.0\") ? new Buffer([80,66,68,86,50,52,46,48,147,48]) :\n              (msg.payload == \"24.5\") ? new Buffer([80,66,68,86,50,52,46,53,89,150,13]) :\n              (msg.payload == \"25.0\") ? new Buffer([80,66,68,86,50,53,46,48,62,3,13]) :\n              (msg.payload == \"25.5\") ? new Buffer([80,66,68,86,50,53,46,53,110,166,13]) :\n              (msg.payload == \"26.0\") ? new Buffer([80,66,68,86,50,54,46,48,103,83,13]) :\n              (msg.payload == \"26.5\") ? new Buffer([80,66,68,86,50,54,46,53,55,246,13]) :\n              (msg.payload == \"27.0\") ? new Buffer([80,66,68,86,50,55,46,48,80,99,13]) :\n              (msg.payload == \"27.5\") ? new Buffer([80,66,68,86,50,55,46,53,198,13]) :\n              (msg.payload == \"28.0\") ? new Buffer([80,66,68,86,50,56,46,48,124,82,13]) :\n              (msg.payload == \"28.5\") ? new Buffer([80,66,68,86,50,56,46,53,44,247,13]) :\n              (msg.payload == \"29.0\") ? new Buffer([80,66,68,86,50,57,46,48,75,98,13]) :\n              (msg.payload == \"48.0\") ? new Buffer([80,66,68,86,52,56,46,48,91,203,13]) :\n              (msg.payload == \"49.0\") ? new Buffer([80,66,68,86,52,57,46,48,108,251,13]) :\n              (msg.payload == \"50.0\") ? new Buffer([80,66,68,86,53,48,46,48,132,222,13]) :\n              (msg.payload == \"51.0\") ? new Buffer([80,66,68,86,53,49,46,48,179,238,13]) :\n              (msg.payload == \"52.0\") ? new Buffer([80,66,68,86,53,50,46,48,234,190,13]) :\n              (msg.payload == \"53.0\") ? new Buffer([80,66,68,86,53,51,46,48,221,142,13]) :\n              (msg.payload == \"54.0\") ? new Buffer([80,66,68,86,53,52,46,48,88,30,13]) :\n              (msg.payload == \"55.0\") ? new Buffer([80,66,68,86,53,53,46,48,111,46,13]) :\n              (msg.payload == \"56.0\") ? new Buffer([80,66,68,86,53,54,46,48,54,126,13]) :\n              (msg.payload == \"57.0\") ? new Buffer([80,66,68,86,53,55,46,48,20,224]) :\n              (msg.payload == \"58.0\") ? new Buffer([80,66,68,86,53,56,46,48,45,127,13]) :\n              'Erreur';\n}\n\n\n/*-------------------------------------------------*/\n//parametre 16\n/*-------------------------------------------------*/\nif (msg.topic == dir + '16') {\n\n    let str = msg.payload;\n    msg.topic = 'msg.topic';\n\n    //option remplace\n    payload = (msg.payload == \"CUE\") ? new Buffer([80,67,80,48,48,141,122,13]) :\n              (msg.payload == \"CSO\") ? new Buffer([80,67,80,48,49,157,91,13]) :\n              (msg.payload == \"SNU\") ? new Buffer([80,67,80,48,50,173,56,13]) :\n              (msg.payload == \"OSO\") ? new Buffer([80,67,80,48,51,189,25,13]) :\n              'Erreur';\n}\n\n/*-------------------------------------------------*/\n//parametre 27\n/*-------------------------------------------------*/\nif (msg.topic == dir + '27') {\n\n    let str = msg.payload;\n    msg.topic = 'msg.topic';\n\n    //option remplace\n    payload = (msg.payload == \"24.0\") ? new Buffer([80,66,70,84,50,52,46,48,198,240,13]) :\n              (msg.payload == \"24.5\") ? new Buffer([80,66,70,84,50,52,46,53,150,85,13]) :\n              (msg.payload == \"25.0\") ? new Buffer([80,66,70,84,50,53,46,48,241,192,13]) :\n              (msg.payload == \"25.5\") ? new Buffer([80,66,70,84,50,53,46,53,161,101,13]) :\n              (msg.payload == \"26.0\") ? new Buffer([80,66,70,84,50,54,46,48,168,144,13]) :\n              (msg.payload == \"26.5\") ? new Buffer([80,66,70,84,50,54,46,53,248,53,13]) :\n              (msg.payload == \"27.0\") ? new Buffer([80,66,70,84,50,55,46,48,159,160,13]) :\n              (msg.payload == \"27.5\") ? new Buffer([80,66,70,84,50,55,46,53,207,5,13]) :\n              (msg.payload == \"28.0\") ? new Buffer([80,66,70,84,50,56,46,48,179,145,13]) :\n              (msg.payload == \"28.5\") ? new Buffer([80,66,70,84,50,56,46,53,227,52,13]) :\n              (msg.payload == \"29.0\") ? new Buffer([80,66,70,84,50,57,46,48,132,161,13]) :\n              (msg.payload == \"48.0\") ? new Buffer([80,66,70,84,52,56,46,48,148,8,13]) :\n              (msg.payload == \"48.5\") ? new Buffer([80,66,70,84,52,56,46,53,196,173,13]) :\n              (msg.payload == \"49.0\") ? new Buffer([80,66,70,84,52,57,46,48,163,56,13]) :\n              (msg.payload == \"49.5\") ? new Buffer([80,66,70,84,52,57,46,53,243,157,13]) :\n              (msg.payload == \"50.0\") ? new Buffer([80,66,70,84,53,48,46,48,75,29,13]) :\n              (msg.payload == \"50.5\") ? new Buffer([80,66,70,84,53,48,46,53,27,184,13]) :\n              (msg.payload == \"51.0\") ? new Buffer([80,66,70,84,53,49,46,48,124,45,13]) :\n              (msg.payload == \"51.5\") ? new Buffer([80,66,70,84,53,49,46,53,44,136,13]) :\n              (msg.payload == \"52.0\") ? new Buffer([80,66,70,84,53,50,46,48,37,125,13]) :\n              (msg.payload == \"52.5\") ? new Buffer([80,66,70,84,53,50,46,53,117,216,13]) :\n              (msg.payload == \"53.0\") ? new Buffer([80,66,70,84,53,51,46,48,18,77,13]) :\n              (msg.payload == \"53.5\") ? new Buffer([80,66,70,84,53,51,46,53,66,232,13]) :\n              (msg.payload == \"54.0\") ? new Buffer([80,66,70,84,53,52,46,48,151,221,13]) :\n              (msg.payload == \"54.5\") ? new Buffer([80,66,70,84,53,52,46,53,199,120,13]) :\n              (msg.payload == \"55.0\") ? new Buffer([80,66,70,84,53,53,46, 48,160,237,13]) :\n              (msg.payload == \"55.5\") ? new Buffer([80,66,70,84,53,53,46,53,240,72,13]) :\n              (msg.payload == \"56.0\") ? new Buffer([80,66,70,84,53,54,46,48,249,189,13]) :\n              (msg.payload == \"56.5\") ? new Buffer([80,66,70,84,53,54,46,53,169,24,13]) :\n              (msg.payload == \"57.0\") ? new Buffer([80,66,70,84,53,55,46,48,206,141,13]) :\n              (msg.payload == \"57.5\") ? new Buffer([80,66,70,84,53,55,46,53,158,40,13]) :\n              (msg.payload == \"58.0\") ? new Buffer([80,66,70,84,53,56,46,48,226,188,13]) :\n              'Erreur';\n}\n\n/*-------------------------------------------------*/\n//parametre 29\n/*-------------------------------------------------*/\nif (msg.topic == dir + '29') {\n\n    let str = msg.payload;\n    msg.topic = 'msg.topic';\n\n    //option remplace\n    payload = (msg.payload == \"21.0\") ? new Buffer([80,83,68,86,50,49,46,48,109,217,13]) :\n              (msg.payload == \"21.5\") ? new Buffer([80,83,68,86,50,49,46,53,61,124,13]) :\n              (msg.payload == \"22.0\") ? new Buffer([80,83,68,86,50,50,46,48,52,137,13]) :\n              (msg.payload == \"22.5\") ? new Buffer([80,83,68,86,50,50,46,53,100,44,13]) :\n              (msg.payload == \"23.0\") ? new Buffer([80,83,68,86,50,51,46,48,59,144]) :\n              (msg.payload == \"23.5\") ? new Buffer([80,83,68,86,50,51,46,53,83,28,13]) :\n              (msg.payload == \"24.0\") ? new Buffer([80,83,68,86,50,52,46,48,134,41,13]) :\n              (msg.payload == \"42.0\") ? new Buffer([80,83,68,86,52,50,46,48,19,16,13]) :\n              (msg.payload == \"42.5\") ? new Buffer([80,83,68,86,52,50,46,53,67,181,13]) :\n              (msg.payload == \"43.0\") ? new Buffer([80,83,68,86,52,51,46,48,36,32,13]) :\n              (msg.payload == \"43.5\") ? new Buffer([80,83,68,86,52,51,46,53,116,133,13]) :\n              (msg.payload == \"44.0\") ? new Buffer([80,83,68,86,52,52,46,48,161,176,13]) :\n              (msg.payload == \"44.5\") ? new Buffer([80,83,68,86,52,52,46,53,241,21,13]) :\n              (msg.payload == \"45.0\") ? new Buffer([80,83,68,86,52,53,46,48,150,128,13]) :\n              (msg.payload == \"45.5\") ? new Buffer([80,83,68,86,52,53,46,53,198,37,13]) :\n              (msg.payload == \"46.0\") ? new Buffer([80,83,68,86,52,54,46,48,207,208,13]) :\n              (msg.payload == \"46.5\") ? new Buffer([80,83,68,86,52,54,46,53,159,117,13]) :\n              (msg.payload == \"47.0\") ? new Buffer([80,83,68,86,52,55,46,48,248,224,13]) :\n              (msg.payload == \"47.5\") ? new Buffer([80,83,68,86,52,55,46,53,168,69,13]) :\n              (msg.payload == \"48.0\") ? new Buffer([80,83,68,86,52,56,46,48,212,209,13]) :\n              'Erreur';\n}\n\n\n\nmsg.payload = new Buffer(payload);\n\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1160,"y":480,"wires":[["a2475753a3496a8c"]]},{"id":"f2a83d009648b076","type":"function","z":"34242fea930de037","name":"function 39","func":"if (msg.exportcsv == true) {\n    // msg.payload.length\n    //Nomage préfix\n    msg.payload = '[' + msg.ha_select + ']';\n    msg.topic = global.get(\"mqttDirSmart\") + '/' + global.get(\"onduleurType\") + '-Modification/Param' + msg.ha_num_param;\n    node.send(msg);\n}","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":950,"y":440,"wires":[["6263be7adc9b3bfb"]]},{"id":"6263be7adc9b3bfb","type":"json","z":"34242fea930de037","name":"","property":"payload","action":"","pretty":false,"x":1090,"y":440,"wires":[["05b8a1f058672214","39fd19d77c23972c"]]},{"id":"05b8a1f058672214","type":"function","z":"34242fea930de037","name":"function 40","func":"let payload = msg.payload\nlet count = msg.payload.length\n\nfor (let i = 0; i <= count; i++) {\n  \n  msg.payload = payload[i];\n  msg.option = msg.payload\n  node.send(msg);\n\n}\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":950,"y":480,"wires":[["fe31b0ac4ea182ba"]]},{"id":"f9c58ca9cc0677c9","type":"file","z":"34242fea930de037","name":"","filename":"/media/option.onduleur.csv","filenameType":"str","appendNewline":true,"createDir":false,"overwriteFile":"false","encoding":"none","x":1160,"y":520,"wires":[[]]},{"id":"a2475753a3496a8c","type":"function","z":"34242fea930de037","name":"function 41","func":"let buf = JSON.stringify(msg.payload);\nbuf = buf.replace('{\"type\":\"Buffer\",\"data\":', \"\");\nbuf = buf.replace(\"}\", \"\");\n\nif (buf != '[69,114,114,101,117,114]'){\n    msg.payload = msg.ha_num_param \n    + ';'\n    + msg.ha_state_topic\n    + ';'\n    + msg.option\n    + ';'\n    + buf\n    + ';'\n    + msg.payload\n    node.send(msg)\n}else{\n    \n}","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":950,"y":520,"wires":[["f9c58ca9cc0677c9"]]},{"id":"6923b234f6901db7","type":"inject","z":"34242fea930de037","name":"export parametre csv","props":[{"p":"payload"},{"p":"msg.exportcsv","v":"true","vt":"bool"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"parametre;qpiri;option;buffer;bufferString","payloadType":"str","x":160,"y":580,"wires":[["0511da08c2d1765b"]]},{"id":"8b5f9be9d75535d2","type":"comment","z":"34242fea930de037","name":"A remplacer par le dernier noeud","info":"","x":1310,"y":280,"wires":[]},{"id":"0511da08c2d1765b","type":"file","z":"34242fea930de037","name":"","filename":"/media/option.onduleur.csv","filenameType":"str","appendNewline":true,"createDir":false,"overwriteFile":"delete","encoding":"none","x":180,"y":620,"wires":[["4fec63d1fb88a863"]]},{"id":"4fec63d1fb88a863","type":"file","z":"34242fea930de037","name":"","filename":"/media/option.onduleur.csv","filenameType":"str","appendNewline":true,"createDir":false,"overwriteFile":"false","encoding":"none","x":220,"y":660,"wires":[["2e464f438a03cc52"]]},{"id":"39fd19d77c23972c","type":"debug","z":"34242fea930de037","name":"debug 135","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1230,"y":440,"wires":[]},{"id":"ef211a0bd0dd228e","type":"inject","z":"34242fea930de037","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":130,"y":720,"wires":[["adc53e278c2f7eed"]]},{"id":"adc53e278c2f7eed","type":"file in","z":"34242fea930de037","name":"","filename":"/media/option.onduleur.csv","filenameType":"str","format":"utf8","chunk":false,"sendError":false,"encoding":"none","allProps":false,"x":450,"y":720,"wires":[["aace2393923dbc7a"]]},{"id":"aace2393923dbc7a","type":"csv","z":"34242fea930de037","name":"","sep":";","hdrin":true,"hdrout":"once","multi":"mult","ret":"\\n","temp":"","skip":"0","strings":true,"include_empty_strings":"","include_null_values":"","x":720,"y":720,"wires":[["06e9f423664eaedd","7d167fb017e24f8f"]]},{"id":"06e9f423664eaedd","type":"debug","z":"34242fea930de037","name":"debug 136","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":890,"y":680,"wires":[]},{"id":"7d167fb017e24f8f","type":"function","z":"34242fea930de037","name":"function 44","func":"let count = msg.payload.length;\nlet payload = msg.payload;\n\n\n//numéro du parametre\nlet tab = [\"01\", \"02\", \"05\", \"11\", \"12\", \"13\", \"16\", \"27\", \"29\"]\nfor (let j = 0; j < tab.length; j++) {\n\n    \n    let str = '';\n    let option = '';\n\n    msg.topic = tab[j];\n\n    for (let i = 0; i < count; i++) {\n\n        if (payload[i].parametre == tab[j]) {\n            option = '\"' + payload[i].option + '\",'\n        }else {\n            option = '';\n        }\n\n        str = str + option\n    }\n\n    msg.payload = str.substring(0, str.length - 1);\n    node.send(msg);\n}\n\n//msg.payload = str.substring(0, str.length - 1);\n//node.send(msg);\n//return msg","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":890,"y":720,"wires":[["1c456feef826dd00"]]},{"id":"1c456feef826dd00","type":"debug","z":"34242fea930de037","name":"debug 137","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1070,"y":720,"wires":[]},{"id":"67b9dd691ff2653a","type":"function","z":"34242fea930de037","name":"function 45","func":"let count = msg.payload.length;\nlet payload = msg.payload;\nlet str = '';\nlet option = '';\n\n\n    for (let i = 0; i < count; i++) {\n\n        if (payload[i].parametre == \"05\") {\n            option = '\"' + payload[i].option + '\",'\n        }else {\n            option = '';\n        }\n\n        str = str + option\n    }\n\nmsg.payload = str.substring(0, str.length - 1);\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":890,"y":760,"wires":[[]]},{"id":"f49f3e972d1dd374","type":"function","z":"34242fea930de037","g":"4cfcbd6d8376184f","name":"a suppr ancien modele","func":"/*-------------------------------------------------*/\n//Puissance \n/*-------------------------------------------------*/\n\n msg.ha_device_class = '\"device_class\": \"energy\",';\n msg.ha_unit_of_measurement = '\"unit_of_measurement\": \"W\",';\n msg.ha_nom_unit = 'watt';\n\t\n\t/*-------------------------------------------------*/\n\t//PV Puissance (Watt)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"namePV\");\n\t msg.ha_type_topic = 'pv';\n\t msg.ha_icon = '\"icon\": \"mdi:solar-power-variant\",';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic_1\") ? 'qpig_19' :\n\t\t\t\t\t      (global.get(\"onduleurType\") == \"easun_1\") ? 'batPV_9' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\n\t//si qpigs2 (2ème string) est différent de NAK\n\tif (global.get(\"qpigs2\") != 'NAK'){\n\n\t\t/*-------------------------------------------------*/\n\t\t//PV Puissance 2 (Watt)\n\t\t/*-------------------------------------------------*/\n\t\tmsg.ha_name_topic = global.get(\"namePV2\");\n\t\tmsg.ha_type_topic = 'pv2';\n\t\tmsg.ha_icon = '\"icon\": \"mdi:solar-power-variant\",';\n\t\t\n\t\tmsg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic_1\") ? 'qpigs2_2' :\n\t\t\t\t\t\t\t(global.get(\"onduleurType\") == \"easun_1\") ? '' :\n\t\t\t\t\t\t\t'Erreur';\n\t\t\t\t\t\t\t\n\t\tnode.send(msg)\n\n\t}\n\n\t/*-------------------------------------------------*/\n\t//Batt Charge (Watt)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"nameBatt_charge\");\n\t msg.ha_type_topic = 'batt_charge';\n\t msg.ha_icon = '\"icon\": \"mdi:battery-arrow-up-outline\",';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic_1\")? 'custom_1' :\n\t\t\t\t    \t  (global.get(\"onduleurType\") == \"easun_1\") ? 'batPV_14' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\t\n\t/*-------------------------------------------------*/\n\t//Batt decharge (Watt)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"nameBatt_batt_decharge\");\n\t msg.ha_type_topic = 'batt_decharge';\n\t msg.ha_icon = '\"icon\": \"mdi:battery-arrow-down-outline\",';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic_1\") ? 'custom_2' :\n\t\t\t\t\t      (global.get(\"onduleurType\") == \"easun_1\") ? '' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\t\n\t/*-------------------------------------------------*/\n\t//Batt charge Decharge sens (Watt)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"nameBatt_batt_chargedecharge\");\n\t msg.ha_type_topic = 'batt_charge_decharge';\n\t msg.ha_icon = '\"icon\": \"mdi:battery-arrow-down-outline\",';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic_1\") ? 'custom_3' :\n\t\t\t\t\t      (global.get(\"onduleurType\") == \"easun_1\") ? '' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\n\t/*-------------------------------------------------*/\n\t//Conso Maison (Watt)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"nameConso_maison\");\n\t msg.ha_type_topic = 'conso_maison';\n\t msg.ha_icon = '\"icon\": \"mdi:home-lightning-bolt-outline\",';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic_1\") ? 'qpig_5' :\n\t\t\t\t\t      (global.get(\"onduleurType\") == \"easun_1\") ? 'data_23' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\t\n/*-------------------------------------------------*/\n//Tension \n/*-------------------------------------------------*/\n\n msg.ha_device_class = '\"device_class\": \"voltage\",';\n msg.ha_unit_of_measurement = '\"unit_of_measurement\": \"V\",';\n msg.ha_nom_unit = 'volt';\n\n\t/*-------------------------------------------------*/\n\t//Grid Tension (Volt)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"nameGridTension\");\n\t msg.ha_type_topic = 'grid_tension';\n\tmsg.ha_icon = '';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic_1\")? 'qpig_0' :\n\t\t\t\t\t      (global.get(\"onduleurType\") == \"easun_1\") ? 'data_15' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\t\n\t/*-------------------------------------------------*/\n\t//Batterie Voltage (Volt)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"nameBattTensiont\");\n\t msg.ha_type_topic = 'batt';\n\tmsg.ha_icon = '';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic_1\") ? 'qpig_8' :\n\t\t\t\t\t      (global.get(\"onduleurType\") == \"easun_1\") ? 'batPV_1' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\t\n\t/*-------------------------------------------------*/\n\t//PV Voltage (Volt)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"namePvTensiont\");\n\t msg.ha_type_topic = 'pv';\n\t msg.ha_icon = '';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic_1\") ? 'qpig_13' :\n\t\t\t\t\t      (global.get(\"onduleurType\") == \"easun_1\") ? 'batPV_7' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\n\t//si qpigs2 (2ème string) est différent de NAK\n\tif (global.get(\"qpigs2\") != 'NAK'){\n\n\t\t/*-------------------------------------------------*/\n\t\t//PV2 Voltage (Volt)\n\t\t/*-------------------------------------------------*/\n\t\tmsg.ha_name_topic = global.get(\"namePv2Tensiont\");\n\t\tmsg.ha_type_topic = 'pv2';\n\t\tmsg.ha_icon = '';\n\t\t\n\t\tmsg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic_1\") ? 'qpigs2_1' :\n\t\t\t\t\t\t\t(global.get(\"onduleurType\") == \"easun_1\") ? '' :\n\t\t\t\t\t\t\t'Erreur';\n\t\t\t\t\t\t\t\n\t\tnode.send(msg)\n\t}\n\t\n\t/*-------------------------------------------------*/\n\t//Onduleur Tension (Volt)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"nameOnduleurTension\");\n\t msg.ha_type_topic = 'onduleur_tension';\n\t msg.ha_icon = '';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic_1\") ? 'qpig_2' :\n\t\t\t\t\t      (global.get(\"onduleurType\") == \"easun_1\") ? 'data_18' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\t\n/*-------------------------------------------------*/\n//courant\n/*-------------------------------------------------*/\n\n msg.ha_device_class = '\"device_class\": \"current\",';\n msg.ha_unit_of_measurement = '\"unit_of_measurement\": \"A\",';\n msg.ha_nom_unit = 'current';\n \n\t/*-------------------------------------------------*/\n\t//Pv Intensite (Amp)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"namePvIntensite\");\n\t msg.ha_type_topic = 'pv_intensite';\n\t msg.ha_icon = '';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic_1\") ? 'qpig_12' :\n\t\t\t\t\t      (global.get(\"onduleurType\") == \"easun_1\") ? 'batPV_8' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\n\t//si qpigs2 (2ème string) est différent de NAK\n\tif (global.get(\"qpigs2\") != 'NAK'){\n\n\t\t/*-------------------------------------------------*/\n\t\t//Pv 2 Intensite (Amp)\n\t\t/*-------------------------------------------------*/\n\t\tmsg.ha_name_topic = global.get(\"namePv2Intensite\");\n\t\tmsg.ha_type_topic = 'pv2_intensite';\n\t\tmsg.ha_icon = '';\n\t\t\n\t\tmsg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic_1\") ? 'qpigs2_0' :\n\t\t\t\t\t\t\t(global.get(\"onduleurType\") == \"easun_1\") ? '' :\n\t\t\t\t\t\t\t'Erreur';\n\t\t\t\t\t\t\t\n\t\tnode.send(msg)\n\n\t}\n\t\n\t/*-------------------------------------------------*/\n\t//Batt Charge (Amp)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"nameBattChargeIntensite\");\n\t msg.ha_type_topic = 'batt_charge_intensite';\n\tmsg.ha_icon = '';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic_1\") ? 'qpig_9' :\n\t\t\t\t\t      (global.get(\"onduleurType\") == \"easun_1\") ? 'batPV_2' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\t\n\t/*-------------------------------------------------*/\n\t//Batt Decharge (Amp)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"nameBattDechargeIntensite\");\n\t msg.ha_type_topic = 'batt_decharge_intensite';\n\t msg.ha_icon = '';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic_1\") ? 'qpig_15' :\n\t\t\t\t\t      (global.get(\"onduleurType\") == \"easun_1\") ? '' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\t\n/*-------------------------------------------------*/\n// Frequence\n/*-------------------------------------------------*/\n\n msg.ha_device_class = '\"device_class\": \"frequency\",';\n msg.ha_unit_of_measurement = '\"unit_of_measurement\": \"Hz\",';\n msg.ha_nom_unit = 'frequency';\n \n\t/*-------------------------------------------------*/\n\t//Data-Frequency (Hz)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"nameDataFrequency\");\n\t msg.ha_type_topic = 'data';\n\t msg.ha_icon = '';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic_1\") ? 'qpig_1' :\n\t\t\t\t\t      (global.get(\"onduleurType\") == \"easun_1\") ? 'data_17' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\t\n\t/*-------------------------------------------------*/\n\t//Onduleur-Frequency (Hz)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"nameOnduleurFrequency\");\n\t msg.ha_type_topic = 'onduleur_frequency';\n\t msg.ha_icon = '';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic_1\") ? 'qpig_3' :\n\t\t\t\t\t      (global.get(\"onduleurType\") == \"easun_1\") ? 'data_20' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\t\n/*-------------------------------------------------*/\n// %\n/*-------------------------------------------------*/\n\n msg.ha_device_class = '\"device_class\": \"battery\",';\n msg.ha_unit_of_measurement = '\"unit_of_measurement\": \"%\",';\n msg.ha_nom_unit = 'battery';\n \n\t/*-------------------------------------------------*/\n\t//Batterie Capacité\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"nameBattCapacite\");\n\t msg.ha_type_topic = 'batt';\n\t// msg.ha_icon = '\"icon\": \"mdi:home-lightning-bolt-outline\",';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic_1\") ? 'qpig_10' :\n\t\t\t\t\t      (global.get(\"onduleurType\") == \"easun_1\") ? '' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\t\n/*-------------------------------------------------*/\n// Mode\n/*-------------------------------------------------*/\n\n msg.ha_device_class = '';\n msg.ha_unit_of_measurement = '';\n msg.ha_nom_unit = 'info';\n \n\t/*-------------------------------------------------*/\n\t//Mode Solar\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"nameMode\");\n\t msg.ha_type_topic = 'mode';\n\t msg.ha_icon = '';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic_1\") ? 'qmod_0' :\n\t\t\t\t\t      (global.get(\"onduleurType\") == \"easun_1\") ? 'setup1_4' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\n\t//si qpigs2 (2ème string) est différent de NAK\n\tif (global.get(\"battNb\") != '0'){\n\n\t\t/*-------------------------------------------------*/\n\t\t//Mode Solar\n\t\t/*-------------------------------------------------*/\n\t\tmsg.ha_name_topic = \"Total batterie\";\n\t\tmsg.ha_type_topic = 'total_batterie';\n\t\tmsg.ha_icon = '';\n\t\t\n\t\tmsg.ha_state_topic = \"totalbatt\";\n\t\t\t\t\t\t\t\t\t\t\t\n\t\tnode.send(msg)\n\n\t}\n\t\n/*-------------------------------------------------*/\n// Temperature\n/*-------------------------------------------------*/\n\n msg.ha_device_class = '\"device_class\": \"temperature\",';\n msg.ha_unit_of_measurement = '\"unit_of_measurement\": \"°C\",';\n msg.ha_nom_unit = 'temperature';\n \n\t/*-------------------------------------------------*/\n\t//Temperature (°C)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"nameTemp\");\n\t msg.ha_type_topic = 'temp';\n\tmsg.ha_icon = '';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic_1\") ? 'qpig_11' :\n\t\t\t\t\t      (global.get(\"onduleurType\") == \"easun_1\") ? 'data_30' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\t\n\t","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":580,"y":60,"wires":[[]]},{"id":"d542d7000127ca32","type":"function","z":"34242fea930de037","g":"6456c1c3bee5d753","name":"function parametre","func":"/*-------------------------------------------------*/\n//Paramètre 01\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"nameParam01\");\nmsg.ha_type_topic = 'param01';\nmsg.ha_num_param = '01';\nmsg.ha_num_onduleur = '1';\n\n    if (global.get(\"onduleurType\") == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_16' \n        msg.ha_select = '\"UTI\", \"SOL\", \"SBU\"'\n\n    }else if (global.get(\"onduleurType\") == \"easun_1\"){\n\n        msg.ha_state_topic = '' \n        msg.ha_select = '\"UTI\", \"SOL\", \"SBU\"'\n\n    }             \n            \nnode.send(msg)\n\n/*-------------------------------------------------*/\n//Paramètre 02\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"nameParam02\");\nmsg.ha_type_topic = 'param02';\nmsg.ha_num_param = '02';\n\n    if (global.get(\"onduleurType\") == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_14' \n\n        // option((max, min, increment, decimal, prefixe, suffixe));\n        msg.ha_select = option(80, 10, 10, 0, '0', '');\n\n    }else if (global.get(\"onduleurType\") == \"easun_1\"){\n\n        // option((max, min, increment, decimal, prefixe, suffixe));\n        msg.ha_select = option(80, 10, 10, 0, '0', '');\n\n    }                      \nnode.send(msg)\n\n/*-------------------------------------------------*/\n//Paramètre 05\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"nameParam05\");\nmsg.ha_type_topic = 'param05';\nmsg.ha_num_param = '05';\n\n    if (global.get(\"onduleurType\") == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_12' \n        msg.ha_select = '\"AGn\",\"FLd\",\"USE\",\"PYL\",\"uEC\",\"SOL\",\"LIb\",\"LIC\"'\n\n    }else if (global.get(\"onduleurType\") == \"easun_1\"){\n\n        msg.ha_state_topic = '' \n        msg.ha_select = '\"AGn\",\"FLd\",\"USE\",\"PYL\",\"uEC\",\"SOL\",\"LIb\",\"LIC\"'\n\n    }\nnode.send(msg)\n\n\n\n/*-------------------------------------------------*/\n//Paramètre 11\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"nameParam11\");\nmsg.ha_type_topic = 'param11';\nmsg.ha_num_param = '11';\n\n    if (global.get(\"onduleurType\") == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_13' \n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"battTension\") == 12) ? '' :\n                        (global.get(\"battTension\") == 24) ? '' :\n                        (global.get(\"battTension\") == 48) ? '\"02\",' + option(120, 10, 10, 0, '', '') :\n\t\t\t\t\t    'Erreur'; \n\n\n    }else if (global.get(\"onduleurType\") == \"easun_1\"){\n\n        msg.ha_state_topic = ''\n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"battTension\") == 12) ? '' :\n                        (global.get(\"battTension\") == 24) ? '' :\n                      (global.get(\"battTension\") == 48) ? '\"02\",' + option(50, 10, 10, 0, '', '') :\n\t\t\t\t\t    'Erreur'; \n\n    }                  \nnode.send(msg)\n\n\n/*-------------------------------------------------*/\n//Paramètre 12\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"nameParam12\");\nmsg.ha_type_topic = 'param12';\nmsg.ha_num_param = '12';\n\n    if (global.get(\"onduleurType\") == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_8' \n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"battTension\") == 12) ? '' :\n                        (global.get(\"battTension\") == 24) ? option(25.5, 25.5, 0.5, 1, '', '') :\n                        (global.get(\"battTension\") == 48) ? option(51, 44, 1, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n\n    }else if (global.get(\"onduleurType\") == \"easun_1\"){\n\n        msg.ha_state_topic = ''\n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"battTension\") == 12) ? '' :\n                        (global.get(\"battTension\") == 24) ? option(25.5, 25.5, 0.5, 1, '', '') :\n                        (global.get(\"battTension\") == 48) ? option(51, 44, 1, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n\n    }                      \nnode.send(msg)\n\n\n/*-------------------------------------------------*/\n//Paramètre 13\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"nameParam13\");\nmsg.ha_type_topic = 'param13';\nmsg.ha_num_param = '13';\n\n    if (global.get(\"onduleurType\") == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_22' \n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"battTension\") == 12) ? '' :\n                        (global.get(\"battTension\") == 24) ? option(29, 24, 0.5, 1, '', '') :\n                        (global.get(\"battTension\") == 48) ? option(58, 48, 1, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n\n    }else if (global.get(\"onduleurType\") == \"easun_1\"){\n\n        msg.ha_state_topic = ''\n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"battTension\") == 12) ? '' :\n                        (global.get(\"battTension\") == 24) ? option(29, 24, 0.5, 1, '', '') :\n                        (global.get(\"battTension\") == 48) ? option(58, 48, 1, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n    }\n                        \nnode.send(msg)\n\n\n/*-------------------------------------------------*/\n//Paramètre 16\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"nameParam16\");\nmsg.ha_type_topic = 'param16';\nmsg.ha_num_param = '16';\n\n    if (global.get(\"onduleurType\") == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_17' \n        msg.ha_select = '\"CUE\",\"CSO\",\"SNU\",\"OSO\"'\n\n    }else if (global.get(\"onduleurType\") == \"easun_1\"){\n\n        msg.ha_state_topic = '' \n        msg.ha_select = '\"CUE\",\"CSO\",\"SNU\",\"OSO\"'\n\n    }\nnode.send(msg)\n\n\n/*-------------------------------------------------*/\n//Paramètre 27\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"nameParam27\");\nmsg.ha_type_topic = 'param27';\nmsg.ha_num_param = '27';\n\n    if (global.get(\"onduleurType\") == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_11' \n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"battTension\") == 12) ? '' :\n                        (global.get(\"battTension\") == 24) ? option(29, 24, 0.1, 1, '', '') :\n                        (global.get(\"battTension\") == 48) ? option(58.1, 48, 0.1, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n\n        \n\n    }else if (global.get(\"onduleurType\") == \"easun_1\"){\n\n        msg.ha_state_topic = ''\n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"battTension\") == 12) ? '' :\n                        (global.get(\"battTension\") == 24) ? option(29, 24, 0.1, 1, '', '') :\n                        (global.get(\"battTension\") == 48) ? option(58.1, 48, 0.1, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n\n    }                 \nnode.send(msg)\n\n\n/*-------------------------------------------------*/\n//Paramètre 29\n/*-------------------------------------------------*/\nmsg.ha_name_topic = global.get(\"nameParam29\");\nmsg.ha_type_topic = 'param29';\nmsg.ha_num_param = '29';\n\n    if (global.get(\"onduleurType\") == \"voltronic\"){\n\n        msg.ha_state_topic = 'qpiri_9' \n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"battTension\") == 12) ? '' :\n                        (global.get(\"battTension\") == 24) ? option(24, 24, 0.5, 1, '', '') :\n                        (global.get(\"battTension\") == 48) ? option(48.1, 42, 0.1, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n        \n\n    }else if (global.get(\"onduleurType\") == \"easun_1\"){\n\n        msg.ha_state_topic = ''\n\n        //function option(max, min, increment, decimal, prefixe, suffixe);\n        msg.ha_select = (global.get(\"battTension\") == 12) ? '' :\n                        (global.get(\"battTension\") == 24) ? option(24, 24, 0.5, 1, '', '') :\n                        (global.get(\"battTension\") == 48) ? option(48.1, 42, 0.1, 1, '', '') :\n\t\t\t\t\t    'Erreur';\n       \n\n    }                   \nnode.send(msg)\n\n\n\n\n\n\n/*-------------------------------------------------*/\n//fonction calcul incrémentation\n/*-------------------------------------------------*/\nfunction option(max, min, increment, decimal, prefixe, suffixe) {\n    let str = '';\n    for (let i = min; i <= max; i += increment) {\n\n        str = str + '\"' + prefixe + i.toFixed(decimal) + suffixe + '\",';\n        \n\n    }\n    //on enleve la virgule\n    str = str.slice(0, -1);\n  return str;\n}","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":550,"y":440,"wires":[["21d2e9636322273d"]]},{"id":"32d9b99943ad61e9","type":"function","z":"34242fea930de037","g":"4cfcbd6d8376184f","name":"Puissance watt","func":"\n/*-------------------------------------------------*/\n//Puissance \n/*-------------------------------------------------*/\n\n msg.ha_device_class = '\"device_class\": \"energy\",';\n msg.ha_unit_of_measurement = '\"unit_of_measurement\": \"W\",';\n msg.ha_nom_unit = 'watt';\n msg.ha_num_onduleur = '1';\n\t\n\t/*-------------------------------------------------*/\n\t//PV Puissance (Watt)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"namePV\");\n\t msg.ha_type_topic = 'pv';\n\t msg.ha_icon = '\"icon\": \"mdi:solar-power-variant\",';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qpig_19' :\n\t\t\t\t\t      (global.get(\"onduleurType\") == \"easun_1\") ? 'batPV_9' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\n\t/*-------------------------------------------------*/\n\t//Batt Charge (Watt)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"nameBatt_charge\");\n\t msg.ha_type_topic = 'batt_charge';\n\t msg.ha_icon = '\"icon\": \"mdi:battery-arrow-up-outline\",';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\")? 'custom_1' :\n\t\t\t\t    \t  (global.get(\"onduleurType\") == \"easun_1\") ? 'batPV_14' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\t\n\t/*-------------------------------------------------*/\n\t//Batt decharge (Watt)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"nameBatt_batt_decharge\");\n\t msg.ha_type_topic = 'batt_decharge';\n\t msg.ha_icon = '\"icon\": \"mdi:battery-arrow-down-outline\",';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'custom_2' :\n\t\t\t\t\t      (global.get(\"onduleurType\") == \"easun_1\") ? '' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\t\n\t/*-------------------------------------------------*/\n\t//Batt charge Decharge sens (Watt)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"nameBatt_batt_chargedecharge\");\n\t msg.ha_type_topic = 'batt_charge_decharge';\n\t msg.ha_icon = '\"icon\": \"mdi:battery-arrow-down-outline\",';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'custom_3' :\n\t\t\t\t\t      (global.get(\"onduleurType\") == \"easun_1\") ? '' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\n\t/*-------------------------------------------------*/\n\t//Conso Maison (Watt)\n\t/*-------------------------------------------------*/\n\t msg.ha_name_topic = global.get(\"nameConso_maison\");\n\t msg.ha_type_topic = 'conso_maison';\n\t msg.ha_icon = '\"icon\": \"mdi:home-lightning-bolt-outline\",';\n\t\n\t msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qpig_5' :\n\t\t\t\t\t      (global.get(\"onduleurType\") == \"easun_1\") ? 'data_23' :\n\t\t\t\t\t      'Erreur';\n\t\t\t\t\t\t \n\tnode.send(msg)\n\n\t/*-------------------------------------------------*/\n\t//si qpigs2 (2ème string) est différent de NAK\n\t/*-------------------------------------------------*/\n\tif (global.get(\"qpigs2\") != 'NAK'){\n\n\t\t/*-------------------------------------------------*/\n\t\t//PV Puissance 2 (Watt)\n\t\t/*-------------------------------------------------*/\n\t\tmsg.ha_name_topic = global.get(\"namePV2\");\n\t\tmsg.ha_type_topic = 'pv2';\n\t\tmsg.ha_icon = '\"icon\": \"mdi:solar-power-variant\",';\n\t\t\n\t\tmsg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qpigs2_2' :\n\t\t\t\t\t\t\t(global.get(\"onduleurType\") == \"easun_1\") ? '' :\n\t\t\t\t\t\t\t'Erreur';\n\t\t\t\t\t\t\t\n\t\tnode.send(msg)\n\n\t}\n\n\t/*-------------------------------------------------*/\n\t//si plusieur onduleur (qpgsx) est différent de NAK\n\t/*-------------------------------------------------*/\n\t\n\t/*\n\tif (global.get(\"qpgs1\") != 'NAK'){\n\n\t}\n\t*/\n\n\t\n\tfor (let i = 2; i <= 8; i++) {\n\t\t\tlet topic = \"qpgs\" + i;\n\t\t\tif (global.get( '' + topic + '' ) != 'false'){\n\n\t\t\t\t/*-------------------------------------------------*/\n\t\t\t\t//PV Puissance (Watt) qpgs\n\t\t\t\t/*-------------------------------------------------*/\n\t\t\t\tmsg.ha_num_onduleur = i;\n\t\t\t\tmsg.ha_name_topic = global.get(\"namePV\");\n\t\t\t\tmsg.ha_type_topic = 'pv';\n\t\t\t\tmsg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'custom_' + i + '10' :\n\t\t\t\t\t\t\t\t\t'Erreur';\n\n\t\t\t\tnode.send(msg);\n\n\t\t\t\t/*-------------------------------------------------*/\n\t\t\t\t//Batt Charge (Watt) qpgs\n\t\t\t\t/*-------------------------------------------------*/\n\t\t\t\tmsg.ha_name_topic = global.get(\"nameBatt_charge\");\n\t\t\t\tmsg.ha_type_topic = 'batt_charge';\n\t\t\t\tmsg.ha_icon = '\"icon\": \"mdi:battery-arrow-up-outline\",';\n\n\t\t\t\tmsg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'custom_' + i + '01' :\n\t\t\t\t\t\t'Erreur';\n\n\t\t\t\tnode.send(msg)\n\n\t\t\t\t/*-------------------------------------------------*/\n\t\t\t\t//Batt decharge (Watt) qpgs\n\t\t\t\t/*-------------------------------------------------*/\n\t\t\t\tmsg.ha_name_topic = global.get(\"nameBatt_batt_decharge\");\n\t\t\t\tmsg.ha_type_topic = 'batt_decharge';\n\t\t\t\tmsg.ha_icon = '\"icon\": \"mdi:battery-arrow-down-outline\",';\n\n\t\t\t\tmsg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'custom_' + i + '02' :\n\t\t\t\t\t\t'Erreur';\n\n\t\t\t\tnode.send(msg)\n\n\t\t\t\t/*-------------------------------------------------*/\n\t\t\t\t//Batt charge Decharge sens (Watt) qpgs\n\t\t\t\t/*-------------------------------------------------*/\n\t\t\t\tmsg.ha_name_topic = global.get(\"nameBatt_batt_chargedecharge\");\n\t\t\t\tmsg.ha_type_topic = 'batt_charge_decharge';\n\t\t\t\tmsg.ha_icon = '\"icon\": \"mdi:battery-arrow-down-outline\",';\n\n\t\t\t\tmsg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'custom_' + i + '03' :\n\t\t\t\t\t\t'Erreur';\n\n\t\t\t\tnode.send(msg)\n\n\t\t\t\t\n\t\t\t}\n\t}","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":560,"y":100,"wires":[["239461aea9f16532"]]},{"id":"bda5dd5d13f13ec1","type":"function","z":"34242fea930de037","g":"4cfcbd6d8376184f","name":"Tension volt","func":"\n/*-------------------------------------------------*/\n//Tension \n/*-------------------------------------------------*/\n\nmsg.ha_device_class = '\"device_class\": \"voltage\",';\nmsg.ha_unit_of_measurement = '\"unit_of_measurement\": \"V\",';\nmsg.ha_nom_unit = 'volt';\nmsg.ha_num_onduleur = '1';\n\n    /*-------------------------------------------------*/\n    //Grid Tension (Volt)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"nameGridTension\");\n    msg.ha_type_topic = 'grid_tension';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qpig_0' :\n        (global.get(\"onduleurType\") == \"easun_1\") ? 'data_15' :\n            'Erreur';\n\n    node.send(msg)\n\n    /*-------------------------------------------------*/\n    //Batterie Voltage (Volt)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"nameBattTensiont\");\n    msg.ha_type_topic = 'batt';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qpig_8' :\n        (global.get(\"onduleurType\") == \"easun_1\") ? 'batPV_1' :\n            'Erreur';\n\n    node.send(msg)\n\n    /*-------------------------------------------------*/\n    //PV Voltage (Volt)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"namePvTensiont\");\n    msg.ha_type_topic = 'pv';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qpig_13' :\n        (global.get(\"onduleurType\") == \"easun_1\") ? 'batPV_7' :\n            'Erreur';\n\n    node.send(msg)\n\n    /*-------------------------------------------------*/\n    //Onduleur Tension (Volt)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"nameOnduleurTension\");\n    msg.ha_type_topic = 'onduleur_tension';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qpig_2' :\n        (global.get(\"onduleurType\") == \"easun_1\") ? 'data_18' :\n            'Erreur';\n\n    node.send(msg)\n\n\n    /*-------------------------------------------------*/\n    //si qpigs2 (2ème string) est différent de NAK\n    /*-------------------------------------------------*/\n\n    if (global.get(\"qpigs2\") != 'NAK') {\n\n        /*-------------------------------------------------*/\n        //PV2 Voltage (Volt)\n        /*-------------------------------------------------*/\n        msg.ha_name_topic = global.get(\"namePv2Tensiont\");\n        msg.ha_type_topic = 'pv2';\n        msg.ha_icon = '';\n\n        msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qpigs2_1' :\n            (global.get(\"onduleurType\") == \"easun_1\") ? '' :\n                'Erreur';\n\n        node.send(msg)\n    }\n    \n    /*-------------------------------------------------*/\n    //Si plusieurs onduleurs\n    /*-------------------------------------------------*/\n    for (let i = 2; i <= 8; i++) {\n            let topic = \"qpgs\" + i;\n            if (global.get( '' + topic + '' ) != 'false'){\n\n                /*-------------------------------------------------*/\n                //PV Voltage (Volt) qpgs\n                /*-------------------------------------------------*/\n                msg.ha_num_onduleur = i;\n                msg.ha_name_topic = global.get(\"namePvTensiont\");\n                msg.ha_type_topic = 'pv';\n                msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? topic + '_14' :\n                                    'Erreur';\n\n                node.send(msg);\n\n                /*-------------------------------------------------*/\n                //Grid Tension (Volt) qpgs\n                /*-------------------------------------------------*/\n                msg.ha_name_topic = global.get(\"nameGridTension\");\n                msg.ha_type_topic = 'grid_tension';\n                msg.ha_icon = '';\n\n                msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? topic + '_4' :\n                                     'Erreur';\n\n                node.send(msg)\n\n                /*-------------------------------------------------*/\n                //Onduleur Tension (Volt) qpgs\n                /*-------------------------------------------------*/\n                msg.ha_name_topic = global.get(\"nameOnduleurTension\");\n                msg.ha_type_topic = 'onduleur_tension';\n                msg.ha_icon = '';\n\n                msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? topic + '_6' :\n                                    'Erreur';\n\n                node.send(msg)\n\n            }\n    }","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":550,"y":140,"wires":[["239461aea9f16532","7414b4a5c438fbd8"]]},{"id":"c350aafdc2ec44da","type":"function","z":"34242fea930de037","g":"4cfcbd6d8376184f","name":"intensité Ampere","func":"\n/*-------------------------------------------------*/\n//courant\n/*-------------------------------------------------*/\n\nmsg.ha_device_class = '\"device_class\": \"current\",';\nmsg.ha_unit_of_measurement = '\"unit_of_measurement\": \"A\",';\nmsg.ha_nom_unit = 'current';\nmsg.ha_num_onduleur = '1';\n\n    /*-------------------------------------------------*/\n    //Pv Intensite (Amp)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"namePvIntensite\");\n    msg.ha_type_topic = 'pv_intensite';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qpig_12' :\n        (global.get(\"onduleurType\") == \"easun_1\") ? 'batPV_8' :\n            'Erreur';\n\n    node.send(msg)\n\n    /*-------------------------------------------------*/\n    //Batt Charge (Amp)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"nameBattChargeIntensite\");\n    msg.ha_type_topic = 'batt_charge_intensite';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qpig_9' :\n        (global.get(\"onduleurType\") == \"easun_1\") ? 'batPV_2' :\n            'Erreur';\n\n    node.send(msg)\n\n    /*-------------------------------------------------*/\n    //Batt Decharge (Amp)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"nameBattDechargeIntensite\");\n    msg.ha_type_topic = 'batt_decharge_intensite';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qpig_15' :\n        (global.get(\"onduleurType\") == \"easun_1\") ? '' :\n            'Erreur';\n\n    node.send(msg)\n\n\n    /*-------------------------------------------------*/\n    //si qpigs2 (2ème string) est différent de NAK\n    /*-------------------------------------------------*/\n    if (global.get(\"qpigs2\") != 'NAK') {\n\n        /*-------------------------------------------------*/\n        //Pv 2 Intensite (Amp)\n        /*-------------------------------------------------*/\n        msg.ha_name_topic = global.get(\"namePv2Intensite\");\n        msg.ha_type_topic = 'pv2_intensite';\n        msg.ha_icon = '';\n\n        msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qpigs2_0' :\n            (global.get(\"onduleurType\") == \"easun_1\") ? '' :\n                'Erreur';\n\n        node.send(msg)\n\n    }\n\n    /*-------------------------------------------------*/\n    //Si plusieurs onduleurs\n    /*-------------------------------------------------*/\n    for (let i = 2; i <= 8; i++) {\n            let topic = \"qpgs\" + i;\n            if (global.get( '' + topic + '' ) != 'false'){\n\n                /*-------------------------------------------------*/\n                //Pv Intensite (Amp) qpgs\n                /*-------------------------------------------------*/\n                msg.ha_num_onduleur = i;\n                msg.ha_name_topic = global.get(\"namePvIntensite\");\n                msg.ha_type_topic = 'pv_intensite';\n                msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? topic + '_25' :\n                                    'Erreur';\n\n                node.send(msg);\n            }\n    }","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":570,"y":180,"wires":[["239461aea9f16532"]]},{"id":"24a6e831c0984006","type":"function","z":"34242fea930de037","g":"4cfcbd6d8376184f","name":"Frequence Hz","func":"\n/*-------------------------------------------------*/\n// Frequence\n/*-------------------------------------------------*/\n\nmsg.ha_device_class = '\"device_class\": \"frequency\",';\nmsg.ha_unit_of_measurement = '\"unit_of_measurement\": \"Hz\",';\nmsg.ha_nom_unit = 'frequency';\nmsg.ha_num_onduleur = '1';\n\n    /*-------------------------------------------------*/\n    //Data-Frequency (Hz)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"nameDataFrequency\");\n    msg.ha_type_topic = 'data';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qpig_1' :\n        (global.get(\"onduleurType\") == \"easun_1\") ? 'data_17' :\n            'Erreur';\n\n    node.send(msg)\n\n    /*-------------------------------------------------*/\n    //Onduleur-Frequency (Hz)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"nameOnduleurFrequency\");\n    msg.ha_type_topic = 'onduleur_frequency';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qpig_3' :\n        (global.get(\"onduleurType\") == \"easun_1\") ? 'data_20' :\n            'Erreur';\n\n    node.send(msg)\n\n\n    /*-------------------------------------------------*/\n    //si plusieur onduleur (qpgsx) est différent de NAK\n    /*-------------------------------------------------*/\n    if (global.get(\"qpgs1\") != 'NAK'){\n\n    }\n\n    for (let i = 2; i <= 8; i++) {\n        let topic = \"qpgs\" + i;\n        if (global.get( '' + topic + '' ) != 'false'){\n\n            /*-------------------------------------------------*/\n            //Data-Frequency (Hz)\n            /*-------------------------------------------------*/\n            msg.ha_num_onduleur = i;\n            msg.ha_name_topic = global.get(\"nameDataFrequency\");\n            msg.ha_type_topic = 'data';\n            msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qpgs' + i + '_5' :\n                                'Erreur';\n\n            node.send(msg);\n\n            /*-------------------------------------------------*/\n            //Onduleur-Frequency (Hz) qpgs\n            /*-------------------------------------------------*/\n            msg.ha_num_onduleur = i;\n            msg.ha_name_topic = global.get(\"nameOnduleurFrequency\");\n            msg.ha_type_topic = 'onduleur_frequency';\n            msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qpgs' + i + '_7' :\n                                'Erreur';\n\n            node.send(msg);\n\n\n        }\n\n\n    }","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":560,"y":220,"wires":[["239461aea9f16532"]]},{"id":"47f8d8ee8dc1fed2","type":"function","z":"34242fea930de037","g":"4cfcbd6d8376184f","name":"%","func":"\n/*-------------------------------------------------*/\n// %\n/*-------------------------------------------------*/\n\nmsg.ha_device_class = '\"device_class\": \"battery\",';\nmsg.ha_unit_of_measurement = '\"unit_of_measurement\": \"%\",';\nmsg.ha_nom_unit = 'battery';\nmsg.ha_num_onduleur = '1';\n\n    /*-------------------------------------------------*/\n    //Batterie Capacité\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"nameBattCapacite\");\n    msg.ha_type_topic = 'batt';\n    // msg.ha_icon = '\"icon\": \"mdi:home-lightning-bolt-outline\",';\n\n    msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qpig_10' :\n        (global.get(\"onduleurType\") == \"easun_1\") ? '' :\n            'Erreur';\n\n    node.send(msg)\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":530,"y":260,"wires":[["239461aea9f16532"]]},{"id":"54f7f2edafc6dc96","type":"function","z":"34242fea930de037","g":"4cfcbd6d8376184f","name":"Autre","func":"\n/*-------------------------------------------------*/\n// Mode\n/*-------------------------------------------------*/\n\nmsg.ha_device_class = '';\nmsg.ha_unit_of_measurement = '';\nmsg.ha_nom_unit = 'info';\nmsg.ha_num_onduleur = '1';\n\n    /*-------------------------------------------------*/\n    //Mode Solar\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"nameMode\");\n    msg.ha_type_topic = 'mode';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qmod_0' :\n        (global.get(\"onduleurType\") == \"easun_1\") ? 'setup1_4' :\n            'Erreur';\n\n    node.send(msg)\n\n    //si qpigs2 (2ème string) est différent de NAK\n    if (global.get(\"battNb\") != '0') {\n\n        /*-------------------------------------------------*/\n        //Total batterie\n        /*-------------------------------------------------*/\n        msg.ha_name_topic = \"Total batterie\";\n        msg.ha_type_topic = 'total_batterie';\n        msg.ha_icon = '';\n\n        msg.ha_state_topic = \"totalbatt\";\n\n        node.send(msg)\n\n    }\n\n    //si qpigs2 (2ème string) est différent de NAK\n    if (global.get(\"nbOnduleur\") != '0') {\n\n        /*-------------------------------------------------*/\n        //Total Onduleur\n        /*-------------------------------------------------*/\n        msg.ha_name_topic = \"Total Onduleur\";\n        msg.ha_type_topic = 'total_onduleur';\n        msg.ha_icon = '';\n\n        msg.ha_state_topic = \"totalond\";\n\n        node.send(msg)\n\n    }\n\n\n    /*-------------------------------------------------*/\n    //si plusieur onduleur (qpgsx) est différent de NAK\n    /*-------------------------------------------------*/\n    if (global.get(\"qpgs1\") != 'NAK'){\n\n    }\n\n    for (let i = 2; i <= 8; i++) {\n        let topic = \"qpgs\" + i;\n        if (global.get( '' + topic + '' ) != 'false'){\n\n            /*-------------------------------------------------*/\n            // Mode qpgs\n            /*-------------------------------------------------*/\n            msg.ha_num_onduleur = i;\n            msg.ha_name_topic = global.get(\"nameMode\");\n            msg.ha_type_topic = 'mode';\n            msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qpgs' + i + '_2' :\n                                'Erreur';\n\n            node.send(msg);\n\n            /*-------------------------------------------------*/\n            // Code d'erreur qpgs\n            /*-------------------------------------------------*/\n            msg.ha_num_onduleur = i;\n            msg.ha_name_topic = \"Code erreur\";\n            msg.ha_type_topic = 'erreur';\n            msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qpgs' + i + '_3' :\n                'Erreur';\n\n            node.send(msg);\n\n        }\n\n\n    \n}","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":530,"y":340,"wires":[["239461aea9f16532"]]},{"id":"4c84a6bbea2bf75f","type":"function","z":"34242fea930de037","g":"4cfcbd6d8376184f","name":"Température C","func":"\n/*-------------------------------------------------*/\n// Temperature\n/*-------------------------------------------------*/\n\nmsg.ha_device_class = '\"device_class\": \"temperature\",';\nmsg.ha_unit_of_measurement = '\"unit_of_measurement\": \"°C\",';\nmsg.ha_nom_unit = 'temperature';\nmsg.ha_num_onduleur = '1';\n\n    /*-------------------------------------------------*/\n    //Temperature (°C)\n    /*-------------------------------------------------*/\n    msg.ha_name_topic = global.get(\"nameTemp\");\n    msg.ha_type_topic = 'temp';\n    msg.ha_icon = '';\n\n    msg.ha_state_topic = (global.get(\"onduleurType\") == \"voltronic\") ? 'qpig_11' :\n        (global.get(\"onduleurType\") == \"easun_1\") ? 'data_30' :\n            'Erreur';\n\n    node.send(msg)\n\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":560,"y":300,"wires":[["239461aea9f16532"]]},{"id":"c24651723d857016","type":"debug","z":"34242fea930de037","g":"4cfcbd6d8376184f","name":"debug 158","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":830,"y":100,"wires":[]},{"id":"7414b4a5c438fbd8","type":"template","z":"34242fea930de037","g":"4cfcbd6d8376184f","name":"","field":"payload","fieldType":"msg","format":"handlebars","syntax":"mustache","template":"{\n  \"name\": \"{{global.nameOnduleur}} {{ha_num_onduleur}} {{ha_name_topic}}\",\n  {{{ha_device_class}}} \n  {{{ha_unit_of_measurement}}}\n  \"state_topic\": \"{{global.mqttDirSmart}}/{{global.onduleurType}}/{{ha_state_topic}}\", \n  \"value_template\": \"{{ value }}\",\n  \"object_id\": \"{{global.onduleurType}}_{{ha_num_onduleur}}_{{ha_type_topic}}_{{ha_nom_unit}}\",\n  \"unique_id\": \"{{global.onduleurType}}_{{ha_num_onduleur}}_{{type_ha}}_{{ha_type_topic}}_{{ha_nom_unit}}\", \n  {{{ha_icon}}}\n  \"device\":{\n    \"manufacturer\": \"{{manufacturer}}\",\n\t  \"name\": \"{{global.nameOnduleur}} {{ha_num_onduleur}}\",\n\t  \"model\": \"{{model}}\",\n    \"configuration_url\": \"{{{configuration_url}}}\",\n\t  \"identifiers\": [\"{{global.onduleurType}}_{{ha_num_onduleur}}\"]\n\t}\n}","output":"str","x":800,"y":140,"wires":[["c24651723d857016"]]},{"id":"403275d54aba7259","type":"inject","z":"1eba1b99238b9144","name":"battNb","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"3600","crontab":"","once":true,"onceDelay":"13","topic":"","payload":"battNb","payloadType":"global","x":120,"y":500,"wires":[["73073fa4b27990a4","6c17d10461a44be4"]]},{"id":"6c17d10461a44be4","type":"function","z":"1eba1b99238b9144","name":"function 31","func":"let count = msg.payload;\n\n  \n  \n    for(let i = 1; i <= count; i++){\n      \n      \n       \n       setTimeout( function timer(){\n        msg.payload = \"stat \" + i + \"\\n\"; \n        msg.topic = 'pylon_' + i;\n        msg.life = true\n        node.send(msg);\n      }, i*4000 );\n    \n  }","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":330,"y":500,"wires":[["7644f5df5390b1dd","bc6a3f43c662be67"]]},{"id":"83a3e4280bb1c03e","type":"function","z":"1eba1b99238b9144","name":"Value Life cicle","func":"let payload = msg.payload;\n\n\nmsg.numLife = (payload.findIndex(function(item){\n    return item.indexOf(\"CYCLE Times\")!==-1;\n}));\n\nmsg.id = (payload.findIndex(function(item){\n    return item.indexOf(\"Device address\")!==-1;\n}));\n\n\nmsg.payload = payload[msg.numLife];\nmsg.payload = msg.payload.replace(\"CYCLE Times     :\", '');\nmsg.payload = msg.payload.split(' ').join('')\n\nlet deviceid = payload[msg.id];\ndeviceid = deviceid.split(' ').join('');\ndeviceid = deviceid.replace(\"Deviceaddress\", '');\ndeviceid = deviceid.replace( /[\\r\\n]+/gm, \"\" );\n\nlet dir = \"homeassistant/sensor/\" + global.get(\"batterieType\") + \"_\" + deviceid + \"/Life/\"\nlet type = \"value\";\n\nmsg.deviceid = deviceid\n\nmsg.dir = dir\n\nmsg.topic = dir + type;\nnode.send(msg)\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":680,"y":580,"wires":[["5432883edede86bd","8ea35d04bec40646"]]},{"id":"aa754876b7f031cd","type":"serial in","z":"1eba1b99238b9144","name":"","serial":"cdf964dc2b62fe0d","x":120,"y":580,"wires":[["1d0137f108679baf"]]},{"id":"1d0137f108679baf","type":"join","z":"1eba1b99238b9144","name":"","mode":"custom","build":"array","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"0.5","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":310,"y":580,"wires":[["468aa896899dd0c9"]]},{"id":"8ea35d04bec40646","type":"function","z":"1eba1b99238b9144","name":"Config Life Cicle","func":"\n\nmsg.payload = {\n  \n  \"unit_of_measurement\": msg.unit,\n  \"device_class\": msg.deviceclass,\n  \"state_topic\": msg.topic,\n  \"name\": \"Pylontech\" + msg.deviceid + \" Life\",\n  \"unique_id\": \"life\" + msg.deviceid,\n  \"device\": {\n    \"name\": \"Pylontech\" + msg.deviceid,\n    \"model\": env.get(\"VERSION\"),\n    \"manufacturer\": \"Smartphoton\",\n    \"identifiers\": [\n      \"Pylontech\" + msg.deviceid\n    ]\n     }  \n}\n\nlet type = \"config\";\nmsg.topic = msg.dir + type;\n\nreturn msg;","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":680,"y":620,"wires":[["5432883edede86bd"]]},{"id":"5432883edede86bd","type":"link out","z":"1eba1b99238b9144","name":"link out 4","mode":"link","links":["58815987c51e2a0f","a826c052e06f7959"],"x":1055,"y":580,"wires":[]},{"id":"468aa896899dd0c9","type":"switch","z":"1eba1b99238b9144","name":"","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":"stat","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":490,"y":580,"wires":[["83a3e4280bb1c03e","f2b953f2b6c878d6"]]},{"id":"73073fa4b27990a4","type":"function","z":"1eba1b99238b9144","name":"total batterie","func":"msg.payload = global.get(\"battNb\");\nmsg.topic = msg.topic = global.get(\"mqttDirSmart\") + '/' + global.get(\"onduleurType\") + '/totalbatt';\nreturn msg;","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":330,"y":540,"wires":[["5432883edede86bd"]]},{"id":"c68e766f6a140060","type":"link in","z":"1eba1b99238b9144","name":"link in 8","links":["43c472a8a2c018cc","c1996d99c59d0284"],"x":65,"y":640,"wires":[["174939acaba91595"]]},{"id":"f2b953f2b6c878d6","type":"debug","z":"1eba1b99238b9144","name":"debug 148","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":520,"y":660,"wires":[]},{"id":"174939acaba91595","type":"split","z":"1eba1b99238b9144","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":170,"y":640,"wires":[["1d0137f108679baf"]]},{"id":"7644f5df5390b1dd","type":"link out","z":"1eba1b99238b9144","name":"link out 17","mode":"link","links":["a131444f0c08e83c"],"x":1045,"y":500,"wires":[]},{"id":"bc6a3f43c662be67","type":"debug","z":"1eba1b99238b9144","name":"debug 149","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":650,"y":480,"wires":[]},{"id":"75f1e2f5f32a6297","type":"function","z":"1eba1b99238b9144","g":"50300f11ec221358","name":"commande <Pwr>","func":"var metric = flow.get('metric');\nglobal.set('Pylon_Flag_cmd',\"pwr\");\nmsg.payload = \"pwr\" + \"\\n\";\nmsg.life = false;\nmetric++;\nflow.set('metric', metric);\nreturn msg;","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":910,"y":60,"wires":[["a0a971da9cb23245"]]},{"id":"6efd8f270dbb98ce","type":"inject","z":"1eba1b99238b9144","g":"50300f11ec221358","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"12","crontab":"","once":true,"onceDelay":"6","topic":"","payload":"","payloadType":"date","x":130,"y":60,"wires":[["5d4b1ae6ec6d47cf"]]},{"id":"5d4b1ae6ec6d47cf","type":"change","z":"1eba1b99238b9144","g":"50300f11ec221358","name":"","rules":[{"t":"set","p":"metric","pt":"flow","to":"1","tot":"num"},{"t":"set","p":"array_pylontech_Pwr","pt":"flow","to":"[]","tot":"json"},{"t":"set","p":"Pylon_Flag_cmd","pt":"global","to":"null","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":600,"y":60,"wires":[["75f1e2f5f32a6297"]]},{"id":"a0a971da9cb23245","type":"link out","z":"1eba1b99238b9144","g":"50300f11ec221358","name":"Pylon-Sérial-commande","mode":"link","links":["a131444f0c08e83c"],"x":1055,"y":60,"wires":[]},{"id":"040cd890a0c73635","type":"split","z":"1eba1b99238b9144","g":"2704b7e1ab53ecfd","name":"Split into rows","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":200,"y":360,"wires":[["92a4fc5845bab572"]]},{"id":"92a4fc5845bab572","type":"function","z":"1eba1b99238b9144","g":"2704b7e1ab53ecfd","name":"Row to Array","func":"var a = msg.payload\nvar array = []\narray[0] = new Array(parseInt(a.toString().substr(0, 6)), \"BattID\", null, null)\narray[1] = new Array(parseInt(a.toString().substr(6, 7)) / 1000, \"Volt\", \"V\", \"voltage\", array[0][0])\narray[2] = new Array(parseInt(a.toString().substr(13, 7)) / 1000, \"Curr\", \"A\", \"current\", array[0][0])\narray[3] = new Array(parseInt(a.toString().substr(20, 7)) / 1000, \"Tempr\", \"°C\", \"temperature\", array[0][0])\narray[4] = new Array(parseInt(a.toString().substr(27, 7)) / 1000, \"Tlow\", \"°C\", \"temperature\", array[0][0])\narray[5] = new Array(parseInt(a.toString().substr(34, 7)) / 1000, \"Thigh\", \"°C\", \"temperature\", array[0][0])\narray[6] = new Array(parseInt(a.toString().substr(41, 7)) / 1000, \"Vlow\", \"V\", \"voltage\", array[0][0])\narray[7] = new Array(parseInt(a.toString().substr(48, 7)) / 1000, \"Vhigh\", \"V\", \"voltage\", array[0][0])\narray[8] = new Array(a.substr(55, 9).trim(), \"BaseSt\", null, null, array[0][0])\narray[9] = new Array(a.substr(64, 9).trim(), \"VoltSt\", null, null, array[0][0])\narray[10] = new Array(a.substr(73, 9).trim(), \"CurrSt\", null, null, array[0][0])\narray[11] = new Array(a.substr(82, 9).trim(), \"TempSt\", null, null, array[0][0])\narray[12] = new Array(parseInt(a.toString().substr(91, 9)), \"SOC\", \"%\", \"battery\", array[0][0])\n\nif (array[8][0] !== \"Absent\" && array[8][0] != \"\" && array[8][0] != \"Base.St\") {\n    msg.payload = array\n    return msg;\n}","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":390,"y":360,"wires":[["cd1477d4c053f463"]]},{"id":"95e89f3e16943452","type":"function","z":"1eba1b99238b9144","g":"2704b7e1ab53ecfd","name":"Config Pylon","func":"msg.topic = \"homeassistant/sensor/\" + global.get(\"batterieType\") + \"_\" + msg.deviceid + \"/\" + \"/\" + msg.shorttopic + \"/\" + \"config\";\nmsg.topic = msg.topic.replace(\"//\", \"/\");\nmsg.payload = {\n  \n  \"unit_of_measurement\": msg.unit,\n  \"device_class\": msg.deviceclass,\n  \"state_topic\": \"homeassistant/sensor/\" + global.get(\"batterieType\") + \"_\" + msg.deviceid + \"/\" + msg.shorttopic + \"/\" + \"value\",\n  \"name\": \"pylontech \" + msg.deviceid + \" \" + msg.shorttopic,\n  \"unique_id\": \"pylontech\" + msg.deviceid + \"_\" + msg.shorttopic,\n  \"device\": {\n    \"name\":  \"Pylontech\" + msg.deviceid,\n    \"model\": env.get(\"VERSION\"),\n    \"manufacturer\": \"Smartphoton\",\n    \"identifiers\": [\n      \"Pylontech\" + msg.deviceid\n    ]\n     }  \n}\nreturn msg;","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":770,"y":400,"wires":[["2a6f24b92d300724"]]},{"id":"cd1477d4c053f463","type":"split","z":"1eba1b99238b9144","g":"2704b7e1ab53ecfd","name":"Split Array","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":570,"y":360,"wires":[["be2f278bc9283c22"]]},{"id":"be2f278bc9283c22","type":"function","z":"1eba1b99238b9144","g":"2704b7e1ab53ecfd","name":"Value Pylon","func":"var v = msg.payload;\nif (v[1] != \"BattID\"){\n  msg.payload = v[0];\n  msg.shorttopic = v[1];\n  if (v[2] != null){\n  msg.unit = v[2]\n  }\n  if (v[3] != null){\n  msg.deviceclass = v[3]\n  }\n  msg.deviceid = v[4]\n  msg.topic = \"homeassistant/sensor/\" + global.get(\"batterieType\") + \"_\" + msg.deviceid + \"/\" + \"/\" + msg.shorttopic + \"/\" + \"value\";\n  msg.topic = msg.topic.replace(\"//\", \"/\");\n  node.send(msg);\n\n}\n\nif (v[1] == \"BattID\"){\n\n  global.set(\"battNb\", v[0]); \n\n  msg.payload = v[0];\n  msg.shorttopic = v[1];\n\n  msg.deviceid = v[0]\n  msg.topic = \"homeassistant/sensor/\" + global.get(\"batterieType\") + \"_\" + msg.deviceid + \"/\" + \"/\" + msg.shorttopic + \"/\" + \"value\";\n  msg.topic = msg.topic.replace(\"//\", \"/\");\n  node.send(msg);\n  \n\n}","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":770,"y":360,"wires":[["95e89f3e16943452","2a6f24b92d300724"]]},{"id":"92bc72013744ba07","type":"link in","z":"1eba1b99238b9144","g":"2704b7e1ab53ecfd","name":"Pylon-Pwr-in","links":["ea523a624a80f55f","15a2b41d82893402","ed1d8f6b1c4b62b5"],"x":55,"y":360,"wires":[["040cd890a0c73635"]]},{"id":"2a6f24b92d300724","type":"link out","z":"1eba1b99238b9144","g":"2704b7e1ab53ecfd","name":"link out 3","mode":"link","links":["58815987c51e2a0f","a826c052e06f7959"],"x":1055,"y":360,"wires":[]},{"id":"a131444f0c08e83c","type":"link in","z":"1eba1b99238b9144","g":"7362cf61f06305cc","name":"Pylon-Sérial-commande","links":["736cf64738dffc33","a3da6ca150d4c274","a0a971da9cb23245","db7fc6c31e43b93b","18512989135a691f","7644f5df5390b1dd"],"x":55,"y":180,"wires":[["bf0221002f98096f"]]},{"id":"6e93ef99c007100b","type":"serial out","z":"1eba1b99238b9144","g":"7362cf61f06305cc","name":"","serial":"cdf964dc2b62fe0d","x":970,"y":220,"wires":[]},{"id":"c6d07b2fa33077c9","type":"delay","z":"1eba1b99238b9144","g":"7362cf61f06305cc","name":"Limit 1 msg / 1 [s]","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":370,"y":220,"wires":[["6e93ef99c007100b"]]},{"id":"b21fe743fbfd15b8","type":"delay","z":"1eba1b99238b9144","g":"7362cf61f06305cc","name":"Limit 1 msg / 1 [s]","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":370,"y":160,"wires":[["0735a4b3ca51036c"]]},{"id":"0735a4b3ca51036c","type":"function","z":"1eba1b99238b9144","g":"7362cf61f06305cc","name":"TCP Server Ip pylontech","func":"msg.host = global.get(\"batterieElfinAdresse\");\nmsg.port = global.get(\"batterieElfinPort\");\nreturn msg;","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":590,"y":160,"wires":[["4daf451b32a30d25"]]},{"id":"4daf451b32a30d25","type":"tcp request","z":"1eba1b99238b9144","g":"7362cf61f06305cc","name":"GW Elfin Rs232","server":"","port":"","out":"time","ret":"string","splitc":"10","newline":"","trim":false,"tls":"","x":800,"y":160,"wires":[["1633fc1cc91871a4"]]},{"id":"ed1d8f6b1c4b62b5","type":"link out","z":"1eba1b99238b9144","g":"7362cf61f06305cc","name":"Pylon-parse-ou","mode":"link","links":["6fde506f4c251efe","05aee219750c1d65","92bc72013744ba07"],"x":1055,"y":180,"wires":[]},{"id":"68cf9f0d3227936e","type":"serial in","z":"1eba1b99238b9144","g":"7362cf61f06305cc","name":"","serial":"cdf964dc2b62fe0d","x":120,"y":260,"wires":[["15a2b41d82893402"]]},{"id":"15a2b41d82893402","type":"link out","z":"1eba1b99238b9144","g":"7362cf61f06305cc","name":"Pylon-parse-ou","mode":"link","links":["6fde506f4c251efe","05aee219750c1d65","92bc72013744ba07"],"x":1045,"y":260,"wires":[]},{"id":"1633fc1cc91871a4","type":"switch","z":"1eba1b99238b9144","g":"7362cf61f06305cc","name":"","property":"life","propertyType":"msg","rules":[{"t":"true"},{"t":"false"}],"checkall":"true","repair":false,"outputs":2,"x":960,"y":160,"wires":[["c1996d99c59d0284"],["ed1d8f6b1c4b62b5"]]},{"id":"c1996d99c59d0284","type":"link out","z":"1eba1b99238b9144","g":"7362cf61f06305cc","name":"link out 18","mode":"link","links":["c68e766f6a140060"],"x":1055,"y":140,"wires":[]},{"id":"bf0221002f98096f","type":"function","z":"1eba1b99238b9144","g":"7362cf61f06305cc","name":"function 54","func":"if (global.get(\"batterieElfinActive\") == true){\n    \n    return [msg,,];\n\n} else if (global.get(\"batterieUsbPort\") != \"false\"){\n\n     return [,msg,];\n     \n}else{\n    \n    return [,,msg ];\n}\n\n","outputs":3,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":170,"y":180,"wires":[["b21fe743fbfd15b8"],["c6d07b2fa33077c9"],[]]},{"id":"7a6898c4848cf1f9","type":"inject","z":"1eba1b99238b9144","name":"battNb","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":true,"onceDelay":"60","topic":"","payload":"battNb","payloadType":"global","x":110,"y":540,"wires":[["73073fa4b27990a4"]]},{"id":"5f053e5a0ab2ccbe","type":"modbus-flex-getter","z":"18ee536d8d8af34b","name":"","showStatusActivities":false,"showErrors":false,"showWarnings":true,"logIOActivities":false,"server":"419f10df0856f270","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":true,"delayOnStart":false,"startDelayTime":"","x":670,"y":160,"wires":[["61351929a7e83ef8"],[]]},{"id":"68bac5ebdf18dddd","type":"debug","z":"18ee536d8d8af34b","name":"debug 142","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":910,"y":40,"wires":[]},{"id":"218e6ffd9edab179","type":"inject","z":"18ee536d8d8af34b","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":"1","topic":"","payload":"","payloadType":"date","x":110,"y":100,"wires":[["489b57f51a02d739"]]},{"id":"9723fb9a17d8e848","type":"debug","z":"18ee536d8d8af34b","name":"debug 143","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":470,"y":20,"wires":[]},{"id":"61351929a7e83ef8","type":"debug","z":"18ee536d8d8af34b","name":"debug 144","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"adresse","targetType":"msg","statusVal":"","statusType":"auto","x":890,"y":140,"wires":[]},{"id":"ff43354d5819bf9b","type":"function","z":"18ee536d8d8af34b","name":"function 51","func":"// msg.payload.length\n//Nomage préfix\nlet name = msg.topic;\nlet adresse = msg.adresse;\nlet count = adresse + msg.count;\nlet n = 0;\nvar payload = msg.payload;\n\n\n\nfor (let i = adresse; i < count; i++) {\n  \n  \n\n    \n    if (i == 0) { msg.payload = payload[n]; }\n    else if (i == 531 || 532 || 534 || 535 || 537 || 540 || 542 || 544 || 545 || 546 || 57860 || 57866 || 61487 || 61488 || 61496 || 61498 ||61500) { msg.payload = payload[n] / 10; }\n    else if (i == 533) { msg.payload = payload[n] / 100; }\n    else if (i == 258) { msg.payload = payload[n] / 1000; }\n    else if (i == 57351 || 57352 || 57353 || 57356 || 57357 || 57358 || 57371 ||57378) { msg.payload = payload[n] * 0.4; }\n    else if (i == 61485 || 61486) { msg.payload = payload[n] * 0.52; }\n    else if (i == 61492) { msg.payload = payload[61492] + payload[61493]; }\n    else {msg.payload = payload[n]; }\n\n\n  msg.topic = global.get(\"mqttDirSmart\") + '/' + global.get(\"onduleurType\") + '/' + i;\n\n  msg.test = n\n  node.send(msg);\n  n = 1 + n;\n}\n","outputs":1,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":890,"y":100,"wires":[["68bac5ebdf18dddd","db879fe2f8a82885"]]},{"id":"e0685df6fc7dfef1","type":"function","z":"18ee536d8d8af34b","name":"function 50","func":"setTimeout(function () {\n    msg.adresse = 255;\n    msg.count = 1;\n    msg.payload = { value: msg.payload, 'fc': 3, 'unitid': 1, 'address': msg.adresse, 'quantity': msg.count }\n    node.send(msg);\n}, 500);\n\nsetTimeout(function () {\n    msg.adresse = 256;\n    msg.count = 16;\n    msg.payload = { value: msg.payload, 'fc': 3, 'unitid': 1, 'address': msg.adresse, 'quantity': msg.count }\n    node.send(msg);\n}, 1000);\n\nsetTimeout(function () {\n    msg.adresse = 516;\n    msg.count = 32;\n    msg.payload = { value: msg.payload, 'fc': 3, 'unitid': 1, 'address': msg.adresse, 'quantity': msg.count }\nnode.send(msg);},0);\n\nsetTimeout(function () {\n    msg.adresse = 57346;\n    msg.count = 32;\n    msg.payload = { value: msg.payload, 'fc': 3, 'unitid': 1, 'address': msg.adresse, 'quantity': msg.count }\n    node.send(msg);\n}, 2000);\n\nsetTimeout(function () {\n    msg.adresse = 57378;\n    msg.count = 1;\n    msg.payload = { value: msg.payload, 'fc': 3, 'unitid': 1, 'address': msg.adresse, 'quantity': msg.count }\n    node.send(msg);\n}, 3000);\n\nsetTimeout(function(){\n    msg.adresse = 57856;\n    msg.count = 17;\n    msg.payload = { value: msg.payload, 'fc': 3, 'unitid': 1, 'address': msg.adresse, 'quantity': msg.count }\nnode.send(msg);},1500);\n\nsetTimeout(function(){\n    msg.adresse = 61485;\n    msg.count = 30;\n    msg.payload = { value: msg.payload, 'fc': 3, 'unitid': 1, 'address': msg.adresse, 'quantity': msg.count }\nnode.send(msg);},2500);\n\n\n ","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":450,"y":100,"wires":[["5f053e5a0ab2ccbe","9723fb9a17d8e848","ff43354d5819bf9b"]]},{"id":"db879fe2f8a82885","type":"function","z":"18ee536d8d8af34b","name":"function 52","func":"let dir = global.get(\"mqttDirSmart\") + '/' + global.get(\"onduleurType\") + '/'\n\n\n/***************************Parametre 1***********************/\nif ( msg.topic == dir + '57860'){\n    msg.payload = (msg.payload == 0) ? msg.payload = \"UTI\" :\n                  (msg.payload == 1) ? msg.payload = \"SOL\" :\n                  (msg.payload == 2) ? msg.payload = \"SBU\" :\n                  'Erreur'; \n    node.send(msg);\n}\n\n/***************************Parametre 2***********************/\nif (msg.topic == dir + '57866'){\n    msg.payload = (msg.payload == '100') ? msg.payload = \"010\" :\n                  (msg.payload == '200') ? msg.payload = \"020\" :\n                  (msg.payload == '300') ? msg.payload = \"030\" :\n                  (msg.payload == '400') ? msg.payload = \"040\" :\n                  (msg.payload == '500') ? msg.payload = \"050\" :\n                  (msg.payload == '600') ? msg.payload = \"060\" :\n                  (msg.payload == '700') ? msg.payload = \"070\" :\n                  (msg.payload == '800') ? msg.payload = \"080\" :\n                  'Erreur'; \n    node.send(msg);\n}\n\n/***************************Parametre 5***********************/\nif (msg.topic == dir + '57348') {\n    msg.payload = (msg.payload == 0) ? msg.payload = \"USE\" :\n                  (msg.payload == 1) ? msg.payload = \"SLD\" :\n                  (msg.payload == 2) ? msg.payload = \"FLD\" :\n                  (msg.payload == 3) ? msg.payload = \"GEL\" :\n                  (msg.payload == 4) ? msg.payload = \"LIFEPO4X14\" :\n                  (msg.payload == 5) ? msg.payload = \"LIFEPO4X15\" :\n                  (msg.payload == 6) ? msg.payload = \"LIFEPO4X16\" :\n                  (msg.payload == 7) ? msg.payload = \"LIFEPO4X7\" :\n                  (msg.payload == 8) ? msg.payload = \"LIFEPO4X8\" :\n                  (msg.payload == 9) ? msg.payload = \"LIFEPO4X9\" :\n                  (msg.payload == 10) ? msg.payload = \"TERNARYIX7\" :\n                  (msg.payload == 11) ? msg.payload = \"TERNARYIX8\" :\n                  (msg.payload == 12) ? msg.payload = \"TERNARYIX13\" :\n                  (msg.payload == 13) ? msg.payload = \"TERNARYIX14\" :\n                  'Erreur';\n    node.send(msg);\n}\n\n\n\n/***************************Parametre 12***********************/\nif (msg.topic == dir + '57371') {\n    msg.payload = (msg.payload == '100') ? msg.payload = \"40.0\" :\n                  (msg.payload == '101') ? msg.payload = \"40.4\" :\n                  (msg.payload == '102') ? msg.payload = \"40.8\" :\n                  (msg.payload == '103') ? msg.payload = \"41.2\" :\n                  (msg.payload == '104') ? msg.payload = \"41.6\" :\n                  (msg.payload == '105') ? msg.payload = \"42.0\" :\n                  (msg.payload == '106') ? msg.payload = \"42.4\" :\n                  (msg.payload == '107') ? msg.payload = \"42.8\" :\n                  (msg.payload == '108') ? msg.payload = \"43.2\" :\n                  (msg.payload == '109') ? msg.payload = \"43.6\" :    \n                  (msg.payload == '110') ? msg.payload = \"44.0\" :\n                  (msg.payload == '111') ? msg.payload = \"44.4\" :\n                  (msg.payload == '112') ? msg.payload = \"44.8\" :\n                  (msg.payload == '113') ? msg.payload = \"45.2\" :\n                  (msg.payload == '114') ? msg.payload = \"45.6\" :\n                  (msg.payload == '115') ? msg.payload = \"46.0\" :\n                  (msg.payload == '116') ? msg.payload = \"46.4\" :\n                  (msg.payload == '117') ? msg.payload = \"46.8\" :\n                  (msg.payload == '118') ? msg.payload = \"47.2\" :\n                  (msg.payload == '119') ? msg.payload = \"47.6\" :\n                  (msg.payload == '120') ? msg.payload = \"48.0\" :\n                  (msg.payload == '121') ? msg.payload = \"48.4\" :\n                  (msg.payload == '122') ? msg.payload = \"48.8\" :\n                  (msg.payload == '123') ? msg.payload = \"49.2\" :\n                  (msg.payload == '124') ? msg.payload = \"49.6\" :\n                  (msg.payload == '125') ? msg.payload = \"50.0\" :\n                  (msg.payload == '126') ? msg.payload = \"50.4\" :\n                  (msg.payload == '127') ? msg.payload = \"50.8\" :\n                  (msg.payload == '128') ? msg.payload = \"51.2\" :\n                  (msg.payload == '129') ? msg.payload = \"51.6\" :\n                  (msg.payload == '130') ? msg.payload = \"52.0\" :\n                  (msg.payload == '131') ? msg.payload = \"52.4\" :\n                  (msg.payload == '132') ? msg.payload = \"52.8\" :\n                  (msg.payload == '133') ? msg.payload = \"53.2\" :\n                  (msg.payload == '134') ? msg.payload = \"53.6\" :\n                  (msg.payload == '135') ? msg.payload = \"54.0\" :\n                  (msg.payload == '136') ? msg.payload = \"54.4\" :\n                  (msg.payload == '137') ? msg.payload = \"54.8\" :\n                  (msg.payload == '138') ? msg.payload = \"55.2\" :\n                  (msg.payload == '139') ? msg.payload = \"55.6\" :\n                  (msg.payload == '140') ? msg.payload = \"56.0\" :\n                  (msg.payload == '141') ? msg.payload = \"56.4\" :\n                  (msg.payload == '142') ? msg.payload = \"56.8\" :\n                  (msg.payload == '143') ? msg.payload = \"57.2\" :\n                  (msg.payload == '144') ? msg.payload = \"57.6\" :\n                  (msg.payload == '145') ? msg.payload = \"58.0\" :\n                  (msg.payload == '146') ? msg.payload = \"58.4\" :\n                  (msg.payload == '147') ? msg.payload = \"58.8\" :\n                  (msg.payload == '148') ? msg.payload = \"59.2\" :\n                  (msg.payload == '149') ? msg.payload = \"59.6\" :\n                  (msg.payload == '150') ? msg.payload = \"60.0\" :                                                                   \n                  'Erreur';\n    node.send(msg);\n}\n\n/***************************Parametre 13***********************/\nif (msg.topic == dir + '57378') {\n    msg.payload = (msg.payload == '100') ? msg.payload = \"40.0\" :\n                  (msg.payload == '101') ? msg.payload = \"40.4\" :\n                  (msg.payload == '102') ? msg.payload = \"40.8\" :\n                  (msg.payload == '103') ? msg.payload = \"41.2\" :\n                  (msg.payload == '104') ? msg.payload = \"41.6\" :\n                  (msg.payload == '105') ? msg.payload = \"42.0\" :\n                  (msg.payload == '106') ? msg.payload = \"42.4\" :\n                  (msg.payload == '107') ? msg.payload = \"42.8\" :\n                  (msg.payload == '108') ? msg.payload = \"43.2\" :\n                  (msg.payload == '109') ? msg.payload = \"43.6\" :    \n                  (msg.payload == '110') ? msg.payload = \"44.0\" :\n                  (msg.payload == '111') ? msg.payload = \"44.4\" :\n                  (msg.payload == '112') ? msg.payload = \"44.8\" :\n                  (msg.payload == '113') ? msg.payload = \"45.2\" :\n                  (msg.payload == '114') ? msg.payload = \"45.6\" :\n                  (msg.payload == '115') ? msg.payload = \"46.0\" :\n                  (msg.payload == '116') ? msg.payload = \"46.4\" :\n                  (msg.payload == '117') ? msg.payload = \"46.8\" :\n                  (msg.payload == '118') ? msg.payload = \"47.2\" :\n                  (msg.payload == '119') ? msg.payload = \"47.6\" :\n                  (msg.payload == '120') ? msg.payload = \"48.0\" :\n                  (msg.payload == '121') ? msg.payload = \"48.4\" :\n                  (msg.payload == '122') ? msg.payload = \"48.8\" :\n                  (msg.payload == '123') ? msg.payload = \"49.2\" :\n                  (msg.payload == '124') ? msg.payload = \"49.6\" :\n                  (msg.payload == '125') ? msg.payload = \"50.0\" :\n                  (msg.payload == '126') ? msg.payload = \"50.4\" :\n                  (msg.payload == '127') ? msg.payload = \"50.8\" :\n                  (msg.payload == '128') ? msg.payload = \"51.2\" :\n                  (msg.payload == '129') ? msg.payload = \"51.6\" :\n                  (msg.payload == '130') ? msg.payload = \"52.0\" :\n                  (msg.payload == '131') ? msg.payload = \"52.4\" :\n                  (msg.payload == '132') ? msg.payload = \"52.8\" :\n                  (msg.payload == '133') ? msg.payload = \"53.2\" :\n                  (msg.payload == '134') ? msg.payload = \"53.6\" :\n                  (msg.payload == '135') ? msg.payload = \"54.0\" :\n                  (msg.payload == '136') ? msg.payload = \"54.4\" :\n                  (msg.payload == '137') ? msg.payload = \"54.8\" :\n                  (msg.payload == '138') ? msg.payload = \"55.2\" :\n                  (msg.payload == '139') ? msg.payload = \"55.6\" :\n                  (msg.payload == '140') ? msg.payload = \"56.0\" :\n                  (msg.payload == '141') ? msg.payload = \"56.4\" :\n                  (msg.payload == '142') ? msg.payload = \"56.8\" :\n                  (msg.payload == '143') ? msg.payload = \"57.2\" :\n                  (msg.payload == '144') ? msg.payload = \"57.6\" :\n                  (msg.payload == '145') ? msg.payload = \"58.0\" :\n                  (msg.payload == '146') ? msg.payload = \"58.4\" :\n                  (msg.payload == '147') ? msg.payload = \"58.8\" :\n                  (msg.payload == '148') ? msg.payload = \"59.2\" :\n                  (msg.payload == '149') ? msg.payload = \"59.6\" :\n                  (msg.payload == '150') ? msg.payload = \"60.0\" :                                                                   \n                  'Erreur';\n    node.send(msg);\n}\n\n/***************************Parametre 16***********************/\nif ( msg.topic == dir + '57871'){\n    msg.payload = (msg.payload == 0) ? msg.payload = \"CSO\" :\n                  (msg.payload == 1) ? msg.payload = \"CUB\" :\n                  (msg.payload == 2) ? msg.payload = \"SNU\" :\n                  (msg.payload == 3) ? msg.payload = \"OSO\" :\n                  'Erreur'; \n    node.send(msg);\n}\n\n/***************************Parametre 26***********************/\nif (msg.topic == dir + '57354') {\n    msg.payload = (msg.payload == '100') ? msg.payload = \"40.0\" :\n                  (msg.payload == '101') ? msg.payload = \"40.4\" :\n                  (msg.payload == '102') ? msg.payload = \"40.8\" :\n                  (msg.payload == '103') ? msg.payload = \"41.2\" :\n                  (msg.payload == '104') ? msg.payload = \"41.6\" :\n                  (msg.payload == '105') ? msg.payload = \"42.0\" :\n                  (msg.payload == '106') ? msg.payload = \"42.4\" :\n                  (msg.payload == '107') ? msg.payload = \"42.8\" :\n                  (msg.payload == '108') ? msg.payload = \"43.2\" :\n                  (msg.payload == '109') ? msg.payload = \"43.6\" :    \n                  (msg.payload == '110') ? msg.payload = \"44.0\" :\n                  (msg.payload == '111') ? msg.payload = \"44.4\" :\n                  (msg.payload == '112') ? msg.payload = \"44.8\" :\n                  (msg.payload == '113') ? msg.payload = \"45.2\" :\n                  (msg.payload == '114') ? msg.payload = \"45.6\" :\n                  (msg.payload == '115') ? msg.payload = \"46.0\" :\n                  (msg.payload == '116') ? msg.payload = \"46.4\" :\n                  (msg.payload == '117') ? msg.payload = \"46.8\" :\n                  (msg.payload == '118') ? msg.payload = \"47.2\" :\n                  (msg.payload == '119') ? msg.payload = \"47.6\" :\n                  (msg.payload == '120') ? msg.payload = \"48.0\" :\n                  (msg.payload == '121') ? msg.payload = \"48.4\" :\n                  (msg.payload == '122') ? msg.payload = \"48.8\" :\n                  (msg.payload == '123') ? msg.payload = \"49.2\" :\n                  (msg.payload == '124') ? msg.payload = \"49.6\" :\n                  (msg.payload == '125') ? msg.payload = \"50.0\" :\n                  (msg.payload == '126') ? msg.payload = \"50.4\" :\n                  (msg.payload == '127') ? msg.payload = \"50.8\" :\n                  (msg.payload == '128') ? msg.payload = \"51.2\" :\n                  (msg.payload == '129') ? msg.payload = \"51.6\" :\n                  (msg.payload == '130') ? msg.payload = \"52.0\" :\n                  (msg.payload == '131') ? msg.payload = \"52.4\" :\n                  (msg.payload == '132') ? msg.payload = \"52.8\" :\n                  (msg.payload == '133') ? msg.payload = \"53.2\" :\n                  (msg.payload == '134') ? msg.payload = \"53.6\" :\n                  (msg.payload == '135') ? msg.payload = \"54.0\" :\n                  (msg.payload == '136') ? msg.payload = \"54.4\" :\n                  (msg.payload == '137') ? msg.payload = \"54.8\" :\n                  (msg.payload == '138') ? msg.payload = \"55.2\" :\n                  (msg.payload == '139') ? msg.payload = \"55.6\" :\n                  (msg.payload == '140') ? msg.payload = \"56.0\" :\n                  (msg.payload == '141') ? msg.payload = \"56.4\" :\n                  (msg.payload == '142') ? msg.payload = \"56.8\" :\n                  (msg.payload == '143') ? msg.payload = \"57.2\" :\n                  (msg.payload == '144') ? msg.payload = \"57.6\" :\n                  (msg.payload == '145') ? msg.payload = \"58.0\" :\n                  (msg.payload == '146') ? msg.payload = \"58.4\" :\n                  (msg.payload == '147') ? msg.payload = \"58.8\" :\n                  (msg.payload == '148') ? msg.payload = \"59.2\" :\n                  (msg.payload == '149') ? msg.payload = \"59.6\" :\n                  (msg.payload == '150') ? msg.payload = \"60.0\" :                                                                   \n                  'Erreur';\n    node.send(msg);\n}\n\n\n/***************************Parametre 27***********************/\nif (msg.topic == dir + '57351') {\n    msg.payload = (msg.payload == '100') ? msg.payload = \"40.0\" :\n                  (msg.payload == '101') ? msg.payload = \"40.4\" :\n                  (msg.payload == '102') ? msg.payload = \"40.8\" :\n                  (msg.payload == '103') ? msg.payload = \"41.2\" :\n                  (msg.payload == '104') ? msg.payload = \"41.6\" :\n                  (msg.payload == '105') ? msg.payload = \"42.0\" :\n                  (msg.payload == '106') ? msg.payload = \"42.4\" :\n                  (msg.payload == '107') ? msg.payload = \"42.8\" :\n                  (msg.payload == '108') ? msg.payload = \"43.2\" :\n                  (msg.payload == '109') ? msg.payload = \"43.6\" :    \n                  (msg.payload == '110') ? msg.payload = \"44.0\" :\n                  (msg.payload == '111') ? msg.payload = \"44.4\" :\n                  (msg.payload == '112') ? msg.payload = \"44.8\" :\n                  (msg.payload == '113') ? msg.payload = \"45.2\" :\n                  (msg.payload == '114') ? msg.payload = \"45.6\" :\n                  (msg.payload == '115') ? msg.payload = \"46.0\" :\n                  (msg.payload == '116') ? msg.payload = \"46.4\" :\n                  (msg.payload == '117') ? msg.payload = \"46.8\" :\n                  (msg.payload == '118') ? msg.payload = \"47.2\" :\n                  (msg.payload == '119') ? msg.payload = \"47.6\" :\n                  (msg.payload == '120') ? msg.payload = \"48.0\" :\n                  (msg.payload == '121') ? msg.payload = \"48.4\" :\n                  (msg.payload == '122') ? msg.payload = \"48.8\" :\n                  (msg.payload == '123') ? msg.payload = \"49.2\" :\n                  (msg.payload == '124') ? msg.payload = \"49.6\" :\n                  (msg.payload == '125') ? msg.payload = \"50.0\" :\n                  (msg.payload == '126') ? msg.payload = \"50.4\" :\n                  (msg.payload == '127') ? msg.payload = \"50.8\" :\n                  (msg.payload == '128') ? msg.payload = \"51.2\" :\n                  (msg.payload == '129') ? msg.payload = \"51.6\" :\n                  (msg.payload == '130') ? msg.payload = \"52.0\" :\n                  (msg.payload == '131') ? msg.payload = \"52.4\" :\n                  (msg.payload == '132') ? msg.payload = \"52.8\" :\n                  (msg.payload == '133') ? msg.payload = \"53.2\" :\n                  (msg.payload == '134') ? msg.payload = \"53.6\" :\n                  (msg.payload == '135') ? msg.payload = \"54.0\" :\n                  (msg.payload == '136') ? msg.payload = \"54.4\" :\n                  (msg.payload == '137') ? msg.payload = \"54.8\" :\n                  (msg.payload == '138') ? msg.payload = \"55.2\" :\n                  (msg.payload == '139') ? msg.payload = \"55.6\" :\n                  (msg.payload == '140') ? msg.payload = \"56.0\" :\n                  (msg.payload == '141') ? msg.payload = \"56.4\" :\n                  (msg.payload == '142') ? msg.payload = \"56.8\" :\n                  (msg.payload == '143') ? msg.payload = \"57.2\" :\n                  (msg.payload == '144') ? msg.payload = \"57.6\" :\n                  (msg.payload == '145') ? msg.payload = \"58.0\" :\n                  (msg.payload == '146') ? msg.payload = \"58.4\" :\n                  (msg.payload == '147') ? msg.payload = \"58.8\" :\n                  (msg.payload == '148') ? msg.payload = \"59.2\" :\n                  (msg.payload == '149') ? msg.payload = \"59.6\" :\n                  (msg.payload == '150') ? msg.payload = \"60.0\" :                                                                   \n                  'Erreur';\n    node.send(msg);\n}\n\n/***************************Parametre 29***********************/\nif (msg.topic == dir + '57357') {\n    msg.payload = (msg.payload == '100') ? msg.payload = \"40.0\" :\n                  (msg.payload == '101') ? msg.payload = \"40.4\" :\n                  (msg.payload == '102') ? msg.payload = \"40.8\" :\n                  (msg.payload == '103') ? msg.payload = \"41.2\" :\n                  (msg.payload == '104') ? msg.payload = \"41.6\" :\n                  (msg.payload == '105') ? msg.payload = \"42.0\" :\n                  (msg.payload == '106') ? msg.payload = \"42.4\" :\n                  (msg.payload == '107') ? msg.payload = \"42.8\" :\n                  (msg.payload == '108') ? msg.payload = \"43.2\" :\n                  (msg.payload == '109') ? msg.payload = \"43.6\" :    \n                  (msg.payload == '110') ? msg.payload = \"44.0\" :\n                  (msg.payload == '111') ? msg.payload = \"44.4\" :\n                  (msg.payload == '112') ? msg.payload = \"44.8\" :\n                  (msg.payload == '113') ? msg.payload = \"45.2\" :\n                  (msg.payload == '114') ? msg.payload = \"45.6\" :\n                  (msg.payload == '115') ? msg.payload = \"46.0\" :\n                  (msg.payload == '116') ? msg.payload = \"46.4\" :\n                  (msg.payload == '117') ? msg.payload = \"46.8\" :\n                  (msg.payload == '118') ? msg.payload = \"47.2\" :\n                  (msg.payload == '119') ? msg.payload = \"47.6\" :\n                  (msg.payload == '120') ? msg.payload = \"48.0\" :\n                  (msg.payload == '121') ? msg.payload = \"48.4\" :\n                  (msg.payload == '122') ? msg.payload = \"48.8\" :\n                  (msg.payload == '123') ? msg.payload = \"49.2\" :\n                  (msg.payload == '124') ? msg.payload = \"49.6\" :\n                  (msg.payload == '125') ? msg.payload = \"50.0\" :\n                  (msg.payload == '126') ? msg.payload = \"50.4\" :\n                  (msg.payload == '127') ? msg.payload = \"50.8\" :\n                  (msg.payload == '128') ? msg.payload = \"51.2\" :\n                  (msg.payload == '129') ? msg.payload = \"51.6\" :\n                  (msg.payload == '130') ? msg.payload = \"52.0\" :\n                  (msg.payload == '131') ? msg.payload = \"52.4\" :\n                  (msg.payload == '132') ? msg.payload = \"52.8\" :\n                  (msg.payload == '133') ? msg.payload = \"53.2\" :\n                  (msg.payload == '134') ? msg.payload = \"53.6\" :\n                  (msg.payload == '135') ? msg.payload = \"54.0\" :\n                  (msg.payload == '136') ? msg.payload = \"54.4\" :\n                  (msg.payload == '137') ? msg.payload = \"54.8\" :\n                  (msg.payload == '138') ? msg.payload = \"55.2\" :\n                  (msg.payload == '139') ? msg.payload = \"55.6\" :\n                  (msg.payload == '140') ? msg.payload = \"56.0\" :\n                  (msg.payload == '141') ? msg.payload = \"56.4\" :\n                  (msg.payload == '142') ? msg.payload = \"56.8\" :\n                  (msg.payload == '143') ? msg.payload = \"57.2\" :\n                  (msg.payload == '144') ? msg.payload = \"57.6\" :\n                  (msg.payload == '145') ? msg.payload = \"58.0\" :\n                  (msg.payload == '146') ? msg.payload = \"58.4\" :\n                  (msg.payload == '147') ? msg.payload = \"58.8\" :\n                  (msg.payload == '148') ? msg.payload = \"59.2\" :\n                  (msg.payload == '149') ? msg.payload = \"59.6\" :\n                  (msg.payload == '150') ? msg.payload = \"60.0\" :                                                                   \n                  'Erreur';\n    node.send(msg);\n}\n","outputs":1,"timeout":0,"noerr":0,"initialize":"","finalize":"","libs":[],"x":1090,"y":100,"wires":[["a8d40224dcc1056e","cbba3299b8acb3a1"]]},{"id":"a8d40224dcc1056e","type":"debug","z":"18ee536d8d8af34b","name":"debug 145","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1270,"y":40,"wires":[]},{"id":"489b57f51a02d739","type":"switch","z":"18ee536d8d8af34b","name":"","property":"onduleurType","propertyType":"global","rules":[{"t":"eq","v":"easun_1","vt":"str"}],"checkall":"true","repair":false,"outputs":1,"x":280,"y":100,"wires":[["e0685df6fc7dfef1"]]},{"id":"cbba3299b8acb3a1","type":"link out","z":"18ee536d8d8af34b","name":"link out 14","mode":"link","links":["58815987c51e2a0f"],"x":1225,"y":100,"wires":[]},{"id":"4f80ddd9e0d2c1f3","type":"debug","z":"311fc27fae3e469a","g":"5ce32d0140c5ba51","name":"debug 4","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1760,"y":880,"wires":[]},{"id":"6b9f490181bf8aac","type":"link in","z":"311fc27fae3e469a","g":"5ce32d0140c5ba51","name":"link in 6","links":["63061f1830edc9a6","6b6bb33c30fda3fc","b78f48af0b8f9fdf","b949139220858ce3","c122c02ed209a876","1ef225b44346b020","3ca8ce2e0e5e0d9a"],"x":1625,"y":920,"wires":[["4f80ddd9e0d2c1f3"]]},{"id":"3990c29f14dab8fe","type":"comment","z":"311fc27fae3e469a","g":"5ce32d0140c5ba51","name":"ENVOI MQTT","info":"","x":1690,"y":820,"wires":[]},{"id":"b8ad0edd5736850d","type":"modbus-write","z":"311fc27fae3e469a","g":"967489674a3c9011","name":"","showStatusActivities":false,"showErrors":true,"showWarnings":true,"unitid":"1","dataType":"HoldingRegister","adr":"57860","quantity":"1","server":"419f10df0856f270","emptyMsgOnFail":false,"keepMsgProperties":false,"delayOnStart":false,"startDelayTime":"","x":620,"y":1860,"wires":[["57c9d2a14478cb52"],[]]},{"id":"a64827f331ba12b2","type":"modbus-getter","z":"311fc27fae3e469a","g":"967489674a3c9011","name":"onduleur request","showStatusActivities":false,"showErrors":false,"showWarnings":true,"logIOActivities":false,"unitid":"1","dataType":"HoldingRegister","adr":"57860","quantity":"1","server":"419f10df0856f270","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"delayOnStart":false,"startDelayTime":"","x":970,"y":1920,"wires":[["25fd1a026a5a92e4"],[]]},{"id":"25fd1a026a5a92e4","type":"debug","z":"311fc27fae3e469a","g":"967489674a3c9011","name":"debug 11","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1180,"y":1900,"wires":[]},{"id":"57c9d2a14478cb52","type":"delay","z":"311fc27fae3e469a","g":"967489674a3c9011","name":"","pauseType":"delay","timeout":"80","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":810,"y":1860,"wires":[["a64827f331ba12b2"]]},{"id":"fde3451044383358","type":"comment","z":"311fc27fae3e469a","g":"967489674a3c9011","name":"Priorité alimentation","info":"","x":190,"y":1840,"wires":[]},{"id":"855d5c932a356cd8","type":"inject","z":"311fc27fae3e469a","g":"15db78782c15d970","name":"10A","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"100","payloadType":"num","x":170,"y":2140,"wires":[["394533721c7623f3"]]},{"id":"ae74d6e72febf7a8","type":"inject","z":"311fc27fae3e469a","g":"15db78782c15d970","name":"20A","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"200","payloadType":"num","x":170,"y":2180,"wires":[["394533721c7623f3"]]},{"id":"082d300a5a0ed2a0","type":"inject","z":"311fc27fae3e469a","g":"15db78782c15d970","name":"40A","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"400","payloadType":"num","x":168.183349609375,"y":2216.183349609375,"wires":[["394533721c7623f3"]]},{"id":"ddb13ceb1cf145fa","type":"inject","z":"311fc27fae3e469a","g":"15db78782c15d970","name":"60A","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"600","payloadType":"num","x":170,"y":2260,"wires":[["394533721c7623f3"]]},{"id":"394533721c7623f3","type":"modbus-write","z":"311fc27fae3e469a","g":"15db78782c15d970","name":"","showStatusActivities":false,"showErrors":true,"showWarnings":true,"unitid":"1","dataType":"HoldingRegister","adr":"57861","quantity":"1","server":"419f10df0856f270","emptyMsgOnFail":false,"keepMsgProperties":false,"delayOnStart":false,"startDelayTime":"","x":440,"y":2200,"wires":[["e8ad5930198a82cb"],[]]},{"id":"ce8b691ae8e00c7a","type":"modbus-getter","z":"311fc27fae3e469a","g":"15db78782c15d970","name":"onduleur request","showStatusActivities":false,"showErrors":false,"showWarnings":true,"logIOActivities":false,"unitid":"1","dataType":"HoldingRegister","adr":"57861","quantity":"1","server":"419f10df0856f270","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"delayOnStart":false,"startDelayTime":"","x":830,"y":2200,"wires":[["a5e08080d8cb83be"],[]]},{"id":"a5e08080d8cb83be","type":"debug","z":"311fc27fae3e469a","g":"15db78782c15d970","name":"debug 12","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1040,"y":2180,"wires":[]},{"id":"e8ad5930198a82cb","type":"delay","z":"311fc27fae3e469a","g":"15db78782c15d970","name":"","pauseType":"delay","timeout":"80","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":630,"y":2200,"wires":[["ce8b691ae8e00c7a"]]},{"id":"15fdddf3b859a30c","type":"comment","z":"311fc27fae3e469a","g":"15db78782c15d970","name":"courant de charge  edf","info":"","x":200,"y":2080,"wires":[]},{"id":"7dace6de2811a2d7","type":"inject","z":"311fc27fae3e469a","g":"cc4688143a5d1e7f","name":"10A","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"100","payloadType":"num","x":170,"y":2560,"wires":[["908541f6313eb53a"]]},{"id":"eef4bf3db86b25c7","type":"inject","z":"311fc27fae3e469a","g":"cc4688143a5d1e7f","name":"30A","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"300","payloadType":"num","x":170,"y":2600,"wires":[["908541f6313eb53a"]]},{"id":"1259390c5aaeb717","type":"inject","z":"311fc27fae3e469a","g":"cc4688143a5d1e7f","name":"60A","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"600","payloadType":"num","x":168.183349609375,"y":2636.183349609375,"wires":[["908541f6313eb53a"]]},{"id":"ecc3fbb7927dc297","type":"inject","z":"311fc27fae3e469a","g":"cc4688143a5d1e7f","name":"80A","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"800","payloadType":"num","x":170,"y":2680,"wires":[["908541f6313eb53a"]]},{"id":"908541f6313eb53a","type":"modbus-write","z":"311fc27fae3e469a","g":"cc4688143a5d1e7f","name":"","showStatusActivities":false,"showErrors":true,"showWarnings":true,"unitid":"1","dataType":"HoldingRegister","adr":"57866","quantity":"1","server":"419f10df0856f270","emptyMsgOnFail":false,"keepMsgProperties":false,"delayOnStart":false,"startDelayTime":"","x":440,"y":2620,"wires":[["86b269d2760cefe3"],[]]},{"id":"6c73b0770dd83c5f","type":"modbus-getter","z":"311fc27fae3e469a","g":"cc4688143a5d1e7f","name":"onduleur request","showStatusActivities":false,"showErrors":false,"showWarnings":true,"logIOActivities":false,"unitid":"1","dataType":"HoldingRegister","adr":"57866","quantity":"1","server":"419f10df0856f270","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"delayOnStart":false,"startDelayTime":"","x":830,"y":2620,"wires":[["0bd5844d06a1f25a"],[]]},{"id":"0bd5844d06a1f25a","type":"debug","z":"311fc27fae3e469a","g":"cc4688143a5d1e7f","name":"debug 13","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1040,"y":2600,"wires":[]},{"id":"86b269d2760cefe3","type":"delay","z":"311fc27fae3e469a","g":"cc4688143a5d1e7f","name":"","pauseType":"delay","timeout":"80","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":630,"y":2620,"wires":[["6c73b0770dd83c5f"]]},{"id":"5ec8448119cd55cd","type":"comment","z":"311fc27fae3e469a","g":"cc4688143a5d1e7f","name":"courant de charge solaire","info":"","x":210,"y":2500,"wires":[]},{"id":"63278947e277a91a","type":"inject","z":"311fc27fae3e469a","g":"34080c1dbceb7ad9","name":"edf et solaire","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"2","payloadType":"num","x":590,"y":2940,"wires":[["13705e1701b7c8f5"]]},{"id":"1b23b7583cc49687","type":"inject","z":"311fc27fae3e469a","g":"34080c1dbceb7ad9","name":"solaire uniquement","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"3","payloadType":"num","x":610,"y":2980,"wires":[["13705e1701b7c8f5"]]},{"id":"07e8f4ddd2f4194f","type":"inject","z":"311fc27fae3e469a","g":"34080c1dbceb7ad9","name":"edf puis solaire","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"num","x":600,"y":2900,"wires":[["13705e1701b7c8f5"]]},{"id":"f8fa62ad9c76586f","type":"inject","z":"311fc27fae3e469a","g":"34080c1dbceb7ad9","name":"solaire puis edf","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"num","x":600,"y":2860,"wires":[["13705e1701b7c8f5"]]},{"id":"13705e1701b7c8f5","type":"modbus-write","z":"311fc27fae3e469a","g":"34080c1dbceb7ad9","name":"","showStatusActivities":false,"showErrors":true,"showWarnings":true,"unitid":"1","dataType":"HoldingRegister","adr":"57871","quantity":"1","server":"419f10df0856f270","emptyMsgOnFail":false,"keepMsgProperties":false,"delayOnStart":false,"startDelayTime":"","x":660,"y":3040,"wires":[["23c547bf67532699"],[]]},{"id":"334439e9ad50d741","type":"modbus-getter","z":"311fc27fae3e469a","g":"34080c1dbceb7ad9","name":"onduleur request","showStatusActivities":false,"showErrors":false,"showWarnings":true,"logIOActivities":false,"unitid":"1","dataType":"HoldingRegister","adr":"57871","quantity":"1","server":"419f10df0856f270","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"delayOnStart":false,"startDelayTime":"","x":950,"y":2920,"wires":[["7279b92a9ac92bd0"],[]]},{"id":"7279b92a9ac92bd0","type":"debug","z":"311fc27fae3e469a","g":"34080c1dbceb7ad9","name":"debug 14","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":1060,"y":3000,"wires":[]},{"id":"23c547bf67532699","type":"delay","z":"311fc27fae3e469a","g":"34080c1dbceb7ad9","name":"","pauseType":"delay","timeout":"80","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":850,"y":3000,"wires":[["334439e9ad50d741"]]},{"id":"15bf76f010f53a80","type":"comment","z":"311fc27fae3e469a","g":"34080c1dbceb7ad9","name":"priorité charge batterie","info":"","x":220,"y":2860,"wires":[]},{"id":"df025d486b8d3c22","type":"comment","z":"311fc27fae3e469a","g":"005e3977faddc2b6","name":"REGLAGES ONDULEUR","info":"","x":190,"y":1740,"wires":[]},{"id":"134fe8f59e78141f","type":"mqtt in","z":"311fc27fae3e469a","g":"005e3977faddc2b6","name":"","topic":"homeassistant/courantdechargemax","qos":"2","datatype":"auto-detect","broker":"215683.1452d97e","nl":false,"rap":true,"rh":0,"inputs":0,"x":440,"y":2540,"wires":[["908541f6313eb53a"]]},{"id":"4c203a3901201565","type":"mqtt in","z":"311fc27fae3e469a","g":"967489674a3c9011","name":"","topic":"homeassistant/modeonduleur","qos":"2","datatype":"auto-detect","broker":"215683.1452d97e","nl":false,"rap":true,"rh":0,"inputs":0,"x":400,"y":1940,"wires":[["b8ad0edd5736850d"]]},{"id":"785b7cd18f6b5a7f","type":"mqtt in","z":"311fc27fae3e469a","g":"34080c1dbceb7ad9","name":"","topic":"homeassistant/modechargebatterie","qos":"2","datatype":"auto-detect","broker":"215683.1452d97e","nl":false,"rap":true,"rh":0,"inputs":0,"x":320,"y":3040,"wires":[["13705e1701b7c8f5"]]},{"id":"73c97bc9eeac3d19","type":"inject","z":"311fc27fae3e469a","g":"967489674a3c9011","name":"BATTERIE","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"2","payloadType":"num","x":420,"y":1820,"wires":[["b8ad0edd5736850d"]]},{"id":"3de355e2cc2b94a5","type":"inject","z":"311fc27fae3e469a","g":"967489674a3c9011","name":"SOL","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"1","payloadType":"num","x":410,"y":1860,"wires":[["b8ad0edd5736850d"]]},{"id":"9da4942675eb964c","type":"inject","z":"311fc27fae3e469a","g":"967489674a3c9011","name":"EDF","props":[{"p":"payload"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"0","payloadType":"num","x":410,"y":1900,"wires":[["b8ad0edd5736850d"]]},{"id":"f1afb26fdb66a314","type":"inject","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"","payloadType":"date","x":184.73333740234375,"y":188.73332977294922,"wires":[["c79eaae3c65d0bc4"]]},{"id":"78daa8e7a58c103d","type":"function","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"Map onduleur data","func":"//var realtimeArray = msg.payload.Data ; \nvar realtimeArray = msg.payload ; \nvar codeerreur, tensionbatterie, edftension, edfcourant, edffrequence, onduleurtension, onduleurcourant, onduleurfrequence, onduleurcourantcharges, onduleurpuissance, onduleurpuissancereactive, onduleurtemperaturemin, onduleurtemperature, onduleurtemperatureac, onduleurtemperaturedc, facteurdepuissance, courantchargebatteriesuredf, pourcentageutilisationonduleur ;\ncodeerreur = { payload: realtimeArray[0] , topic: \"easun/onduleur/codeerreur\"};\nedftension = { payload: realtimeArray[15]/10, topic: \"easun/onduleur/edftension\"};\nedfcourant = { payload: realtimeArray[16]/10, topic: \"easun/onduleur/edfcourant\"};\nedffrequence = { payload: realtimeArray[17]/100, topic: \"easun/onduleur/edffrequence\"};\nonduleurtension = { payload: realtimeArray[18]/10, topic: \"easun/onduleur/onduleurtension\"};\nonduleurcourant = { payload: realtimeArray[19]/10, topic: \"easun/onduleur/onduleurcourant\"};\nonduleurfrequence = { payload: realtimeArray[20]/100, topic: \"easun/onduleur/onduleurfrequence\"};\nonduleurcourantcharges = { payload: realtimeArray[21] / 10, topic: \"easun/onduleur/onduleurcourantcharges\" };\nonduleurpuissance = { payload: realtimeArray[23], topic: \"easun/onduleur/onduleurpuissance\"};\nonduleurpuissancereactive = { payload: realtimeArray[24], topic: \"easun/onduleur/onduleurpuissancereactive\" };\nonduleurtemperature = { payload: realtimeArray[30]/10, topic: \"easun/onduleur/onduleurtemperature\"};\nonduleurtemperatureac = { payload: realtimeArray[28]/10, topic: \"easun/onduleur/onduleurtemperatureac\"};\nonduleurtemperaturedc = { payload: realtimeArray[29]/10, topic: \"easun/onduleur/onduleurtemperaturedc\"};\nfacteurdepuissance = { payload: realtimeArray[22] , topic: \"easun/onduleur/facteurdepuissance\" };\ncourantchargebatteriesuredf = { payload: realtimeArray[26]/10, topic: \"easun/onduleur/courantchargebatteriesuredf\" };\npourcentageutilisationonduleur = { payload: realtimeArray[27], topic: \"easun/onduleur/pourcentageutilisationonduleur\" };\n\nreturn [codeerreur, edftension, edfcourant, edffrequence, onduleurtension, onduleurcourant, onduleurfrequence, onduleurcourantcharges, onduleurpuissance, onduleurpuissancereactive, onduleurtemperature, onduleurtemperatureac, onduleurtemperaturedc, facteurdepuissance, courantchargebatteriesuredf, pourcentageutilisationonduleur];\n\n","outputs":16,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":664.7333374023438,"y":268.7333297729492,"wires":[["3ca8ce2e0e5e0d9a"],["3ca8ce2e0e5e0d9a"],["3ca8ce2e0e5e0d9a"],["3ca8ce2e0e5e0d9a"],["3ca8ce2e0e5e0d9a"],["3ca8ce2e0e5e0d9a"],["3ca8ce2e0e5e0d9a"],["3ca8ce2e0e5e0d9a"],["3ca8ce2e0e5e0d9a"],["3ca8ce2e0e5e0d9a"],["3ca8ce2e0e5e0d9a"],["3ca8ce2e0e5e0d9a"],["3ca8ce2e0e5e0d9a"],["3ca8ce2e0e5e0d9a"],["3ca8ce2e0e5e0d9a"],["3ca8ce2e0e5e0d9a"]],"outputLabels":["PV1Current","PV2Current","PV1Volt","PV2Volt","gridCurrent","gridVolt","inverter","inverterTemp","solarToday","solarTotal","FIP","PV1P","PV2P","","",""]},{"id":"dffb335cf5d16dc4","type":"debug","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"debug 3","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":474.73333740234375,"y":148.73332977294922,"wires":[]},{"id":"3ca8ce2e0e5e0d9a","type":"link out","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"link out 5","mode":"link","links":["58815987c51e2a0f","6b9f490181bf8aac"],"x":1045,"y":280,"wires":[]},{"id":"b346ed8f4ce86b21","type":"function","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"Map photovoltaique et batterie data","func":"//var realtimeArray = msg.payload.Data ; \nvar realtimeArray = msg.payload ; \nvar  batterietension, batteriecourant, batterycourantchargesuredf, tensionphotovoltaique, courantphotovoltaique, puissancephotovoltaique, puissancechargebatterie ;\nbatterietension = { payload: realtimeArray[1]/10, topic: \"easun/onduleur/batterietension\"};\nbatteriecourant = { payload: realtimeArray[2]/1000, topic: \"easun/onduleur/batteriecourant\"};\nbatterycourantchargesuredf = { payload: realtimeArray[3] / 10, topic: \"easun/onduleur/batteriecourantchargesuredf\"};\ntensionphotovoltaique = { payload: realtimeArray[7]/10, topic: \"easun/onduleur/tensionphotovoltaique\"};\ncourantphotovoltaique = { payload: realtimeArray[8]/10, topic: \"easun/onduleur/courantphotovoltaique\"};\npuissancephotovoltaique = { payload: realtimeArray[9], topic: \"easun/onduleur/puissancephotovoltaique\"};\npuissancechargebatterie = { payload: realtimeArray[14], topic: \"easun/onduleur/puissancechargebatterie\" };\nreturn [batterietension, batteriecourant, batterycourantchargesuredf, tensionphotovoltaique, courantphotovoltaique, puissancephotovoltaique, puissancechargebatterie];","outputs":8,"noerr":0,"initialize":"","finalize":"","libs":[],"x":714.7333374023438,"y":468.7333297729492,"wires":[["63061f1830edc9a6"],["63061f1830edc9a6"],["63061f1830edc9a6"],["63061f1830edc9a6"],["63061f1830edc9a6"],["63061f1830edc9a6"],["63061f1830edc9a6"],["63061f1830edc9a6"]],"outputLabels":["PV1Current","PV2Current","PV1Volt","PV2Volt","gridCurrent","gridVolt","inverter",""]},{"id":"63061f1830edc9a6","type":"link out","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"link out 6","mode":"link","links":["58815987c51e2a0f","6b9f490181bf8aac"],"x":1045,"y":460,"wires":[]},{"id":"7a8c8c1df86bca86","type":"comment","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"Onduleur recup infos","info":"","x":204.73333740234375,"y":48.73332977294922,"wires":[]},{"id":"c79eaae3c65d0bc4","type":"modbus-getter","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"onduleur","showStatusActivities":true,"showErrors":true,"showWarnings":true,"logIOActivities":false,"unitid":"1","dataType":"HoldingRegister","adr":"516","quantity":"32","server":"419f10df0856f270","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":true,"keepMsgProperties":true,"delayOnStart":false,"startDelayTime":"","x":360,"y":260,"wires":[["78daa8e7a58c103d","dffb335cf5d16dc4","19e15ee858d124be"],[]]},{"id":"7efb99d2814214c7","type":"modbus-getter","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"batterie et photovoltaique","showStatusActivities":false,"showErrors":false,"showWarnings":true,"logIOActivities":false,"unitid":"1","dataType":"HoldingRegister","adr":"256","quantity":"16","server":"419f10df0856f270","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"delayOnStart":false,"startDelayTime":"","x":404.73333740234375,"y":468.7333297729492,"wires":[["b346ed8f4ce86b21","bc5782cd244d386e","7a102481b9969ef4"],[]]},{"id":"d10f88c65925bac8","type":"modbus-getter","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"reglages onduleur","showStatusActivities":false,"showErrors":false,"showWarnings":true,"logIOActivities":false,"unitid":"1","dataType":"HoldingRegister","adr":"57856","quantity":"17","server":"419f10df0856f270","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"delayOnStart":false,"startDelayTime":"","x":384.73333740234375,"y":808.7333297729492,"wires":[["7fd387aad640112b","d5bd92791d4257e6","7b9af628b0910282"],[]]},{"id":"7fd387aad640112b","type":"function","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"Map onduleur setup","func":"//var realtimeArray = msg.payload.Data ; \nvar realtimeArray = msg.payload ; \nvar  rs485adress, outputpriority, maxacchargecurrent, outputvoltageset, quichargebatterie,  maxchargeccurrent, egalisationvoltageactivation, surchargeautorestart, surchauffeautorestart,bypasssurchargeactivation;\nrs485adress =    { payload: realtimeArray[0] , topic: \"easun/onduleur/rs485adress\"};\noutputpriority =   { payload: realtimeArray[4], topic: \"easun/onduleur/outputpriority\"};\nmaxacchargecurrent = { payload: realtimeArray[5] /10, topic: \"easun/onduleur/courantchargemaxac\"};\noutputvoltageset = { payload: realtimeArray[8] /10, topic: \"easun/onduleur/reglagetensionsortie\"};\nquichargebatterie = { payload: realtimeArray[15] , topic: \"easun/batterie/quichargebatterie\"};\nmaxchargeccurrent = { payload: realtimeArray[10] /10, topic: \"easun/onduleur/courantchargemax\"};\negalisationvoltageactivation = { payload: realtimeArray[6] , topic: \"easun/onduleur/egalisationvoltageactivation\" };\nsurchargeautorestart = { payload: realtimeArray[13] , topic: \"easun/onduleur/surchargeautorestart\" };\nsurchauffeautorestart = { payload: realtimeArray[14] , topic: \"easun/onduleur/surchauffeautorestart\" };\nbypasssurchargeactivation = { payload: realtimeArray[18] , topic: \"easun/onduleur/bypasssurchargeactivation\" };\n\nreturn [quichargebatterie, outputpriority, rs485adress, maxacchargecurrent, outputvoltageset, maxchargeccurrent, egalisationvoltageactivation, surchargeautorestart, surchauffeautorestart, bypasssurchargeactivation];","outputs":10,"noerr":0,"initialize":"","finalize":"","libs":[],"x":674.7333374023438,"y":808.7333297729492,"wires":[["c7a37ee3c8a97616"],["6171ef84a5d34fe1"],["1ef225b44346b020"],["1ef225b44346b020"],["1ef225b44346b020"],["1ef225b44346b020"],["1ef225b44346b020"],["1ef225b44346b020"],["1ef225b44346b020"],["1ef225b44346b020"]],"outputLabels":["PV1Current","PV2Current","PV1Volt","PV2Volt","gridCurrent","gridVolt","inverter","","",""]},{"id":"d5bd92791d4257e6","type":"debug","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"debug 31","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":474.73333740234375,"y":688.7333297729492,"wires":[]},{"id":"306bca2e5dd4e559","type":"switch","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"type batterie","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"},{"t":"eq","v":"4","vt":"num"},{"t":"eq","v":"5","vt":"num"},{"t":"eq","v":"6","vt":"num"},{"t":"eq","v":"7","vt":"num"},{"t":"eq","v":"8","vt":"num"},{"t":"eq","v":"9","vt":"num"},{"t":"eq","v":"10","vt":"num"},{"t":"eq","v":"11","vt":"num"},{"t":"eq","v":"12","vt":"num"},{"t":"eq","v":"13","vt":"num"}],"checkall":"true","repair":false,"outputs":14,"x":1064.7333374023438,"y":968.7333297729492,"wires":[["e07fb359209a7966"],["e7bbaf1df4a2717b"],["cac414cdb64a4750"],["9d784fd1e6ad4f3f"],["cc40901d84761a96"],["ecd3a2e3e6e96cf5"],["e23d93e9473d4098"],["a3d6bbe1c57abca8"],["dd74e7e6896517e6"],["a7b2c438b8d1904c"],["1c35e42cebc78869"],["3641c751711f6ce6"],["9c857ebd63233e3b"],["ac1e31523c9afefa"]]},{"id":"e07fb359209a7966","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"USE","rules":[{"t":"set","p":"payload","pt":"msg","to":"USE","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1264.7333374023438,"y":828.7333297729492,"wires":[["6b6bb33c30fda3fc"]]},{"id":"e7bbaf1df4a2717b","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"SLD","rules":[{"t":"set","p":"payload","pt":"msg","to":"SLD","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1264.7333374023438,"y":868.7333297729492,"wires":[["6b6bb33c30fda3fc"]]},{"id":"cac414cdb64a4750","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"FLD","rules":[{"t":"set","p":"payload","pt":"msg","to":"FLD","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1264.7333374023438,"y":908.7333297729492,"wires":[["6b6bb33c30fda3fc"]]},{"id":"9d784fd1e6ad4f3f","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"GEL","rules":[{"t":"set","p":"payload","pt":"msg","to":"GEL","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1264.7333374023438,"y":948.7333297729492,"wires":[["6b6bb33c30fda3fc"]]},{"id":"cc40901d84761a96","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"LIFEPO4X14","rules":[{"t":"set","p":"payload","pt":"msg","to":"LIFEPO4X14","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1304.7333374023438,"y":988.7333297729492,"wires":[["6b6bb33c30fda3fc"]]},{"id":"ecd3a2e3e6e96cf5","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"LIFEPO4X15","rules":[{"t":"set","p":"payload","pt":"msg","to":"LIFEPO4X15","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1304.7333374023438,"y":1028.7333297729492,"wires":[["6b6bb33c30fda3fc"]]},{"id":"e23d93e9473d4098","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"LIFEPO4X16","rules":[{"t":"set","p":"payload","pt":"msg","to":"LIFEPO4X16","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1304.7333374023438,"y":1068.7333297729492,"wires":[["6b6bb33c30fda3fc"]]},{"id":"a3d6bbe1c57abca8","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"LIFEPO4X7","rules":[{"t":"set","p":"payload","pt":"msg","to":"LIFEPO4X7","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1304.7333374023438,"y":1108.7333297729492,"wires":[["6b6bb33c30fda3fc"]]},{"id":"dd74e7e6896517e6","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"LIFEPO4X8","rules":[{"t":"set","p":"payload","pt":"msg","to":"LIFEPO4X8","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1304.7333374023438,"y":1148.7333297729492,"wires":[["6b6bb33c30fda3fc"]]},{"id":"a7b2c438b8d1904c","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"LIFEPO4X9","rules":[{"t":"set","p":"payload","pt":"msg","to":"LIFEPO4X9","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1304.7333374023438,"y":1188.7333297729492,"wires":[["6b6bb33c30fda3fc"]]},{"id":"1c35e42cebc78869","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"TERNARYlX7","rules":[{"t":"set","p":"payload","pt":"msg","to":"TERNARYlX7","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1324.7333374023438,"y":1228.7333297729492,"wires":[["6b6bb33c30fda3fc"]]},{"id":"3641c751711f6ce6","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"TERNARYlX8","rules":[{"t":"set","p":"payload","pt":"msg","to":"TERNARYlX8","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1324.7333374023438,"y":1268.7333297729492,"wires":[["6b6bb33c30fda3fc"]]},{"id":"9c857ebd63233e3b","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"TERNARYlX13","rules":[{"t":"set","p":"payload","pt":"msg","to":"TERNARYlX13","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1324.7333374023438,"y":1308.7333297729492,"wires":[["6b6bb33c30fda3fc"]]},{"id":"ac1e31523c9afefa","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"TERNARYlX14","rules":[{"t":"set","p":"payload","pt":"msg","to":"TERNARYlX14","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1324.7333374023438,"y":1348.7333297729492,"wires":[["6b6bb33c30fda3fc"]]},{"id":"bc5782cd244d386e","type":"debug","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"debug 34","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":474.73333740234375,"y":408.7333297729492,"wires":[]},{"id":"6b6bb33c30fda3fc","type":"link out","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"link out 7","mode":"link","links":["58815987c51e2a0f","6b9f490181bf8aac"],"x":1469.7333374023438,"y":1128.7333297729492,"wires":[]},{"id":"1ef225b44346b020","type":"link out","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"link out 8","mode":"link","links":["58815987c51e2a0f","6b9f490181bf8aac"],"x":859.7333374023438,"y":848.7333297729492,"wires":[]},{"id":"6171ef84a5d34fe1","type":"switch","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"OUPUT PRIORITY","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"}],"checkall":"true","repair":false,"outputs":3,"x":1044.7333374023438,"y":728.7333297729492,"wires":[["521b41faaeb77c52"],["9703867af121ddff"],["0c83e6def8263fd1"]]},{"id":"521b41faaeb77c52","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"SOL","rules":[{"t":"set","p":"payload","pt":"msg","to":"SOL","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1244.7333374023438,"y":688.7333297729492,"wires":[["b78f48af0b8f9fdf"]]},{"id":"9703867af121ddff","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"UTI","rules":[{"t":"set","p":"payload","pt":"msg","to":"UTI","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1244.7333374023438,"y":728.7333297729492,"wires":[["b78f48af0b8f9fdf"]]},{"id":"0c83e6def8263fd1","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"SBU","rules":[{"t":"set","p":"payload","pt":"msg","to":"SBU","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1244.7333374023438,"y":768.7333297729492,"wires":[["b78f48af0b8f9fdf"]]},{"id":"b78f48af0b8f9fdf","type":"link out","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"link out 9","mode":"link","links":["58815987c51e2a0f","6b9f490181bf8aac"],"x":1389.7333374023438,"y":648.7333297729492,"wires":[]},{"id":"c7a37ee3c8a97616","type":"switch","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"},{"t":"eq","v":"2","vt":"num"},{"t":"eq","v":"3","vt":"num"}],"checkall":"true","repair":false,"outputs":4,"x":1004.7333374023438,"y":628.7333297729492,"wires":[["ee0a0ecc24c24882"],["2e63d6fd64fa9cba"],["92bf8281c9314a67"],["1b678453bc839df9"]]},{"id":"ee0a0ecc24c24882","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"CSO","rules":[{"t":"set","p":"payload","pt":"msg","to":"CSO","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1244.7333374023438,"y":508.7333297729492,"wires":[["b78f48af0b8f9fdf"]]},{"id":"2e63d6fd64fa9cba","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"CUB","rules":[{"t":"set","p":"payload","pt":"msg","to":"CUB","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1244.7333374023438,"y":548.7333297729492,"wires":[["b78f48af0b8f9fdf"]]},{"id":"92bf8281c9314a67","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"SNU","rules":[{"t":"set","p":"payload","pt":"msg","to":"SNU","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1244.7333374023438,"y":588.7333297729492,"wires":[["b78f48af0b8f9fdf"]]},{"id":"1b678453bc839df9","type":"change","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"OSO","rules":[{"t":"set","p":"payload","pt":"msg","to":"OSO","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":1244.7333374023438,"y":628.7333297729492,"wires":[["b78f48af0b8f9fdf"]]},{"id":"ec1aeb21f3ec8ea3","type":"modbus-getter","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"reglages onduleur","showStatusActivities":false,"showErrors":false,"showWarnings":true,"logIOActivities":false,"unitid":"1","dataType":"HoldingRegister","adr":"57346","quantity":"32","server":"419f10df0856f270","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"delayOnStart":false,"startDelayTime":"","x":384.73333740234375,"y":1068.7333297729492,"wires":[["dde9a06e6090a296","710d129a2cd5840a","386db01067c1dd83"],[]]},{"id":"dde9a06e6090a296","type":"function","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"Map onduleur setup","func":"//var realtimeArray = msg.payload.Data ; \nvar realtimeArray = msg.payload ; \nvar  typebatterie, egalisationvoltage, boostchargevoltage, tensionfloatbatterie, tensionbassealarme, tensionbassebatterie, tensionbassecoupurebatterie, tempsavantcoupurebassebatterie, tempschargeboost, intervalleegalisationday, tensionsbutouti, tensionutitosbu, reglagecapacitebatterie, reglagetensionbatterie ;\ntypebatterie =    { payload: realtimeArray[2] , topic: \"easun/onduleur/typebatterie\"};\negalisationvoltage =   { payload: realtimeArray[5]*0.4, topic: \"easun/onduleur/egalisationvoltage\"};\nboostchargevoltage = { payload: realtimeArray[6] *0.4, topic: \"easun/onduleur/boostchargevoltage\"};\ntensionfloatbatterie = { payload: realtimeArray[7] *0.4, topic: \"easun/onduleur/tensionfloatbatterie\"};\ntensionbassealarme = { payload: realtimeArray[10] *0.4 , topic: \"easun/batterie/tensionbassealarme\"};\ntensionbassebatterie = { payload: realtimeArray[11] *0.4, topic: \"easun/onduleur/tensionbassebatterie\"};\ntensionbassecoupurebatterie = { payload: realtimeArray[12] *0.4, topic: \"easun/onduleur/tensionbassecoupurebatterie\" };\ntempsavantcoupurebassebatterie = { payload: realtimeArray[14] , topic: \"easun/onduleur/tempsavantcoupurebassebatterie\" };\ntempschargeboost = { payload: realtimeArray[16], topic: \"easun/onduleur/tempschargeboost\" };\nintervalleegalisationday = { payload: realtimeArray[21], topic: \"easun/onduleur/intervalleegalisationday\" };\ntensionsbutouti = { payload: realtimeArray[25] * 0.4, topic: \"easun/onduleur/tensionsbutouti\" };\ntensionutitosbu = { payload: realtimeArray[32] * 0.4, topic: \"easun/onduleur/tensionutitosbu\" };\nreglagecapacitebatterie = { payload: realtimeArray[0] , topic: \"easun/onduleur/reglagecapacitebatterie\" };\nreglagetensionbatterie = { payload: realtimeArray[1] , topic: \"easun/onduleur/reglagetensionbatterie\" };\n\nreturn [typebatterie, egalisationvoltage, boostchargevoltage, tensionfloatbatterie, tensionbassealarme, tensionbassebatterie, tensionbassecoupurebatterie, tempsavantcoupurebassebatterie, tempschargeboost, intervalleegalisationday, tensionsbutouti, tensionutitosbu, reglagecapacitebatterie, reglagetensionbatterie];","outputs":14,"noerr":0,"initialize":"","finalize":"","libs":[],"x":674.7333374023438,"y":1068.7333297729492,"wires":[["306bca2e5dd4e559"],["b949139220858ce3"],["b949139220858ce3"],["b949139220858ce3"],["b949139220858ce3"],["b949139220858ce3"],["b949139220858ce3"],["b949139220858ce3"],["b949139220858ce3"],["b949139220858ce3"],["adb658b67d4f3eb5"],[],["b949139220858ce3"],["b949139220858ce3"]],"outputLabels":["PV1Current","PV2Current","PV1Volt","PV2Volt","gridCurrent","gridVolt","inverter","","","","","","",""]},{"id":"710d129a2cd5840a","type":"debug","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"debug 35","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":474.73333740234375,"y":948.7333297729492,"wires":[]},{"id":"b949139220858ce3","type":"link out","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"link out 10","mode":"link","links":["58815987c51e2a0f","6b9f490181bf8aac"],"x":959.7333374023438,"y":1108.7333297729492,"wires":[]},{"id":"b107c45925a7ac3f","type":"modbus-getter","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"statistiques","showStatusActivities":false,"showErrors":false,"showWarnings":true,"logIOActivities":false,"unitid":"1","dataType":"HoldingRegister","adr":"61485","quantity":"30","server":"419f10df0856f270","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"delayOnStart":false,"startDelayTime":"","x":364.73333740234375,"y":1388.7333297729492,"wires":[["9b831807cd5cbdc6","8f23f3d4e4a4b813","173a9a67b995ff02"],[]]},{"id":"9b831807cd5cbdc6","type":"function","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"Map onduleur setup","func":"//var realtimeArray = msg.payload.Data ; \nvar realtimeArray = msg.payload ; \nvar  batteriechargeajd, batteriedechargeajd, puissancesuredfajd, photovoltaiquetotalajd, consommationajd, batteriechargetotale, batteriedechargetotale, photovoltaiquetotal, consommationtotale, tempstotalfonctionnementonduleurajd, tempstotalbypassajd, tempstotalbypass;\nbatteriechargeajd = { payload: realtimeArray[0]*0.052, topic: \"easun/onduleur/batteriechargeajd\" };\nbatteriedechargeajd = { payload: realtimeArray[1]*0.052, topic: \"easun/onduleur/batteriedechargeajd\" };\npuissancesuredfajd = { payload: realtimeArray[15] / 10, topic: \"easun/onduleur/puissancesuredfajd\" }; \nphotovoltaiquetotalajd = { payload: realtimeArray[2]/10 , topic: \"easun/onduleur/photovoltaiquetotalajd\"};\nconsommationajd = { payload: realtimeArray[3]/10, topic: \"easun/onduleur/consommationtotalajd\"};\nbatteriechargetotale = { payload: realtimeArray[7] + realtimeArray[8]  , topic: \"easun/onduleur/batteriechargetotale\"};\nbatteriedechargetotale = { payload: realtimeArray[9] , topic: \"easun/onduleur/batteriedechargetotale\"};\nphotovoltaiquetotal = { payload: realtimeArray[11] /10, topic: \"easun/batterie/photovoltaiquetotal\"};\nconsommationtotale = { payload: realtimeArray[13] /10, topic: \"easun/onduleur/consommationtotale\"};\ntempstotalfonctionnementonduleurajd = { payload: realtimeArray[28], topic: \"easun/onduleur/tempstotalfonctionnementonduleur\" };\ntempstotalbypassajd = { payload: realtimeArray[30], topic: \"easun/onduleur/tempstotalbypassajd\" };\ntempstotalbypass = { payload: realtimeArray[41], topic: \"easun/onduleur/tempstotalbypass\" };\nreturn [batteriechargeajd, batteriedechargeajd, puissancesuredfajd, photovoltaiquetotalajd, consommationajd, batteriechargetotale, batteriedechargetotale, photovoltaiquetotal, consommationtotale, tempstotalfonctionnementonduleurajd, tempstotalbypassajd, tempstotalbypass];","outputs":13,"timeout":"","noerr":0,"initialize":"","finalize":"","libs":[],"x":674.7333374023438,"y":1388.7333297729492,"wires":[["6b74f19c54c1d244"],["4f08f345d5e9950b"],["c122c02ed209a876"],["c122c02ed209a876"],["c122c02ed209a876"],["c122c02ed209a876"],["c122c02ed209a876"],["c122c02ed209a876"],["c122c02ed209a876"],["c122c02ed209a876"],["c122c02ed209a876"],["c122c02ed209a876"],["c122c02ed209a876"]],"outputLabels":["PV1Current","PV2Current","PV1Volt","PV2Volt","gridCurrent","gridVolt","inverter","","","","","",""]},{"id":"8f23f3d4e4a4b813","type":"debug","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"debug 36","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"false","statusVal":"","statusType":"auto","x":474.73333740234375,"y":1268.7333297729492,"wires":[]},{"id":"c122c02ed209a876","type":"link out","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"link out 11","mode":"link","links":["58815987c51e2a0f","6b9f490181bf8aac"],"x":1039.7333374023438,"y":1348.7333297729492,"wires":[]},{"id":"19e15ee858d124be","type":"delay","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"","pauseType":"delay","timeout":"80","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":204.73333740234375,"y":468.7333297729492,"wires":[["7efb99d2814214c7"]]},{"id":"7a102481b9969ef4","type":"delay","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"","pauseType":"delay","timeout":"80","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":204.73333740234375,"y":808.7333297729492,"wires":[["d10f88c65925bac8"]]},{"id":"7b9af628b0910282","type":"delay","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"","pauseType":"delay","timeout":"80","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":204.73333740234375,"y":1068.7333297729492,"wires":[["ec1aeb21f3ec8ea3"]]},{"id":"386db01067c1dd83","type":"delay","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"","pauseType":"delay","timeout":"80","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":204.73333740234375,"y":1388.7333297729492,"wires":[["b107c45925a7ac3f"]]},{"id":"6b74f19c54c1d244","type":"string","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"","methods":[{"name":"toFloat","params":[{"type":"num","value":"2"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":884.7333374023438,"y":1268.7333297729492,"wires":[["c122c02ed209a876"]]},{"id":"4f08f345d5e9950b","type":"string","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"","methods":[{"name":"toFloat","params":[{"type":"num","value":"2"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":884.7333374023438,"y":1308.7333297729492,"wires":[["c122c02ed209a876"]]},{"id":"f66f1a0fb11677fd","type":"modbus-getter","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"statistiques","showStatusActivities":false,"showErrors":false,"showWarnings":true,"logIOActivities":false,"unitid":"1","dataType":"HoldingRegister","adr":"57378","quantity":"1","server":"419f10df0856f270","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"keepMsgProperties":false,"delayOnStart":false,"startDelayTime":"","x":444.73333740234375,"y":1548.7333297729492,"wires":[["dc7404591257e79a"],[]]},{"id":"173a9a67b995ff02","type":"delay","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"","pauseType":"delay","timeout":"80","timeoutUnits":"milliseconds","rate":"1","nbRateUnits":"1","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":false,"allowrate":false,"outputs":1,"x":284.73333740234375,"y":1548.7333297729492,"wires":[["f66f1a0fb11677fd"]]},{"id":"dc7404591257e79a","type":"function","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"Map onduleur setup","func":"//var realtimeArray = msg.payload.Data ; \nvar realtimeArray = msg.payload ; \nvar tensionutitosbu ;\ntensionutitosbu = { payload: realtimeArray[0] * 0.4, topic: \"easun/onduleur/tensionutitosbu\" };\nreturn [tensionutitosbu];","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":674.7333374023438,"y":1548.7333297729492,"wires":[["c122c02ed209a876"]],"outputLabels":["PV1Current"]},{"id":"adb658b67d4f3eb5","type":"string","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"","methods":[{"name":"toFloat","params":[{"type":"num","value":"2"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":924.7333374023438,"y":1168.7333297729492,"wires":[["b949139220858ce3"]]},{"id":"3b5ea4c71a9fd26a","type":"inject","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"1","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"[1,96,0,0,2,100,0,25,2300,5000,800,1,0,1,1,3,1]","payloadType":"json","x":350,"y":760,"wires":[["7fd387aad640112b"]]},{"id":"c4e5ce471b4f2cdd","type":"inject","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"map onduleur data","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"[0,0,0,0,0,1,0,0,5900,2836,294,0,5,0,3951,2349,0,4999,2300,12,5000,6,0,165,165,0,0,2,377,414,580,564]","payloadType":"json","x":170,"y":140,"wires":[["78daa8e7a58c103d"]]},{"id":"898b24b427827d1e","type":"inject","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"map photovolt et batterie data","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"[50,530,58,0,0,0,0,0,0,0,0,1,0,0,0,0]","payloadType":"json","x":300,"y":520,"wires":[["b346ed8f4ce86b21"]]},{"id":"d95d9965435c3c55","type":"inject","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"3","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"[29,72,39,63,0,0,0,28025,0,35076,0,30800,0,29713,0,2,15,10,10,5900,2064,9275,5900,2064,9275,370,0,4332,0,989]","payloadType":"json","x":350,"y":1340,"wires":[["9b831807cd5cbdc6"]]},{"id":"6021749dadda9848","type":"inject","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"4","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"[130]","payloadType":"json","x":450,"y":1500,"wires":[["dc7404591257e79a"]]},{"id":"6edec91680a33aa3","type":"inject","z":"311fc27fae3e469a","g":"84cd0ffd4a8a860d","name":"2","props":[{"p":"payload"},{"p":"topic","vt":"str"}],"repeat":"","crontab":"","once":false,"onceDelay":0.1,"topic":"","payload":"[100,48,6,150,144,142,146,142,134,132,114,115,110,0,30,5,120,5,5,60,65506,60,65506,0,5,122,0,0,0,5,4,0]","payloadType":"json","x":330,"y":1120,"wires":[["dde9a06e6090a296"]]},{"id":"18f0016798c6197f","type":"function","z":"7ec693d06a48e28c","g":"ea166099ccf67163","name":"Formatage","func":"msg.result = {};\nmsg.result.Timestamp = Date.now();\nmsg.result.OperatingStatus = msg.payload[0]; // 0x0200\nmsg.result.BatteryChargeDischargePower = ((msg.payload[13] << 16) >> 16) * 10.0; // 0x020D\nmsg.result.BatteryVoltage = msg.payload[14] / 10.0; // 0x020E\nmsg.result.SoC = ((msg.payload[16] << 16) >> 16); // 0x0210\nmsg.result.SoCWh = msg.result.SoC * 168.0;\nmsg.result.BatteryTemperature = ((msg.payload[17] << 16) >> 16); //0x0211\nmsg.result.GridPower = ((msg.payload[18] << 16) >> 16) * 10.0; //0x0212\nmsg.result.LoadPower = msg.payload[19] * 10.0; //0x0213\nmsg.result.EnergyStoragePowerInverter = ((msg.payload[20] << 16) >> 16) * 10.0; //0x0214\nmsg.result.PVPowerGeneration = (msg.payload[21]) * 10.0; //0x0215\nmsg.result.EPSOutputVoltage = (msg.payload[22]) / 10.0; //0x0216\nmsg.result.EPSPowerOutput = (msg.payload[23]) * 10.0; //0x0217\nmsg.result.DailyEnergy = (msg.payload[24]) * 10.0; //0x0218\nmsg.result.DailyEnergyInjectedIntoTheGrid = (msg.payload[25]) * 10.0; //0x0219\nmsg.result.DailyEnergyTakenFromTheGrid = (msg.payload[26]) * 10.0; //0x021A\nmsg.result.LoadDailyEnergy = (msg.payload[27]) * 10.0; //0x021B\nmsg.result.TotalEnergyHigh = (msg.payload[28]); //0x021C\nmsg.result.TotalEnergyLow = (msg.payload[29]); //0x021D\nmsg.result.BatteryCycleTimes = (msg.payload[44]); //0x022C\nmsg.result.BatteryPower = (msg.payload[55]); //0x0237\nmsg.result.InnerTemperature = (msg.payload[56]); //0x0238\n\nmsg.payload = msg.result;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":390,"y":100,"wires":[[]]},{"id":"aeec416df162e3df","type":"modbus-read","z":"7ec693d06a48e28c","g":"ea166099ccf67163","name":"SofarSolarModBus","topic":"","showStatusActivities":false,"logIOActivities":false,"showErrors":false,"showWarnings":true,"unitid":"1","dataType":"HoldingRegister","adr":"0x200","quantity":"57","rate":"15","rateUnit":"s","delayOnStart":false,"startDelayTime":"","server":"0d589ea16120e0d9","useIOFile":false,"ioFile":"","useIOForPayload":false,"emptyMsgOnFail":false,"x":200,"y":100,"wires":[["18f0016798c6197f"],[]]},{"id":"1a36f224c52de710","type":"serial in","z":"e091b9214cc61a28","g":"afbe017601a3a934","name":"Junctek KG-F Shunt 400 [A]","serial":"c9a4df3e21338d0a","x":180,"y":180,"wires":[["1acee92886224879","2aeb08d199add338"]]},{"id":"1acee92886224879","type":"debug","z":"e091b9214cc61a28","g":"afbe017601a3a934","name":"Junctek Out","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":450,"y":180,"wires":[]},{"id":"2aeb08d199add338","type":"switch","z":"e091b9214cc61a28","g":"afbe017601a3a934","name":"r50 or r51 ?","property":"payload","propertyType":"msg","rules":[{"t":"cont","v":":r50","vt":"str"},{"t":"cont","v":":r51","vt":"str"},{"t":"else"}],"checkall":"false","repair":false,"outputs":3,"x":170,"y":260,"wires":[["ea0f6667a75e1696"],["9efa6ce981bd0692"],["24e1d12308d64e95"]]},{"id":"24e1d12308d64e95","type":"debug","z":"e091b9214cc61a28","g":"afbe017601a3a934","name":"Autre","active":false,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":350,"y":320,"wires":[]},{"id":"76d703acd3803ad5","type":"split","z":"e091b9214cc61a28","g":"afbe017601a3a934","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":530,"y":240,"wires":[["e1ee58df3b5e38ce"]]},{"id":"d1a99a1076d3819a","type":"join","z":"e091b9214cc61a28","g":"afbe017601a3a934","name":"","mode":"custom","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"1","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":850,"y":240,"wires":[["e2b22b278cceefc7"]]},{"id":"e1ee58df3b5e38ce","type":"change","z":"e091b9214cc61a28","g":"afbe017601a3a934","name":"Remove \"spaces\"","rules":[{"t":"change","p":"payload","pt":"msg","from":"\\s+","fromt":"re","to":" ","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":240,"wires":[["d1a99a1076d3819a"]]},{"id":"52736e2aa596a00d","type":"debug","z":"e091b9214cc61a28","g":"afbe017601a3a934","name":"Tableau Out","active":true,"tosidebar":true,"console":false,"tostatus":false,"complete":"payload","targetType":"msg","statusVal":"","statusType":"auto","x":1130,"y":200,"wires":[]},{"id":"e2b22b278cceefc7","type":"csv","z":"e091b9214cc61a28","g":"afbe017601a3a934","name":"rép. r50","sep":",","hdrin":"","hdrout":"none","multi":"mult","ret":"\\n","temp":"Add,Chk,[V],[A],[Ah] restant,[Ah]cumulée,[Wh],Temps[s],Temp[°],[W],Status,Sens courant,Batt Life[m],Batt Resist[mΩ]","skip":"0","strings":true,"include_empty_strings":"","include_null_values":"","x":1000,"y":240,"wires":[["52736e2aa596a00d","23c289f154371763"]]},{"id":"7ef671364fa53675","type":"change","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"Volts","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[0][\"[V]\"]","tot":"msg"},{"t":"set","p":"label","pt":"msg","to":"Volts","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Tension","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":270,"y":500,"wires":[["d0e3c002c3ff7abf","8743a60f9a622822"]]},{"id":"d0e3c002c3ff7abf","type":"function","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"add color","func":"var data = msg.payload;\nvar color;\ncolor = \"orange\";\nmsg.color = color;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":440,"y":460,"wires":[["5bb3add94b07e3dc"]]},{"id":"8d56eeee7725f8d0","type":"change","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"Ampères","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[0][\"[A]\"]","tot":"msg"},{"t":"set","p":"label","pt":"msg","to":"Ampères","tot":"str"},{"t":"set","p":"topic","pt":"msg","to":"Courant","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":280,"y":560,"wires":[["a5b39bea971a8dbb","8743a60f9a622822"]]},{"id":"a5b39bea971a8dbb","type":"function","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"add color","func":"var data = msg.payload;\nvar color;\ncolor = \"red\";\nmsg.color = color;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":440,"y":600,"wires":[["377640da981fd362"]]},{"id":"cd9c06b3a0ce89aa","type":"change","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"Sens","rules":[{"t":"set","p":"sens_courant","pt":"flow","to":"payload[0][\"Sens courant\"]","tot":"msg"},{"t":"set","p":"payload","pt":"msg","to":"payload[0][\"Sens courant\"]","tot":"msg"},{"t":"set","p":"label","pt":"msg","to":"Sens","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":270,"y":680,"wires":[["79e0106a5571d6e6"]]},{"id":"893375d3c7782404","type":"function","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"add color","func":"var data = msg.payload;\nvar color;\ncolor = \"red\";\nmsg.color = color;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":660,"wires":[["2e5bbf051c6d2813"]]},{"id":"79e0106a5571d6e6","type":"switch","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"sens ?","property":"payload","propertyType":"msg","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"false","repair":false,"outputs":2,"x":430,"y":680,"wires":[["893375d3c7782404"],["4f165ed8157e175d"]]},{"id":"4f165ed8157e175d","type":"function","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"add color","func":"var data = msg.payload;\nvar color;\ncolor = \"green\";\nmsg.color = color;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":620,"y":700,"wires":[["1d16476e9ca7cd49"]]},{"id":"2e5bbf051c6d2813","type":"change","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"Décharge","rules":[{"t":"set","p":"payload","pt":"msg","to":"Décharge","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":660,"wires":[[]]},{"id":"1d16476e9ca7cd49","type":"change","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"Charge","rules":[{"t":"set","p":"payload","pt":"msg","to":"Charge","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":780,"y":700,"wires":[[]]},{"id":"cb30886bff26dea0","type":"function","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"Calcul du SOC Junktec","func":"// Calcul du SOC actuel\n// Prendre la capacité restant divisée par le capacité du pack batterie totale\n//\nvar Ah_restant = msg.payload;\nvar Ah_Pack_Total = flow.get('Junktec_Ah_Pack_Total');\nValue = Ah_restant / Ah_Pack_Total;\nmsg.payload = Value / 10;\nmsg.payload = Number(msg.payload.toFixed(2));\nmsg.color = \"blue\";\nmsg.label = \"SOC\";\nreturn msg;\n","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":510,"y":760,"wires":[[]]},{"id":"ea0f6667a75e1696","type":"delay","z":"e091b9214cc61a28","g":"afbe017601a3a934","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"5","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"allowrate":false,"outputs":1,"x":380,"y":240,"wires":[["76d703acd3803ad5"]]},{"id":"0521802c70304b1f","type":"change","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"[Ah] restant","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[0][\"[Ah] restant\"]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":760,"wires":[["cb30886bff26dea0"]]},{"id":"7e7284fa15388413","type":"link in","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"link in 7","links":["23c289f154371763"],"x":75,"y":620,"wires":[["7ef671364fa53675","8d56eeee7725f8d0","cd9c06b3a0ce89aa","0521802c70304b1f","965525df1213ee7d"]]},{"id":"23c289f154371763","type":"link out","z":"e091b9214cc61a28","g":"afbe017601a3a934","name":"link out 12","mode":"link","links":["7e7284fa15388413"],"x":1125,"y":280,"wires":[]},{"id":"5bb3add94b07e3dc","type":"string","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"1 digits","methods":[{"name":"toFloat","params":[{"type":"num","value":"1"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":740,"y":460,"wires":[["0684da33ce91a6ee"]]},{"id":"377640da981fd362","type":"string","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"1 digits","methods":[{"name":"toFloat","params":[{"type":"num","value":"1"}]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":600,"y":600,"wires":[["7d1b7ae8a5aeccdd"]]},{"id":"0684da33ce91a6ee","type":"function","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"/100","func":"msg.payload = msg.payload / 100;\n// msg.payload = Number(msg.payload.toFixed(0));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":950,"y":440,"wires":[[]]},{"id":"31a8da64a6d4c7ec","type":"function","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"/100","func":"msg.payload = msg.payload / 100 * (-1);\n// msg.payload = Number(msg.payload.toFixed(0));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":890,"y":580,"wires":[[]]},{"id":"965525df1213ee7d","type":"change","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"Température","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[0][\"Temp[°]\"]","tot":"msg"},{"t":"set","p":"label","pt":"msg","to":"Temp.","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":290,"y":1020,"wires":[["aa4138f16fd06327"]]},{"id":"aa4138f16fd06327","type":"function","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"add color","func":"var data = msg.payload;\nvar color;\ncolor = \"black\";\nmsg.color = color;\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":460,"y":1020,"wires":[["fb72b4c244f35774"]]},{"id":"fb72b4c244f35774","type":"string","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"2 last digits","methods":[{"name":"right","params":[{"type":"num","value":"2"}]},{"name":"toInteger","params":[]}],"prop":"payload","propout":"payload","object":"msg","objectout":"msg","x":610,"y":1020,"wires":[["c7d58cac374d58c1"]]},{"id":"8743a60f9a622822","type":"link out","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"link out 13","mode":"link","links":["3edd97d6fd519f51"],"x":405,"y":520,"wires":[]},{"id":"7d1b7ae8a5aeccdd","type":"switch","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"sens","property":"sens_courant","propertyType":"flow","rules":[{"t":"eq","v":"0","vt":"num"},{"t":"eq","v":"1","vt":"num"}],"checkall":"false","repair":false,"outputs":2,"x":750,"y":600,"wires":[["31a8da64a6d4c7ec"],["f3d55b3992c3257d"]]},{"id":"f3d55b3992c3257d","type":"function","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"/100","func":"msg.payload = msg.payload / 100;\n// msg.payload = Number(msg.payload.toFixed(0));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":890,"y":620,"wires":[[]]},{"id":"9efa6ce981bd0692","type":"delay","z":"e091b9214cc61a28","g":"afbe017601a3a934","name":"","pauseType":"rate","timeout":"5","timeoutUnits":"seconds","rate":"1","nbRateUnits":"10","rateUnits":"minute","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"allowrate":false,"outputs":1,"x":380,"y":280,"wires":[["4c6221eca0e89314"]]},{"id":"4c6221eca0e89314","type":"split","z":"e091b9214cc61a28","g":"afbe017601a3a934","name":"","splt":"\\n","spltType":"str","arraySplt":1,"arraySpltType":"len","stream":false,"addname":"","x":530,"y":280,"wires":[["5dbea6e31cb2a0a3"]]},{"id":"5dbea6e31cb2a0a3","type":"change","z":"e091b9214cc61a28","g":"afbe017601a3a934","name":"Remove \"spaces\"","rules":[{"t":"change","p":"payload","pt":"msg","from":"\\s+","fromt":"re","to":" ","tot":"str"}],"action":"","property":"","from":"","to":"","reg":false,"x":690,"y":280,"wires":[["31bfa3375086b936"]]},{"id":"31bfa3375086b936","type":"join","z":"e091b9214cc61a28","g":"afbe017601a3a934","name":"","mode":"custom","build":"string","property":"payload","propertyType":"msg","key":"topic","joiner":"\\n","joinerType":"str","accumulate":false,"timeout":"1","count":"","reduceRight":false,"reduceExp":"","reduceInit":"","reduceInitType":"","reduceFixup":"","x":850,"y":280,"wires":[["69ae7dd32f0b095d"]]},{"id":"69ae7dd32f0b095d","type":"csv","z":"e091b9214cc61a28","g":"afbe017601a3a934","name":"rép. r51","sep":",","hdrin":"","hdrout":"none","multi":"mult","ret":"\\n","temp":"1,2,3,4,5,6,7,8,9,10,Pack-Ah,12,13,14,15,16,17,18,19","skip":"0","strings":true,"include_empty_strings":"","include_null_values":"","x":1000,"y":280,"wires":[["aee398f7583255bf"]]},{"id":"c012a4fead5e5458","type":"change","z":"e091b9214cc61a28","g":"afbe017601a3a934","name":"Junktec_Ah_Pack_Total","rules":[{"t":"set","p":"Junktec_Ah_Pack_Total","pt":"flow","to":"payload","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":970,"y":320,"wires":[[]]},{"id":"aee398f7583255bf","type":"change","z":"e091b9214cc61a28","g":"afbe017601a3a934","name":"Pack-Ah","rules":[{"t":"set","p":"payload","pt":"msg","to":"payload[0][\"Pack-Ah\"]","tot":"msg"}],"action":"","property":"","from":"","to":"","reg":false,"x":620,"y":320,"wires":[["21a98a4de8bcc929"]]},{"id":"21a98a4de8bcc929","type":"function","z":"e091b9214cc61a28","g":"afbe017601a3a934","name":"/10","func":"msg.payload = msg.payload / 10;\n//msg.payload = Number(msg.payload.toFixed(0));\nreturn msg;","outputs":1,"noerr":0,"initialize":"","finalize":"","libs":[],"x":770,"y":320,"wires":[["c012a4fead5e5458"]]},{"id":"c7d58cac374d58c1","type":"delay","z":"e091b9214cc61a28","g":"356a37bfc81f1baa","name":"","pauseType":"rate","timeout":"15","timeoutUnits":"seconds","rate":"1","nbRateUnits":"30","rateUnits":"second","randomFirst":"1","randomLast":"5","randomUnits":"seconds","drop":true,"allowrate":false,"outputs":1,"x":780,"y":1020,"wires":[[]]}]